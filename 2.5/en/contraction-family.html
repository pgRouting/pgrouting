<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Contraction - Family of functions &#8212; pgRouting Manual (2.5)</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
<script src="_static/page_history.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pgr_contractGraph - Experimental" href="pgr_contractGraph.html" />
    <link rel="prev" title="KSP Category" href="KSP-category.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/pgrouting.png"></span>
          pgRouting</a>
        <span class="navbar-text navbar-version pull-left"><b>v2.5.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Sample Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting Concepts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgr_version.html">pgr_version</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="types_index.html">pgRouting Data Types</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="topology-functions.html">Topology - Family of Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="routingFunctions.html">Routing Functions</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Stable Proposed Functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="proposed.html#experimental-functions">Experimental Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Contraction - Family of functions</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#dead-end-contraction">Dead end contraction</a><ul>
<li><a class="reference internal" href="#dead-end-nodes">Dead end nodes</a></li>
<li><a class="reference internal" href="#operation-dead-end-contraction">Operation: Dead End Contraction</a></li>
<li><a class="reference internal" href="#not-dead-end-nodes">Not Dead End nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linear-contraction">Linear contraction</a><ul>
<li><a class="reference internal" href="#linear-nodes">Linear nodes</a></li>
<li><a class="reference internal" href="#operation-linear-contraction">Operation: Linear Contraction</a></li>
<li><a class="reference internal" href="#not-linear-nodes">Not Linear nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-cycle">The cycle</a></li>
<li><a class="reference internal" href="#contracting-sample-data">Contracting Sample Data</a><ul>
<li><a class="reference internal" href="#construction-of-the-graph-in-the-database">Construction of the graph in the database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="KSP-category.html" title="Previous Chapter: KSP Category"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; KSP Category</span>
    </a>
  </li>
  <li>
    <a href="pgr_contractGraph.html" title="Next Chapter: pgr_contractGraph - Experimental"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">pgr_contractG... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
 <div class="line"><br/></div> <script> document.write(get_history("contraction-family","en")); </script>
      
  <div class="section" id="contraction-family-of-functions">
<span id="contraction"></span><h1>Contraction - Family of functions<a class="headerlink" href="#contraction-family-of-functions" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Experimental functions</p>
<ul class="last simple">
<li>They are not officially of the current release.</li>
<li>They likely will not be officially be part of the next release:<ul>
<li>The functions might not make use of ANY-INTEGER and ANY-NUMERICAL</li>
<li>Name might change.</li>
<li>Signature might change.</li>
<li>Functionality might change.</li>
<li>pgTap tests might be missing.</li>
<li>Might need c/c++ coding.</li>
<li>May lack documentation.</li>
<li>Documentation if any might need to be rewritten.</li>
<li>Documentation examples might need to be automatically generated.</li>
<li>Might need a lot of feedback from the comunity.</li>
<li>Might depend on a proposed function of pgRouting</li>
<li>Might depend on a deprecated function of pgRouting</li>
</ul>
</li>
</ul>
</div>
<p><a class="reference internal" href="pgr_contractGraph.html#pgr-contractgraph"><span class="std std-ref">pgr_contractGraph - Experimental</span></a></p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In big graphs, like the road graphs, or electric networks, graph contraction can be used to speed up some graph algorithms. Contraction reduces the size of the graph by removing some of the vertices and edges and, for example, might add edges that represent a sequence of original edges decreasing the total time and space used in graph algorithms.</p>
<p>This implementation gives a flexible framework for adding contraction algorithms in the future, currently, it supports two algorithms:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Dead end contraction</li>
<li>Linear contraction</li>
</ol>
</div></blockquote>
<p>Allowing the user to:</p>
<blockquote>
<div><ul class="simple">
<li>Forbid contraction on a set of nodes.</li>
<li>Decide the order of the contraction algorithms and set the maximum number of times they are to be executed.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">UNDER DISCUSSION:  Forbid contraction on a set of edges</p>
</div>
</div>
<div class="section" id="dead-end-contraction">
<h2>Dead end contraction<a class="headerlink" href="#dead-end-contraction" title="Permalink to this headline">¶</a></h2>
<p>In the algorithm, dead end contraction is represented by 1.</p>
<div class="section" id="dead-end-nodes">
<h3>Dead end nodes<a class="headerlink" href="#dead-end-nodes" title="Permalink to this headline">¶</a></h3>
<p>The definition of a dead end node is different for a directed and an undirected graph.</p>
<p>In case of a undirected graph, a node is considered a dead end node if</p>
<blockquote>
<div><ul class="simple">
<li>The number of adjacent vertices is 1.</li>
</ul>
</div></blockquote>
<p>In case of an directed graph, a node is considered a dead end node if</p>
<blockquote>
<div><ul class="simple">
<li>There are no outgoing edges and has at least one incoming edge.</li>
<li>There is one incoming and one outgoing edge with the same identifier.</li>
</ul>
</div></blockquote>
<p class="rubric">Examples</p>
<ul class="simple">
<li>The green node <code class="docutils literal notranslate"><span class="pre">B</span></code> represents a dead end node</li>
<li>The node <code class="docutils literal notranslate"><span class="pre">A</span></code> is the only node connecting to <code class="docutils literal notranslate"><span class="pre">B</span></code>.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">A</span></code> is part of the rest of the graph and has an unlimited number of incoming and outgoing edges.</li>
<li>Directed graph</li>
</ul>
<div class="graphviz"><img src="_images/graphviz-e002cb4fdb79b93e0efb0c60906e796ce901b508.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=green];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    A -&gt; B;
}" class="graphviz" /></div>
</div>
<div class="section" id="operation-dead-end-contraction">
<h3>Operation: Dead End Contraction<a class="headerlink" href="#operation-dead-end-contraction" title="Permalink to this headline">¶</a></h3>
<p>The dead end contraction will stop until there are no more dead end nodes.
For example from the following graph:</p>
<ul class="simple">
<li>Node <code class="docutils literal notranslate"><span class="pre">A</span></code> is connected to the rest of the graph by an unlimited number of edges.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">B</span></code> is connected to the rest of the graph with one incoming edge.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">B</span></code> is the only node connecting to <code class="docutils literal notranslate"><span class="pre">C</span></code>.</li>
<li>The green node <code class="docutils literal notranslate"><span class="pre">C</span></code> represents a <cite>Dead End</cite> node</li>
</ul>
<div class="graphviz"><img src="_images/graphviz-ade791d152ae02e6bec03432389ce4d58635b655.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=deepskyblue];
    C [style=filled; color=green];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    A -&gt; B;
    B -&gt; C;
}" class="graphviz" /></div>
<p>After contracting <code class="docutils literal notranslate"><span class="pre">C</span></code>, node <code class="docutils literal notranslate"><span class="pre">B</span></code> is now a <cite>Dead End</cite> node and is contracted:</p>
<div class="graphviz"><img src="_images/graphviz-fee1f3d6770149d5db8321e6dbab8efce97ddd35.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=green;label=&quot;B {C}&quot;;];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    A -&gt; B;
}" class="graphviz" /></div>
<p>Node <code class="docutils literal notranslate"><span class="pre">B</span></code> gets contracted</p>
<div class="graphviz"><img src="_images/graphviz-e654fa28fa47c27bb2fe2665caa75650deb0b8c1.png" alt="digraph G {
    A [style=filled;color=deepskyblue;label=&quot;A {B, C}&quot;;];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
}" class="graphviz" /></div>
<p>Nodes <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> belong to node <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
</div>
<div class="section" id="not-dead-end-nodes">
<h3>Not Dead End nodes<a class="headerlink" href="#not-dead-end-nodes" title="Permalink to this headline">¶</a></h3>
<p>In this graph <code class="docutils literal notranslate"><span class="pre">B</span></code> is not a <cite>dead end</cite> node.</p>
<div class="graphviz"><img src="_images/graphviz-81a2d932155366d34dce9105efbd7c384cb54b7d.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=red];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    G -&gt; A [dir=none, weight=1, penwidth=3];
    B -&gt; A;
}" class="graphviz" /></div>
</div>
</div>
<div class="section" id="linear-contraction">
<h2>Linear contraction<a class="headerlink" href="#linear-contraction" title="Permalink to this headline">¶</a></h2>
<p>In the algorithm, linear contraction is represented by 2.</p>
<div class="section" id="linear-nodes">
<h3>Linear nodes<a class="headerlink" href="#linear-nodes" title="Permalink to this headline">¶</a></h3>
<p>A node is considered a linear node if satisfies the following:</p>
<ul class="simple">
<li>The number of adjacent vertices are 2.</li>
<li>Should have at least one incoming edge and one outgoing edge.</li>
</ul>
<p class="rubric">Examples</p>
<ul class="simple">
<li>The green node <code class="docutils literal notranslate"><span class="pre">B</span></code> represents a linear node</li>
<li>The nodes <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> are the only nodes connecting to <code class="docutils literal notranslate"><span class="pre">B</span></code>.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">A</span></code> is part of the rest of the graph and has an unlimited number of incoming and outgoing edges.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">C</span></code> is part of the rest of the graph and has an unlimited number of incoming and outgoing edges.</li>
<li>Directed graph</li>
</ul>
<div class="graphviz"><img src="_images/graphviz-5976dd8456b91da529df5272cf5c18bb6883451a.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=green];
    C [style=filled;color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    G -&gt; C [dir=none, weight=1, penwidth=3];
    A -&gt; B;
    B -&gt; C;
}" class="graphviz" /></div>
</div>
<div class="section" id="operation-linear-contraction">
<h3>Operation: Linear Contraction<a class="headerlink" href="#operation-linear-contraction" title="Permalink to this headline">¶</a></h3>
<p>The linear contraction will stop until there are no more linear nodes.
For example from the following graph:</p>
<ul class="simple">
<li>Node <code class="docutils literal notranslate"><span class="pre">A</span></code> is connected to the rest of the graph by an unlimited number of edges.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">B</span></code> is connected to the rest of the graph with one incoming edge and one outgoing edge.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">C</span></code> is connected to the rest of the graph with one incoming edge and one outgoing edge.</li>
<li>Node <code class="docutils literal notranslate"><span class="pre">D</span></code> is connected to the rest of the graph by an unlimited number of edges.</li>
<li>The green nodes <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> represents <cite>Linear</cite> nodes.</li>
</ul>
<div class="graphviz"><img src="_images/graphviz-bc7b60a82f767405751e940083a29f79a12d7c45.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=green];
    C [style=filled; color=green];
    D [style=filled; color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    G -&gt; D [dir=none, weight=1, penwidth=3];
    A -&gt; B;
    B -&gt; C;
    C -&gt; D;

}" class="graphviz" /></div>
<p>After contracting <code class="docutils literal notranslate"><span class="pre">B</span></code>, a new edge gets inserted between <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> which is represented by red color.</p>
<div class="graphviz"><img src="_images/graphviz-0f53a1f679991a0f127cdc202958721f76616f7e.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    C [style=filled; color=green];
    D [style=filled; color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    G -&gt; D [dir=none, weight=1, penwidth=3];
    A -&gt; C [label=&quot;{B}&quot;;color=red]
    C -&gt; D;

}" class="graphviz" /></div>
<p>Node <code class="docutils literal notranslate"><span class="pre">C</span></code> is <cite>linear node</cite> and gets contracted.</p>
<div class="graphviz"><img src="_images/graphviz-611d124f062113d368253ae1e1f77bb307bc233e.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    D [style=filled; color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    G -&gt; D [dir=none, weight=1, penwidth=3];
    A -&gt; D [label=&quot;{B, C}&quot;;color=red];

}" class="graphviz" /></div>
<p>Nodes <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> belong to edge connecting <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">D</span></code> which is represented by red color.</p>
</div>
<div class="section" id="not-linear-nodes">
<h3>Not Linear nodes<a class="headerlink" href="#not-linear-nodes" title="Permalink to this headline">¶</a></h3>
<p>In this graph <code class="docutils literal notranslate"><span class="pre">B</span></code> is not a <cite>linear</cite> node.</p>
<div class="graphviz"><img src="_images/graphviz-5bd056c1436ff736bbf4541c057415e97abfe82e.png" alt="digraph G {
    A [style=filled;color=deepskyblue];
    B [style=filled; color=red];
    C [style=filled;color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon;
    style=filled;color=deepskyblue;
    label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; A [dir=none, weight=1, penwidth=3];
    G -&gt; C [dir=none, weight=1, penwidth=3];
    A -&gt; B;
    C -&gt; B;
}" class="graphviz" /></div>
</div>
</div>
<div class="section" id="the-cycle">
<h2>The cycle<a class="headerlink" href="#the-cycle" title="Permalink to this headline">¶</a></h2>
<p>Contracting a graph, can be done with more than one operation. The order of the operations affect the resulting contracted graph, after applying one operation, the set of vertices that can be contracted by another operation changes.</p>
<p>This implementation, cycles <code class="docutils literal notranslate"><span class="pre">max_cycles</span></code> times through <code class="docutils literal notranslate"><span class="pre">operations_order</span></code> .</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;input&gt;
do max_cycles times {
    for (operation in operations_order)
     { do operation }
}
&lt;output&gt;
</pre></div>
</div>
</div>
<div class="section" id="contracting-sample-data">
<h2>Contracting Sample Data<a class="headerlink" href="#contracting-sample-data" title="Permalink to this headline">¶</a></h2>
<p>In this section, building and using a contracted graph will be shown by example.</p>
<ul class="simple">
<li>The <a class="reference internal" href="sampledata.html"><span class="doc">Sample Data</span></a> for an undirected graph is used</li>
<li>a dead end operation first followed by a linear operation.</li>
</ul>
<p>The original graph:</p>
<img alt="_images/undirected_sampledata_a.png" src="_images/undirected_sampledata_a.png" />
<p>After doing a dead end contraction operation:</p>
<img alt="_images/undirected_sampledata_b.png" src="_images/undirected_sampledata_b.png" />
<p>Doing a linear contraction operation to the graph above</p>
<img alt="_images/undirected_sampledata_c.png" src="_images/undirected_sampledata_c.png" />
<p>There are five cases, in this documentation, which arise when calculating the shortest path between a given source and target.
In this examples, <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> is used.</p>
<ul class="simple">
<li><strong>Case 1</strong>: Both source and target belong to the contracted graph.</li>
<li><strong>Case 2</strong>: Source belongs to a contracted graph, while target belongs to a edge subgraph.</li>
<li><strong>Case 3</strong>: Source belongs to a vertex subgraph, while target belongs to an edge subgraph.</li>
<li><strong>Case 4</strong>: Source belongs to a contracted graph, while target belongs to an vertex subgraph.</li>
<li><strong>Case 5</strong>: The path contains a new edge added by the contraction algorithm.</li>
</ul>
<div class="section" id="construction-of-the-graph-in-the-database">
<h3>Construction of the graph in the database<a class="headerlink" href="#construction-of-the-graph-in-the-database" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Original Data</p>
<p>The following query shows the original data involved in the contraction operation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p class="rubric">Contraction Results</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pgr_contractGraph</span><span class="p">(</span>
    <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edge_table&#39;</span><span class="p">,</span>
    <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">directed</span><span class="p">:</span><span class="o">=</span><span class="n">true</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> 
<span class="o">-----+------+----+---------------------+--------+--------+------</span>
   <span class="mi">1</span> <span class="o">|</span> <span class="n">v</span>    <span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">}</span>               <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
   <span class="mi">2</span> <span class="o">|</span> <span class="n">v</span>    <span class="o">|</span> <span class="mi">15</span> <span class="o">|</span> <span class="p">{</span><span class="mi">14</span><span class="p">}</span>                <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span> <span class="n">v</span>    <span class="o">|</span> <span class="mi">17</span> <span class="o">|</span> <span class="p">{</span><span class="mi">16</span><span class="p">}</span>                <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
   <span class="mi">4</span> <span class="o">|</span> <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>    <span class="mi">2</span>
   <span class="mi">5</span> <span class="o">|</span> <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span>                 <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">2</span>
   <span class="mi">6</span> <span class="o">|</span> <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">}</span>             <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">2</span>
   <span class="mi">7</span> <span class="o">|</span> <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">12</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">2</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>The above results do not represent the contracted graph. They represent the changes done to the graph after applying the contraction algorithm. We can see that vertices like 6 and 11 do not appear in the contraction results because they were not affected by the contraction algorithm.</p>
<p class="rubric">step 1</p>
<p>Adding extra columns to the <code class="docutils literal notranslate"><span class="pre">edge_table</span></code> and <code class="docutils literal notranslate"><span class="pre">edge_table_vertices_pgr</span></code> tables:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>contracted_vertices</strong></td>
<td>The vertices set belonging to the vertex/edge</td>
</tr>
<tr class="row-odd"><td><strong>is_contracted</strong></td>
<td>On a <cite>vertex</cite> table: when <code class="docutils literal notranslate"><span class="pre">true</span></code> the vertex is contracted, so is not part of the contracted graph.</td>
</tr>
<tr class="row-even"><td><strong>is_contracted</strong></td>
<td>On an <cite>edge</cite> table: when <code class="docutils literal notranslate"><span class="pre">true</span></code> the edge was generated by the contraction algorithm.</td>
</tr>
</tbody>
</table>
<p>Using the following queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edge_table</span> <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edge_table_vertices_pgr</span> <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edge_table</span> <span class="n">ADD</span> <span class="n">is_contracted</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edge_table_vertices_pgr</span> <span class="n">ADD</span> <span class="n">is_contracted</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">SET</span> <span class="n">client_min_messages</span> <span class="n">TO</span> <span class="n">NOTICE</span><span class="p">;</span>
<span class="n">SET</span>
</pre></div>
</div>
<p class="rubric">step 2</p>
<p>For simplicity, in this documentation, store the results of the call to pgr_contractGraph in a temporary table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">INTO</span> <span class="n">contraction_results</span>
<span class="n">FROM</span> <span class="n">pgr_contractGraph</span><span class="p">(</span>
    <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edge_table&#39;</span><span class="p">,</span>
    <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">directed</span><span class="p">:</span><span class="o">=</span><span class="n">true</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">7</span>
</pre></div>
</div>
<p class="rubric">step 3</p>
<p>Update the <cite>vertex</cite> and <cite>edge</cite> tables using the results of the call to pgr_contraction</p>
<ul class="simple">
<li>In <cite>edge_table_vertices_pgr.is_contracted</cite> indicate the vertices that are contracted.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">edge_table_vertices_pgr</span>
<span class="n">SET</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span>  <span class="n">unnest</span><span class="p">(</span><span class="n">contracted_vertices</span><span class="p">)</span> <span class="n">FROM</span>  <span class="n">contraction_results</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">10</span>
</pre></div>
</div>
<ul class="simple">
<li>Add to <cite>edge_table_vertices_pgr.contracted_vertices</cite>  the contracted vertices belonging to the vertices.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">edge_table_vertices_pgr</span>
<span class="n">SET</span> <span class="n">contracted_vertices</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">contracted_vertices</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span> <span class="n">AND</span> <span class="n">edge_table_vertices_pgr</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<ul class="simple">
<li>Insert the new edges generated by  pgr_contractGraph.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">edge_table</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_contracted</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">true</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">4</span>
</pre></div>
</div>
<p class="rubric">step 3.1</p>
<p>Verify visually the updates.</p>
<ul class="simple">
<li>On the <cite>edge_table_vertices_pgr</cite></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_contracted</span> 
<span class="n">FROM</span> <span class="n">edge_table_vertices_pgr</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">is_contracted</span> 
<span class="o">----+---------------------+---------------</span>
  <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">2</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">3</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">4</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">5</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">}</span>               <span class="o">|</span> <span class="n">f</span>
  <span class="mi">6</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">7</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">8</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">9</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">10</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">11</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">12</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">13</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">14</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">15</span> <span class="o">|</span> <span class="p">{</span><span class="mi">14</span><span class="p">}</span>                <span class="o">|</span> <span class="n">f</span>
 <span class="mi">16</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">17</span> <span class="o">|</span> <span class="p">{</span><span class="mi">16</span><span class="p">}</span>                <span class="o">|</span> <span class="n">f</span>
<span class="p">(</span><span class="mi">17</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<ul class="simple">
<li>On the <cite>edge_table</cite></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_contracted</span> 
<span class="n">FROM</span> <span class="n">edge_table</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">is_contracted</span> 
<span class="o">----+--------+--------+------+--------------+---------------------+---------------</span>
  <span class="mi">1</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">3</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">4</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">5</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">6</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">9</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">11</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">12</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">13</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">14</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">15</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">16</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">17</span> <span class="o">|</span>     <span class="mi">14</span> <span class="o">|</span>     <span class="mi">15</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">18</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">19</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>               <span class="o">|</span> <span class="n">t</span>
 <span class="mi">20</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span>                 <span class="o">|</span> <span class="n">t</span>
 <span class="mi">21</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">}</span>             <span class="o">|</span> <span class="n">t</span>
 <span class="mi">22</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">12</span><span class="p">}</span>                <span class="o">|</span> <span class="n">t</span>
<span class="p">(</span><span class="mi">22</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<ul class="simple">
<li>vertices that belong to the contracted graph are the non contracted vertices</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span>  <span class="n">FROM</span> <span class="n">edge_table_vertices_pgr</span>
<span class="n">WHERE</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">false</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> 
<span class="o">----</span>
  <span class="mi">3</span>
  <span class="mi">5</span>
  <span class="mi">6</span>
  <span class="mi">9</span>
 <span class="mi">11</span>
 <span class="mi">15</span>
 <span class="mi">17</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">case 1: Both source and target belong to the contracted graph.</p>
<p>Inspecting the contracted graph above, vertex 3 and vertex 11 are part of the contracted graph. In the following query:</p>
<blockquote>
<div><ul class="simple">
<li>vertices_in_graph hold the vertices that belong to the contracted graph.</li>
<li>when selecting the edges, only edges that have the source and the target in that set are the edges belonging to the contracted graph, that is done in the WHERE clause.</li>
</ul>
</div></blockquote>
<p>Visually, looking at the original graph, going from 3 to 11: 3 -&gt; 6 -&gt; 11, and in the contracted graph, it is also 3 -&gt; 6 -&gt; 11.
The results, on the contracted graph match the results as if it was done on the original graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
    $$
    WITH
    vertices_in_graph AS (
        SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false)
    SELECT id, source, target, cost, reverse_cost 
    FROM edge_table 
    WHERE source IN (SELECT * FROM vertices_in_graph)
    AND target IN (SELECT * FROM vertices_in_graph)
    $$,
    3, 11, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    5 |    1 |        0
   2 |        2 |    6 |   11 |    1 |        1
   3 |        3 |   11 |   -1 |    0 |        2
(3 rows)

</pre></div>
</div>
<p class="rubric">case 2: Source belongs to the contracted graph, while target belongs to a edge subgraph.</p>
<dl class="docutils">
<dt>Inspecting the contracted graph above, vertex 3 is part of the contracted graph and vertex 1 belongs to the contracted subgraph of edge 19. In the following query:</dt>
<dd><ul class="first last simple">
<li>expand1 holds the contracted vertices of the edge where vertex 1 belongs. (belongs to edge 19).</li>
<li>vertices_in_graph hold the vertices that belong to the contracted graph and also the contracted vertices of edge 19.</li>
<li>when selecting the edges, only edges that have the source and the target in that set are the edges belonging to the contracted graph, that is done in the WHERE clause.</li>
</ul>
</dd>
</dl>
<p>Visually, looking at the original graph, going from 3 to 1: 3 -&gt; 2 -&gt; 1, and in the contracted graph, it is also 3 -&gt; 2 -&gt; 1.
The results, on the contracted graph match the results as if it was done on the original graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
    $$
    WITH
    expand_edges AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table),
    expand1 AS (SELECT contracted_vertices FROM edge_table
        WHERE id IN (SELECT id FROM expand_edges WHERE vertex = 1)),
    vertices_in_graph AS (
        SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false
        UNION
        SELECT unnest(contracted_vertices) FROM expand1)
    SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE source IN (SELECT * FROM vertices_in_graph)
    AND target IN (SELECT * FROM vertices_in_graph)
    $$,
    3, 1, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    2 |    1 |        0
   2 |        2 |    2 |    1 |    1 |        1
   3 |        3 |    1 |   -1 |    0 |        2
(3 rows)

</pre></div>
</div>
<p class="rubric">case 3: Source belongs to a vertex subgraph, while target belongs to an edge subgraph.</p>
<p>Inspecting the contracted graph above, vertex 7 belongs to the contracted subgraph of vertex 5 and vertex 13 belongs to the contracted subgraph of edge 21. In the following query:</p>
<blockquote>
<div><ul class="simple">
<li>expand7 holds the contracted vertices of vertex where vertex 7 belongs. (belongs to vertex 5)</li>
<li>expand13 holds the contracted vertices of edge where vertex 13 belongs. (belongs to edge 21)</li>
<li>vertices_in_graph hold the vertices that belong to the contracted graph, contracted vertices of vertex 5 and contracted vertices of edge 21.</li>
<li>when selecting the edges, only edges that have the source and the target in that set are the edges belonging to the contracted graph, that is done in the WHERE clause.</li>
</ul>
</div></blockquote>
<p>Visually, looking at the original graph, going from 7 to 13: 7 -&gt; 8 -&gt; 5 -&gt; 10 -&gt; 13, and in the contracted graph, it is also 7 -&gt; 8 -&gt; 5 -&gt; 10 -&gt; 13.
The results, on the contracted graph match the results as if it was done on the original graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
    $$
    WITH

    expand_vertices AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table_vertices_pgr),
    expand7 AS (SELECT contracted_vertices FROM edge_table_vertices_pgr
        WHERE id IN (SELECT id FROM expand_vertices WHERE vertex = 7)),

    expand_edges AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table),
    expand13 AS (SELECT contracted_vertices FROM edge_table
        WHERE id IN (SELECT id FROM expand_edges WHERE vertex = 13)),

    vertices_in_graph AS (
        SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false
        UNION
        SELECT unnest(contracted_vertices) FROM expand13
        UNION
        SELECT unnest(contracted_vertices) FROM expand7)

    SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE source IN (SELECT * FROM vertices_in_graph)
    AND target IN (SELECT * FROM vertices_in_graph)
    $$,
    7, 13, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    7 |    6 |    1 |        0
   2 |        2 |    8 |    7 |    1 |        1
   3 |        3 |    5 |   10 |    1 |        2
   4 |        4 |   10 |   14 |    1 |        3
   5 |        5 |   13 |   -1 |    0 |        4
(5 rows)

</pre></div>
</div>
<p class="rubric">case 4: Source belongs to the contracted graph, while target belongs to an vertex subgraph.</p>
<p>Inspecting the contracted graph above, vertex 3 is part of the contracted graph and vertex 7 belongs to the contracted subgraph of vertex 5. In the following query:</p>
<blockquote>
<div><ul class="simple">
<li>expand7 holds the contracted vertices of vertex where vertex 7 belongs. (belongs to vertex 5)</li>
<li>vertices_in_graph hold the vertices that belong to the contracted graph and the contracted vertices of vertex 5.</li>
<li>when selecting the edges, only edges that have the source and the target in that set are the edges belonging to the contracted graph, that is done in the WHERE clause.</li>
</ul>
</div></blockquote>
<p>Visually, looking at the original graph, going from 3 to 7: 3 -&gt; 2 -&gt; 5 -&gt; 8 -&gt; 7, but in the contracted graph, it is 3 -&gt; 5 -&gt; 8 -&gt; 7.
The results, on the contracted graph do not match the results as if it was done on the original graph. This is because the path contains edge 19 which is added by the contraction algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM  pgr_dijkstra(
    $$
    WITH
    expand_vertices AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table_vertices_pgr),
    expand7 AS (SELECT contracted_vertices FROM edge_table_vertices_pgr
        WHERE id IN (SELECT id FROM expand_vertices WHERE vertex = 7)),
    vertices_in_graph AS (
        SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false
        UNION
        SELECT unnest(contracted_vertices) FROM expand7)
    SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE source IN (SELECT * FROM vertices_in_graph)
    AND target IN (SELECT * FROM vertices_in_graph)
    $$,
    3, 7, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |   19 |    2 |        0
   2 |        2 |    5 |    7 |    1 |        2
   3 |        3 |    8 |    6 |    1 |        3
   4 |        4 |    7 |   -1 |    0 |        4
(4 rows)

</pre></div>
</div>
<p class="rubric">case 5: The path contains an edge added by the contraction algorithm.</p>
<p>In the previous example we can see that the path from vertex 3 to vertex 7 contains an edge which is added by the contraction algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
first_dijkstra AS (
    SELECT * FROM  pgr_dijkstra(
        $$
        WITH
        expand_vertices AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table_vertices_pgr),
        expand7 AS (SELECT contracted_vertices FROM edge_table_vertices_pgr
            WHERE id IN (SELECT id FROM expand_vertices WHERE vertex = 7)),
        vertices_in_graph AS (
            SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false
            UNION
            SELECT unnest(contracted_vertices) FROM expand7)
        SELECT id, source, target, cost, reverse_cost
        FROM edge_table
        WHERE source IN (SELECT * FROM vertices_in_graph)
        AND target IN (SELECT * FROM vertices_in_graph)
        $$,
        3, 7, false))
SELECT edge, contracted_vertices
    FROM first_dijkstra JOIN edge_table
    ON (edge = id)
    WHERE is_contracted = true;
 edge | contracted_vertices 
------+---------------------
   19 | {1,2}
(1 row)

</pre></div>
</div>
<p>Inspecting the contracted graph above, edge 19 should be expanded. In the following query:</p>
<blockquote>
<div><ul class="simple">
<li>first_dijkstra holds the results of the dijkstra query.</li>
<li>edges_to_expand holds the edges added by the contraction algorithm and included in the path.</li>
<li>vertices_in_graph hold the vertices that belong to the contracted graph, vertices of the contracted solution and the contracted vertices of the edges added by the contraction algorithm and included in the contracted solution.</li>
<li>when selecting the edges, only edges that have the source and the target in that set are the edges belonging to the contracted graph, that is done in the WHERE clause.</li>
</ul>
</div></blockquote>
<p>Visually, looking at the original graph, going from 3 to 7: 3 -&gt; 2 -&gt; 5 -&gt; 8 -&gt; 7, and in the contracted graph, it is also 3 -&gt; 2 -&gt; 5 -&gt; 8 -&gt; 7.
The results, on the contracted graph match the results as if it was done on the original graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra($$
    WITH
    -- This returns the results from case 2
    first_dijkstra AS (
        SELECT * FROM  pgr_dijkstra(
            &#39;
            WITH
            expand_vertices AS (SELECT id, unnest(contracted_vertices) AS vertex FROM edge_table_vertices_pgr),
            expand7 AS (SELECT contracted_vertices FROM edge_table_vertices_pgr
                WHERE id IN (SELECT id FROM expand_vertices WHERE vertex = 7)),
            vertices_in_graph AS (
                SELECT id  FROM edge_table_vertices_pgr WHERE is_contracted = false
                UNION
                SELECT unnest(contracted_vertices) FROM expand7)
            SELECT id, source, target, cost, reverse_cost
            FROM edge_table
            WHERE source IN (SELECT * FROM vertices_in_graph)
            AND target IN (SELECT * FROM vertices_in_graph)
            &#39;,
            3, 7, false)),

    -- edges that need expansion and the vertices to be expanded.
    edges_to_expand AS (
        SELECT edge, contracted_vertices
        FROM first_dijkstra JOIN edge_table
        ON (edge = id)
        WHERE is_contracted = true),

    vertices_in_graph AS (
        -- the nodes of the contracted solution
        SELECT node FROM first_dijkstra
        UNION
        -- the nodes of the expanding sections
        SELECT unnest(contracted_vertices) FROM edges_to_expand)

    SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE source IN (SELECT * FROM vertices_in_graph)
    AND target IN (SELECT * FROM vertices_in_graph)
    -- not including the expanded edges
    AND id NOT IN (SELECT edge FROM edges_to_expand)
    $$,
    3, 7, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    2 |    1 |        0
   2 |        2 |    2 |    4 |    1 |        1
   3 |        3 |    5 |    7 |    1 |        2
   4 |        4 |    8 |    6 |    1 |        3
   5 |        5 |    7 |   -1 |    0 |        4
(5 rows)

</pre></div>
</div>
</div>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf">http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf</a></li>
<li><a class="reference external" href="http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf">http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf</a></li>
<li>The queries use <a class="reference internal" href="pgr_contractGraph.html#pgr-contractgraph"><span class="std std-ref">pgr_contractGraph - Experimental</span></a> function and the <a class="reference internal" href="sampledata.html"><span class="doc">Sample Data</span></a> network.</li>
</ul>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v2.5.5.<br/>
      Last updated on Dec 02, 2018.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>