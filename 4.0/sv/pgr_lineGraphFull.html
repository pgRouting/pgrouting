

<!DOCTYPE html>

<html lang="sv" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>pgr_lineGraphFull - Experimentell &#8212; pgRouting Manual (4.0-dev)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=4a28828c" />
    <script src="_static/documentation_options.js?v=32e15c7b"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/page_history.js?v=ee02e9fc"></script>
    <script src="_static/translations.js?v=92a62177"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Sök" href="search.html" />
    <link rel="next" title="Beställning - Familj av funktioner" href="ordering-family.html" />
    <link rel="prev" title="pgr_lineGraph - Föreslagen" href="pgr_lineGraph.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">
          pgRouting</a>
        <span class="navbar-text pull-left"><b>v4.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Exempeldata</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting-koncept</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="routingFunctions.html">Funktionsfamiljer</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Föreslagna funktioner</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="experimental.html">Experimentella funktioner</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Anteckningar för release</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrationsguide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> - Experimentell</a><ul>
<li><a class="reference internal" href="#description">Beskrivning</a></li>
<li><a class="reference internal" href="#signatures">Underskrifter</a></li>
<li><a class="reference internal" href="#parameters">Parametrar</a></li>
<li><a class="reference internal" href="#inner-queries">Inre frågor</a><ul>
<li><a class="reference internal" href="#edges-sql">Kanter SQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result-columns">Resultat kolumner</a></li>
<li><a class="reference internal" href="#additional-examples">Ytterligare exempel</a><ul>
<li><a class="reference internal" href="#the-data">Uppgifterna</a></li>
<li><a class="reference internal" href="#the-transformation">Omvandlingen</a></li>
<li><a class="reference internal" href="#creating-table-that-identifies-transformed-vertices">Skapa tabell som identifierar transformerade toppar</a><ul>
<li><a class="reference internal" href="#store-edge-results">Förvara kantresultat</a></li>
<li><a class="reference internal" href="#create-the-mapping-table">Skapa mappningstabellen</a></li>
<li><a class="reference internal" href="#filling-the-mapping-table">Fylla kartläggningstabellen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-soft-restriction">Lägga till en mjuk begränsning</a><ul>
<li><a class="reference internal" href="#identifying-the-restriction">Identifiering av begränsningen</a></li>
<li><a class="reference internal" href="#adding-a-value-to-the-restriction">Lägga till ett värde till begränsningen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplifying-leaf-vertices">Förenkling av bladhörnpunkter</a><ul>
<li><a class="reference internal" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value">Med hjälp av vertexkartan ger du bladvertices deras ursprungliga värde.</a></li>
<li><a class="reference internal" href="#removing-self-loops-on-leaf-nodes">Ta bort självloopar på bladnoder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-routing-graph">Komplett routningsgraf</a><ul>
<li><a class="reference internal" href="#add-edges-from-the-original-graph">Lägg till kanter från den ursprungliga grafen</a></li>
<li><a class="reference internal" href="#add-the-newly-calculated-edges">Lägg till de nyligen beräknade kanterna</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-routing-graph">Använda routningsgrafen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">Se även</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="pgr_lineGraph.html" title="Previous Chapter: pgr_lineGraph - Föreslagen"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; pgr_lineGraph...</span>
    </a>
  </li>
  <li>
    <a href="ordering-family.html" title="Next Chapter: Beställning - Familj av funktioner"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">Beställning -... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
    <div class="row">
        <div class="body span12 content" role="main">
            <script> document.write(get_history('pgr_lineGraphFull','sv'));  </script>
            
  <div class="line-block" id="index-0">
<div class="line"><br /></div>
</div>
<section id="pgr-linegraphfull-experimental">
<h1><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> - Experimentell<a class="headerlink" href="#pgr-linegraphfull-experimental" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> - Transformerar en given graf till en ny graf där alla hörn från den ursprungliga grafen konverteras till linjegrafer.</p>
<div class="admonition-experimental admonition">
<p class="admonition-title">Experimental</p>
<div class="admonition warning">
<p class="admonition-title">Varning</p>
<p>Experimentella funktioner</p>
<ul class="simple">
<li><p>De är inte officiellt i den aktuella versionen.</p></li>
<li><p>De kommer troligen inte att officiellt vara en del av nästa utgåva:</p>
<ul>
<li><p>Funktionerna får inte använda sig av ANY-INTEGER och ANY-NUMERICAL</p></li>
<li><p>Namnet kan komma att ändras.</p></li>
<li><p>Signaturen kan komma att ändras.</p></li>
<li><p>Funktionaliteten kan komma att ändras.</p></li>
<li><p>pgTap-tester kan saknas.</p></li>
<li><p>Might need c/c++ review.</p></li>
<li><p>Eventuell dokumentation kan behöva skrivas om.</p></li>
<li><p>Det kan behövas mycket feedback från samhället.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<p class="rubric">Tillgänglighet</p>
<ul class="simple">
<li><p>Version 2.6.0</p>
<ul>
<li><p>Ny experimentell funktion.</p></li>
</ul>
</li>
</ul>
<section id="description">
<h2>Beskrivning<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code>, konverterar en ursprunglig riktad graf till en riktad linjegraf genom att konvertera varje vertex till en komplett graf och behålla alla ursprungliga kanter. De nya anslutande kanterna har en kostnad på 0 och går mellan de intilliggande ursprungliga kanterna, med respekt för riktningen.</p>
<p>En möjlig tillämpning av den resulterande grafen är <strong>”routing med två kantbegränsningar”</strong>:</p>
<ul class="simple">
<li><p>Ställer in en kostnad för att använda vertexen vid routing mellan kanter på den anslutande kanten</p></li>
<li><p>Förbjud routing mellan två kanter genom att ta bort den anslutande kanten</p></li>
</ul>
<p>Detta är möjligt eftersom alla korsningar (hörnpunkter) i den ursprungliga grafen nu är kompletta grafer som har en ny kant för varje möjlig sväng över korsningen.</p>
<p>De viktigaste egenskaperna är:</p>
<ul class="simple">
<li><p>Denna funktion är avsedd för <strong>riktade</strong> grafer.</p></li>
<li><p>Resultaten är odefinierade när ett negativt vertex-id används i indatagrafen.</p></li>
<li><p>Resultaten är odefinierade när ett duplicerat kant-ID används i indatagrafen.</p></li>
<li><p>Löptid: TBD</p></li>
</ul>
<p><a class="reference external" href="https://www.boost.org/libs/graph"><img alt="Öka grafen inuti" src="_images/boost-inside.jpeg" style="height: 18px;" /></a> Boost-graf inuti</p>
</section>
<section id="signatures">
<h2>Underskrifter<a class="headerlink" href="#signatures" title="Link to this heading">¶</a></h2>
<p class="rubric">Sammanfattning</p>
<div class="signatures admonition">
<p class="admonition-title"></p>
<div class="line-block">
<div class="line">pgr_lineGraphFull(<a class="reference internal" href="#edges-sql">Kanter SQL</a>)</div>
</div>
<div class="line-block">
<div class="line">Returnerar uppsättning av <code class="docutils literal notranslate"><span class="pre">(seq,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost,</span> <span class="pre">edge)</span></code></div>
<div class="line">ELLER TOM UPPSÄTTNING</div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Fullständig linjegraf av delgraf av kanter <span class="math notranslate nohighlight">\({\4, 7, 8, 10\}\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
 seq | source | target | cost | edge
-----+--------+--------+------+------
   1 |     -1 |      7 |    1 |    4
   2 |      6 |     -1 |    0 |    0
   3 |     -2 |      6 |    1 |   -4
   4 |     -3 |      3 |    1 |   -7
   5 |     -4 |     11 |    1 |    8
   6 |     -5 |      8 |    1 |   10
   7 |      7 |     -2 |    0 |    0
   8 |      7 |     -3 |    0 |    0
   9 |      7 |     -4 |    0 |    0
  10 |      7 |     -5 |    0 |    0
  11 |     -6 |     -2 |    0 |    0
  12 |     -6 |     -3 |    0 |    0
  13 |     -6 |     -4 |    0 |    0
  14 |     -6 |     -5 |    0 |    0
  15 |     -7 |     -2 |    0 |    0
  16 |     -7 |     -3 |    0 |    0
  17 |     -7 |     -4 |    0 |    0
  18 |     -7 |     -5 |    0 |    0
  19 |     -8 |     -2 |    0 |    0
  20 |     -8 |     -3 |    0 |    0
  21 |     -8 |     -4 |    0 |    0
  22 |     -8 |     -5 |    0 |    0
  23 |     -9 |     -6 |    1 |    7
  24 |      3 |     -9 |    0 |    0
  25 |    -10 |     -7 |    1 |   -8
  26 |     11 |    -10 |    0 |    0
  27 |    -11 |     -8 |    1 |  -10
  28 |      8 |    -11 |    0 |    0
(28 rows)

</pre></div>
</div>
</section>
<section id="parameters">
<h2>Parametrar<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#edges-sql">Kanter SQL</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></td>
<td><p><a class="reference internal" href="#edges-sql">Kanter SQL</a> enligt beskrivningen nedan.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="inner-queries">
<h2>Inre frågor<a class="headerlink" href="#inner-queries" title="Link to this heading">¶</a></h2>
<section id="edges-sql">
<h3>Kanter SQL<a class="headerlink" href="#edges-sql" title="Link to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 81">
<colgroup>
<col style="width: 17.7%" />
<col style="width: 17.7%" />
<col style="width: 8.9%" />
<col style="width: 55.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Standard</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare av kanten.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Källa</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare för den första slutpunktsvertexen på kanten.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mål</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare för den andra slutpunktsvertexen på kanten.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><strong>ANY-NUMERISK</strong></p></td>
<td></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">omvända_kostnader</span></code></p></td>
<td><p><strong>ANY-NUMERISK</strong></p></td>
<td><p>-1</p></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>)</p>
<ul class="simple">
<li><p>När negativ: kanten (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>) existerar inte, därför är den inte en del av grafen.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Var:</p>
<dl class="field-list simple">
<dt class="field-odd">ANY-TAL<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p>
</dd>
<dt class="field-even">ANY-NUMERICAL<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>, <code class="docutils literal notranslate"><span class="pre">REAL</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p>
</dd>
</dl>
</section>
</section>
<section id="result-columns">
<h2>Resultat kolumner<a class="headerlink" href="#result-columns" title="Link to this heading">¶</a></h2>
<p>Returnerar uppsättning av <code class="docutils literal notranslate"><span class="pre">(seq,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost,</span> <span class="pre">edge)</span></code></p>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></td>
<td><p>Sekventiellt värde med början från <strong>1</strong>.</p>
<ul class="simple">
<li><p>Ger en lokal identifierare för kanten</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Källa</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p>Identifierar källvertexen för den aktuella kanten.</p>
<ul class="simple">
<li><p>När <cite>negativ</cite>: källan är den omvända kanten i den ursprungliga grafen.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mål</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p>Identifierare av målvertexen för den aktuella kanten.</p>
<ul class="simple">
<li><p>När <cite>negativ</cite>: målet är den omvända kanten i den ursprungliga grafen.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>).</p>
<ul class="simple">
<li><p>När <cite>negativ</cite>: kanten (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>) existerar inte, därför är den inte en del av grafen.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">omvända_kostnader</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>).</p>
<ul class="simple">
<li><p>När <cite>negativ</cite>: kant (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>) finns inte, därför är den inte en del av grafen.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="additional-examples">
<h2>Ytterligare exempel<a class="headerlink" href="#additional-examples" title="Link to this heading">¶</a></h2>
<nav class="contents local" id="innehall">
<ul class="simple">
<li><p><a class="reference internal" href="#the-data" id="id1">Uppgifterna</a></p></li>
<li><p><a class="reference internal" href="#the-transformation" id="id2">Omvandlingen</a></p></li>
<li><p><a class="reference internal" href="#creating-table-that-identifies-transformed-vertices" id="id3">Skapa tabell som identifierar transformerade toppar</a></p>
<ul>
<li><p><a class="reference internal" href="#store-edge-results" id="id4">Förvara kantresultat</a></p></li>
<li><p><a class="reference internal" href="#create-the-mapping-table" id="id5">Skapa mappningstabellen</a></p></li>
<li><p><a class="reference internal" href="#filling-the-mapping-table" id="id6">Fylla kartläggningstabellen</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-soft-restriction" id="id7">Lägga till en mjuk begränsning</a></p>
<ul>
<li><p><a class="reference internal" href="#identifying-the-restriction" id="id8">Identifiering av begränsningen</a></p></li>
<li><p><a class="reference internal" href="#adding-a-value-to-the-restriction" id="id9">Lägga till ett värde till begränsningen</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#simplifying-leaf-vertices" id="id10">Förenkling av bladhörnpunkter</a></p>
<ul>
<li><p><a class="reference internal" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value" id="id11">Med hjälp av vertexkartan ger du bladvertices deras ursprungliga värde.</a></p></li>
<li><p><a class="reference internal" href="#removing-self-loops-on-leaf-nodes" id="id12">Ta bort självloopar på bladnoder</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#complete-routing-graph" id="id13">Komplett routningsgraf</a></p>
<ul>
<li><p><a class="reference internal" href="#add-edges-from-the-original-graph" id="id14">Lägg till kanter från den ursprungliga grafen</a></p></li>
<li><p><a class="reference internal" href="#add-the-newly-calculated-edges" id="id15">Lägg till de nyligen beräknade kanterna</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-routing-graph" id="id16">Använda routningsgrafen</a></p></li>
</ul>
</nav>
<ul class="simple">
<li><p>Exemplen i detta avsnitt är baserade på <a class="reference internal" href="sampledata.html"><span class="doc">Exempeldata</span></a>-nätverket.</p></li>
<li><p>Exemplen inkluderar delgrafen som innehåller kanterna 4, 7, 8 och 10 med <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code>.</p></li>
</ul>
<section id="the-data">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Uppgifterna</a><a class="headerlink" href="#the-data" title="Link to this heading">¶</a></h3>
<p>Detta exempel visar hur denna grafomvandling fungerar för att skapa ytterligare kanter för varje möjlig vändning i en graf.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span>
<span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span>
<span class="o">----+--------+--------+------+--------------</span>
  <span class="mi">4</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<div class="line-block">
<div class="line"><img alt="första" class="align-middle" src="_images/original.png" /></div>
</div>
</section>
<section id="the-transformation">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Omvandlingen</a><a class="headerlink" href="#the-transformation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
 seq | source | target | cost | edge
-----+--------+--------+------+------
   1 |     -1 |      7 |    1 |    4
   2 |      6 |     -1 |    0 |    0
   3 |     -2 |      6 |    1 |   -4
   4 |     -3 |      3 |    1 |   -7
   5 |     -4 |     11 |    1 |    8
   6 |     -5 |      8 |    1 |   10
   7 |      7 |     -2 |    0 |    0
   8 |      7 |     -3 |    0 |    0
   9 |      7 |     -4 |    0 |    0
  10 |      7 |     -5 |    0 |    0
  11 |     -6 |     -2 |    0 |    0
  12 |     -6 |     -3 |    0 |    0
  13 |     -6 |     -4 |    0 |    0
  14 |     -6 |     -5 |    0 |    0
  15 |     -7 |     -2 |    0 |    0
  16 |     -7 |     -3 |    0 |    0
  17 |     -7 |     -4 |    0 |    0
  18 |     -7 |     -5 |    0 |    0
  19 |     -8 |     -2 |    0 |    0
  20 |     -8 |     -3 |    0 |    0
  21 |     -8 |     -4 |    0 |    0
  22 |     -8 |     -5 |    0 |    0
  23 |     -9 |     -6 |    1 |    7
  24 |      3 |     -9 |    0 |    0
  25 |    -10 |     -7 |    1 |   -8
  26 |     11 |    -10 |    0 |    0
  27 |    -11 |     -8 |    1 |  -10
  28 |      8 |    -11 |    0 |    0
(28 rows)

</pre></div>
</div>
<div class="line-block">
<div class="line"><img alt="sekund" class="align-middle" src="_images/transformation.png" /></div>
</div>
<p>I den transformerade grafen finns alla kanter från den ursprungliga grafen kvar (gult), men vi har nu ytterligare kanter för varje sväng som skulle kunna göras över toppunkt 7 (orange).</p>
</section>
<section id="creating-table-that-identifies-transformed-vertices">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Skapa tabell som identifierar transformerade toppar</a><a class="headerlink" href="#creating-table-that-identifies-transformed-vertices" title="Link to this heading">¶</a></h3>
<p>Varje toppunkt i den transformerade grafen skapas genom att dela upp toppunkterna i den ursprungliga grafen. Om inte en vertex i den ursprungliga grafen är en bladvertex kommer den att generera mer än en vertex i den transformerade grafen. Ett av de nyskapade vertexen i den transformerade grafen får samma vertexidentifierare som det vertex som det skapades från i den ursprungliga grafen, men resten av de nyskapade vertexen får negativa vertexidentifierare.</p>
<p>Här följer ett exempel på hur man genererar en tabell som mappar id:n för de nyskapade topparna med den ursprungliga topp som de skapades från</p>
<section id="store-edge-results">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Förvara kantresultat</a><a class="headerlink" href="#store-edge-results" title="Link to this heading">¶</a></h4>
<p>Det första steget är att lagra resultatet av anropet <code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> i en tabell</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq AS id, source, target, cost, edge
INTO lineGraph_edges
FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
SELECT 28
</pre></div>
</div>
</section>
<section id="create-the-mapping-table">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Skapa mappningstabellen</a><a class="headerlink" href="#create-the-mapping-table" title="Link to this heading">¶</a></h4>
<p>Från den ursprungliga grafens toppunktsinformation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">NULL</span><span class="p">::</span><span class="n">BIGINT</span> <span class="n">original_id</span>
<span class="n">INTO</span> <span class="n">vertex_map</span>
<span class="n">FROM</span> <span class="n">vertices</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Lägg till de nya hörnen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>INSERT INTO vertex_map (id)
(SELECT id
FROM pgr_extractVertices(
  $$SELECT id, source, target FROM lineGraph_edges$$) WHERE id &lt; 0);
INSERT 0 11
</pre></div>
</div>
</section>
<section id="filling-the-mapping-table">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Fylla kartläggningstabellen</a><a class="headerlink" href="#filling-the-mapping-table" title="Link to this heading">¶</a></h4>
<p>De positiva vertexidentifierarna är de ursprungliga identifierarna</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertex_map</span>
<span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="nb">id</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Inspektion av kartan över hörnpunkter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="mi">17</span> <span class="o">|</span>          <span class="mi">17</span>
  <span class="mi">16</span> <span class="o">|</span>          <span class="mi">16</span>
  <span class="mi">15</span> <span class="o">|</span>          <span class="mi">15</span>
  <span class="mi">14</span> <span class="o">|</span>          <span class="mi">14</span>
  <span class="mi">13</span> <span class="o">|</span>          <span class="mi">13</span>
  <span class="mi">12</span> <span class="o">|</span>          <span class="mi">12</span>
  <span class="mi">11</span> <span class="o">|</span>          <span class="mi">11</span>
  <span class="mi">10</span> <span class="o">|</span>          <span class="mi">10</span>
   <span class="mi">9</span> <span class="o">|</span>           <span class="mi">9</span>
   <span class="mi">8</span> <span class="o">|</span>           <span class="mi">8</span>
   <span class="mi">7</span> <span class="o">|</span>           <span class="mi">7</span>
   <span class="mi">6</span> <span class="o">|</span>           <span class="mi">6</span>
   <span class="mi">5</span> <span class="o">|</span>           <span class="mi">5</span>
   <span class="mi">4</span> <span class="o">|</span>           <span class="mi">4</span>
   <span class="mi">3</span> <span class="o">|</span>           <span class="mi">3</span>
   <span class="mi">2</span> <span class="o">|</span>           <span class="mi">2</span>
   <span class="mi">1</span> <span class="o">|</span>           <span class="mi">1</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>
<span class="p">(</span><span class="mi">28</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Självslingorna uppstår när det inte kostar något att resa till ”målet” och källan har ett ursprungligt värde.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">source</span> <span class="n">AS</span> <span class="n">targets_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span>
  <span class="n">WHERE</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">targets_original_id</span>
<span class="o">----+--------+--------+------+------+---------------------</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">6</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
  <span class="mi">9</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
 <span class="mi">24</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">3</span>
 <span class="mi">26</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                  <span class="mi">11</span>
 <span class="mi">28</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">8</span>
<span class="p">(</span><span class="mi">8</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Uppdatering av värden från självloopar</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">self_loops</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="n">AS</span> <span class="n">targets_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span>
  <span class="n">WHERE</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertex_map</span> <span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="n">targets_original_id</span>
<span class="n">FROM</span> <span class="n">self_loops</span> <span class="n">WHERE</span> <span class="n">target</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Inspektera tabellen över hörnpunkter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>           <span class="mi">6</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>           <span class="mi">3</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>          <span class="mi">11</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>           <span class="mi">8</span>
<span class="p">(</span><span class="mi">11</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Uppdatering från inre självloopar</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">assigned_vertices</span>
<span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">original_id</span>
  <span class="n">FROM</span> <span class="n">vertex_map</span>
  <span class="n">WHERE</span> <span class="n">original_id</span> <span class="n">IS</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">),</span>
<span class="n">cross_edges</span>
<span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">original_id</span> <span class="n">AS</span> <span class="n">source_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span> <span class="n">AS</span> <span class="n">e</span>
  <span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">ON</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">source</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">assigned_vertices</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertex_map</span> <span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="n">source_original_id</span>
<span class="n">FROM</span> <span class="n">cross_edges</span> <span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Inspektion av kartan över hörnpunkter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>           <span class="mi">6</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>           <span class="mi">3</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>          <span class="mi">11</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>           <span class="mi">8</span>
<span class="p">(</span><span class="mi">11</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="adding-a-soft-restriction">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Lägga till en mjuk begränsning</a><a class="headerlink" href="#adding-a-soft-restriction" title="Link to this heading">¶</a></h3>
<p>En mjuk begränsning som går från toppunkt 6 till toppunkt 3 med hjälp av kanterna 4 -&gt; 7 önskas.</p>
<section id="identifying-the-restriction">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Identifiering av begränsningen</a><a class="headerlink" href="#identifying-the-restriction" title="Link to this heading">¶</a></h4>
<p>Kör en <a class="reference internal" href="pgr_dijkstraNear.html"><span class="doc">pgr_dijkstraNear - Förslag</span></a> kanten med kostnad 0, kant 8, är där kostnaden kommer att ökas</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, path_seq, start_vid, end_vid, node, original_id, edge, cost, agg_cost
FROM (SELECT * FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))) dn
JOIN vertex_map AS v1 ON (node = v1.id);
 seq | path_seq | start_vid | end_vid | node | original_id | edge | cost | agg_cost
-----+----------+-----------+---------+------+-------------+------+------+----------
   3 |        3 |        -1 |       3 |   -3 |           7 |    4 |    1 |        1
   1 |        1 |        -1 |       3 |   -1 |           6 |    1 |    1 |        0
   4 |        4 |        -1 |       3 |    3 |           3 |   -1 |    0 |        2
   2 |        2 |        -1 |       3 |    7 |           7 |    8 |    0 |        1
(4 rows)

</pre></div>
</div>
<p>Kanten som ska ändras är <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">cost</span> <span class="pre">=</span> <span class="pre">0</span> <span class="pre">AND</span> <span class="pre">seq</span> <span class="pre">!=</span> <span class="pre">1</span> <span class="pre">AND</span> <span class="pre">edge</span> <span class="pre">!=</span> <span class="pre">-1</span></code> från den föregående frågan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT edge FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))
WHERE cost = 0 AND seq != 1 AND edge != -1;
 edge
------
    8
(1 row)

</pre></div>
</div>
</section>
<section id="adding-a-value-to-the-restriction">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Lägga till ett värde till begränsningen</a><a class="headerlink" href="#adding-a-value-to-the-restriction" title="Link to this heading">¶</a></h4>
<p>Uppdatering av kostnaden till kanten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>UPDATE lineGraph_edges
SET cost = 100
WHERE id IN (
SELECT edge FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))
WHERE cost = 0 AND seq != 1 AND edge != -1);
UPDATE 1
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Omdirigering från <span class="math notranslate nohighlight">\(6\)</span> till <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<p>Nu använder rutten inte kant 8 och gör en U-sväng på en bladvertex.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstraNear(
    $$SELECT * FROM lineGraph_edges$$,
    (SELECT array_agg(id) FROM vertex_map where original_id = 6),
    (SELECT array_agg(id) FROM vertex_map where original_id = 3)))
SELECT seq, path_seq, start_vid, end_vid, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | start_vid | end_vid | node | original_id | edge | cost | agg_cost
-----+----------+-----------+---------+------+-------------+------+------+----------
   1 |        1 |        -1 |       3 |   -1 |           6 |    1 |    1 |        0
   2 |        2 |        -1 |       3 |    7 |           7 |   10 |    0 |        1
   3 |        3 |        -1 |       3 |   -5 |           7 |    6 |    1 |        1
   4 |        4 |        -1 |       3 |    8 |           8 |   28 |    0 |        2
   5 |        5 |        -1 |       3 |  -11 |           8 |   27 |    1 |        2
   6 |        6 |        -1 |       3 |   -8 |           7 |   20 |    0 |        3
   7 |        7 |        -1 |       3 |   -3 |           7 |    4 |    1 |        3
   8 |        8 |        -1 |       3 |    3 |           3 |   -1 |    0 |        4
(8 rows)

</pre></div>
</div>
</section>
</section>
<section id="simplifying-leaf-vertices">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Förenkling av bladhörnpunkter</a><a class="headerlink" href="#simplifying-leaf-vertices" title="Link to this heading">¶</a></h3>
<p>I det här exemplet tillkommer ingen extra kostnad för att passera en bladvertex.</p>
<section id="using-the-vertex-map-give-the-leaf-verices-their-original-value">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Med hjälp av vertexkartan ger du bladvertices deras ursprungliga värde.</a><a class="headerlink" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value" title="Link to this heading">¶</a></h4>
<p>På källkolumnen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">u_turns</span> <span class="n">AS</span> <span class="p">(</span>
<span class="n">SELECT</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">eid</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">linegraph_edges</span> <span class="k">as</span> <span class="n">e</span>
<span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v1</span> <span class="n">ON</span> <span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">AND</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">UPDATE</span> <span class="n">lineGraph_edges</span>
<span class="n">SET</span> <span class="n">source</span> <span class="o">=</span> <span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">u_turns</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
<p>På målkolumnen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">u_turns</span> <span class="n">AS</span> <span class="p">(</span>
<span class="n">SELECT</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">eid</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">linegraph_edges</span> <span class="k">as</span> <span class="n">e</span>
<span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v1</span> <span class="n">ON</span> <span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">AND</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">UPDATE</span> <span class="n">lineGraph_edges</span>
<span class="n">SET</span> <span class="n">target</span> <span class="o">=</span> <span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">u_turns</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
</section>
<section id="removing-self-loops-on-leaf-nodes">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Ta bort självloopar på bladnoder</a><a class="headerlink" href="#removing-self-loops-on-leaf-nodes" title="Link to this heading">¶</a></h4>
<p>Bladnodernas självslingor är</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">linegraph_edges</span>
<span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="n">target</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">edge</span>
<span class="o">----+--------+--------+------+------</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">24</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">26</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">28</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Som kan tas bort</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">linegraph_edges</span>
<span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="n">target</span><span class="p">;</span>
<span class="n">DELETE</span> <span class="mi">4</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Omdirigering från <span class="math notranslate nohighlight">\(6\)</span> till <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<p>Routing kan nu göras med hjälp av originalvertices id med <a class="reference internal" href="pgr_dijkstra.html"><span class="doc">pgr_dijkstra</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM lineGraph_edges$$, 6, 3))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    6 |           6 |    1 |    1 |        0
   2 |        2 |    7 |           7 |    9 |    0 |        1
   3 |        3 |   -4 |           7 |    5 |    1 |        1
   4 |        4 |   11 |          11 |   25 |    1 |        2
   5 |        5 |   -7 |           7 |   16 |    0 |        3
   6 |        6 |   -3 |           7 |    4 |    1 |        3
   7 |        7 |    3 |           3 |   -1 |    0 |        4
(7 rows)

</pre></div>
</div>
</section>
</section>
<section id="complete-routing-graph">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Komplett routningsgraf</a><a class="headerlink" href="#complete-routing-graph" title="Link to this heading">¶</a></h3>
<section id="add-edges-from-the-original-graph">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Lägg till kanter från den ursprungliga grafen</a><a class="headerlink" href="#add-edges-from-the-original-graph" title="Link to this heading">¶</a></h4>
<p>Lägg till alla kanter som inte är involverade i linjediagramprocessen i den nya tabellen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span>
<span class="n">INTO</span> <span class="n">new_graph</span> <span class="kn">from</span> <span class="nn">edges</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">14</span>
</pre></div>
</div>
<p>Vissa administrativa uppgifter för att få nya identifierare för kanterna</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">new_graph_id_seq</span><span class="p">;</span>
<span class="n">CREATE</span> <span class="n">SEQUENCE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">new_graph</span> <span class="n">ALTER</span> <span class="n">COLUMN</span> <span class="nb">id</span> <span class="n">SET</span> <span class="n">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;new_graph_id_seq&#39;</span><span class="p">);</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">new_graph</span> <span class="n">ALTER</span> <span class="n">COLUMN</span> <span class="nb">id</span> <span class="n">SET</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">SEQUENCE</span> <span class="n">new_graph_id_seq</span> <span class="n">OWNED</span> <span class="n">BY</span> <span class="n">new_graph</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">SEQUENCE</span>
<span class="n">SELECT</span> <span class="n">setval</span><span class="p">(</span><span class="s1">&#39;new_graph_id_seq&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">new_graph</span><span class="p">));</span>
 <span class="n">setval</span>
<span class="o">--------</span>
     <span class="mi">18</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="add-the-newly-calculated-edges">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Lägg till de nyligen beräknade kanterna</a><a class="headerlink" href="#add-the-newly-calculated-edges" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">new_graph</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="n">FROM</span> <span class="n">lineGraph_edges</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">24</span>
</pre></div>
</div>
</section>
</section>
<section id="using-the-routing-graph">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Använda routningsgrafen</a><a class="headerlink" href="#using-the-routing-graph" title="Link to this heading">¶</a></h3>
<p>När du använder den här metoden för routning med mjuka begränsningar kommer det att finnas uturns</p>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Omdirigering från <span class="math notranslate nohighlight">\(6\)</span> till <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM new_graph$$, 6, 3))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    6 |           6 |   35 |    1 |        0
   2 |        2 |    7 |           7 |   20 |    0 |        1
   3 |        3 |   -4 |           7 |   41 |    1 |        1
   4 |        4 |   11 |          11 |   37 |    1 |        2
   5 |        5 |   -7 |           7 |   27 |    0 |        3
   6 |        6 |   -3 |           7 |   40 |    1 |        3
   7 |        7 |    3 |           3 |   -1 |    0 |        4
(7 rows)

</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Routning från <span class="math notranslate nohighlight">\(5\)</span> till <span class="math notranslate nohighlight">\(1\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM new_graph$$, 5, 1))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    5 |           5 |    1 |    1 |        0
   2 |        2 |    6 |           6 |   35 |    1 |        1
   3 |        3 |    7 |           7 |   20 |    0 |        2
   4 |        4 |   -4 |           7 |   41 |    1 |        2
   5 |        5 |   11 |          11 |   37 |    1 |        3
   6 |        6 |   -7 |           7 |   27 |    0 |        4
   7 |        7 |   -3 |           7 |   40 |    1 |        4
   8 |        8 |    3 |           3 |    6 |    1 |        5
   9 |        9 |    1 |           1 |   -1 |    0 |        6
(9 rows)

</pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>Se även<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Line_graph">https://en.wikipedia.org/wiki/Line_graph</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Complete_graph">https://en.wikipedia.org/wiki/Complete_graph</a></p></li>
</ul>
<p class="rubric">Index och tabeller</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Söksida</span></a></p></li>
</ul>
</section>
</section>


        </div>
          
    </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v4.0.<br/>
      Senast uppdaterad aug. 28, 2025.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>