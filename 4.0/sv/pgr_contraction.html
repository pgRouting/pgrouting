

<!DOCTYPE html>

<html lang="sv" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>pgr_kontraktion &#8212; pgRouting Manual (4.0-dev)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=4a28828c" />
    <script src="_static/documentation_options.js?v=32e15c7b"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/page_history.js?v=ee02e9fc"></script>
    <script src="_static/translations.js?v=92a62177"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Sök" href="search.html" />
    <link rel="next" title="pgr_contractionDeadEnd - Förslag" href="pgr_contractionDeadEnd.html" />
    <link rel="prev" title="Sammandragning - Familj av funktioner" href="contraction-family.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">
          pgRouting</a>
        <span class="navbar-text pull-left"><b>v4.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Exempeldata</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting-koncept</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="routingFunctions.html">Funktionsfamiljer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Föreslagna funktioner</a></li>
<li class="toctree-l1"><a class="reference internal" href="experimental.html">Experimentella funktioner</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Anteckningar för release</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrationsguide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">pgr_kontraktion</span></code></a><ul>
<li><a class="reference internal" href="#description">Beskrivning</a></li>
<li><a class="reference internal" href="#signatures">Underskrifter</a></li>
<li><a class="reference internal" href="#parameters">Parametrar</a><ul>
<li><a class="reference internal" href="#optional-parameters">Valfria parametrar</a></li>
<li><a class="reference internal" href="#contraction-optional-parameters">Sammandragning valfria parametrar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inner-queries">Inre frågor</a><ul>
<li><a class="reference internal" href="#edges-sql">Kanter SQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result-columns">Resultat kolumner</a></li>
<li><a class="reference internal" href="#additional-examples">Ytterligare exempel</a><ul>
<li><a class="reference internal" href="#only-dead-end-contraction">Endast återvändsgränd kontraktion</a></li>
<li><a class="reference internal" href="#only-linear-contraction">Endast linjär sammandragning</a></li>
<li><a class="reference internal" href="#the-cycle">Cykeln</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contracting-sample-data">Upphandling av provdata</a><ul>
<li><a class="reference internal" href="#construction-of-the-graph-in-the-database">Konstruktion av grafen i databasen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-process-to-create-the-contraction-graph-on-the-database">Processen för att skapa sammandragningsgrafen i databasen:</a><ul>
<li><a class="reference internal" href="#add-additional-columns">Lägg till ytterligare kolumner</a></li>
<li><a class="reference internal" href="#store-contraction-information">Lagra information om sammandragning</a></li>
<li><a class="reference internal" href="#update-the-edges-and-vertices-tables">Uppdatera tabellerna för kanter och toppar</a></li>
<li><a class="reference internal" href="#the-contracted-graph">Den kontraherade grafen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-contracted-graph">Använda den kontraherade grafen</a></li>
<li><a class="reference internal" href="#see-also">Se även</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="contraction-family.html" title="Previous Chapter: Sammandragning - Familj av funktioner"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; Sammandragnin...</span>
    </a>
  </li>
  <li>
    <a href="pgr_contractionDeadEnd.html" title="Next Chapter: pgr_contractionDeadEnd - Förslag"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">pgr_contracti... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
    <div class="row">
        <div class="body span12 content" role="main">
            <script> document.write(get_history('pgr_contraction','sv'));  </script>
            
  <div class="line-block" id="index-0">
<div class="line"><br /></div>
</div>
<section id="pgr-contraction">
<h1><code class="docutils literal notranslate"><span class="pre">pgr_kontraktion</span></code><a class="headerlink" href="#pgr-contraction" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pgr_contraction</span></code> - Utför grafkontraktion och returnerar de kontraherade topparna och kanterna.</p>
<p class="rubric">Tillgänglighet</p>
<p class="rubric">Version 4.0.0</p>
<ul class="simple">
<li><p>Förändring på gång, signaturer inte längre tillgängliga:</p>
<ul>
<li><p>pgr_contraction(text,bigint[],integer,bigint[],boolean)</p></li>
</ul>
</li>
</ul>
<p class="rubric">Version 3.8.0</p>
<ul class="simple">
<li><p>Ny signatur:</p>
<ul>
<li><p>Den tidigare obligatoriska parametern <strong>Contraction order</strong> är nu valfri med namnet <code class="docutils literal notranslate"><span class="pre">methods</span></code>.</p></li>
<li><p>Nytt namn och ordning på valfria parametrar.</p></li>
</ul>
</li>
<li><p>Föråldrad signatur pgr_contraction(text,bigint[],integer,bigint[],boolean)</p></li>
</ul>
<p class="rubric">Version 3.0.0</p>
<ul class="simple">
<li><p>Ändring av resultatkolumner: <code class="docutils literal notranslate"><span class="pre">seq</span></code> tas bort</p></li>
<li><p>Namnändring från <code class="docutils literal notranslate"><span class="pre">pgr_contractGraph</span></code></p></li>
<li><p>Buggfixar</p></li>
<li><p>Funktion befordrad till tjänsteman.</p></li>
</ul>
<p class="rubric">Version 2.3.0</p>
<ul class="simple">
<li><p>Ny experimentell funktion.</p></li>
</ul>
<section id="description">
<h2>Beskrivning<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Kontraktion minskar storleken på grafen genom att ta bort några av topparna och kanterna och till exempel lägga till kanter som representerar en sekvens av ursprungliga kanter, vilket minskar den totala tid och det utrymme som används i grafalgoritmer.</p>
<p>De viktigaste egenskaperna är:</p>
<ul class="simple">
<li><p>Processen utförs endast på kanter med positiva kostnader.</p></li>
<li><p>Returnerar inte hela den kontraherade grafen.</p>
<ul>
<li><p>Endast ändringar i diagrammet returneras.</p></li>
</ul>
</li>
<li><p>De returnerade värdena inkluderar:</p>
<ul>
<li><p>De nya kanterna som genereras av linjär sammandragning.</p></li>
<li><p>De modifierade topparna som genereras av sammandragning av återvändsgränder.</p></li>
</ul>
</li>
<li><p>De returnerade värdena är ordnade enligt följande:</p>
<ul>
<li><p>kolumn <code class="docutils literal notranslate"><span class="pre">id</span></code> stigande när det är en modifierad vertex.</p></li>
<li><p>kolumn <code class="docutils literal notranslate"><span class="pre">id</span></code> med negativa tal fallande när det är en ny kant.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>För närvarande finns det två typer av sammandragningsmetoder som ingår i denna funktion:</p>
<ul>
<li><p>Kontraktion för återvändsgränd. Se <a class="reference internal" href="pgr_contractionDeadEnd.html"><span class="doc">pgr_contractionDeadEnd - Förslag</span></a>.</p></li>
<li><p>Linjär sammandragning. Se <a class="reference internal" href="pgr_contractionLinear.html"><span class="doc">pgr_contractionLinear - Föreslagen</span></a>.</p></li>
</ul>
</li>
</ul>
<p><a class="reference external" href="https://www.boost.org/libs/graph"><img alt="Öka grafen inuti" src="_images/boost-inside.jpeg" style="height: 18px;" /></a> Boost-graf inuti</p>
</section>
<section id="signatures">
<h2>Underskrifter<a class="headerlink" href="#signatures" title="Link to this heading">¶</a></h2>
<div class="signatures admonition">
<p class="admonition-title"></p>
<div class="line-block">
<div class="line">pgr_contraction(<a class="reference internal" href="#edges-sql">Kanter SQL</a>, [<strong>options</strong>])</div>
</div>
<div class="line-block">
<div class="line"><strong>options:</strong> <code class="docutils literal notranslate"><span class="pre">[directed,</span> <span class="pre">methods,</span> <span class="pre">cycles,</span> <span class="pre">forbidden]</span></code></div>
<div class="line">Returnerar uppsättning av <code class="docutils literal notranslate"><span class="pre">(type,</span> <span class="pre">id,</span> <span class="pre">contracted_vertices,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost)</span></code></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Exempel<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dead end och linjär sammandragning i den ordningen på en odelad graf.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
 <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span>
<span class="o">------+----+---------------------+--------+--------+------</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>                 <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>               <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span> <span class="mi">14</span> <span class="o">|</span> <span class="p">{</span><span class="mi">13</span><span class="p">}</span>                <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="parameters">
<h2>Parametrar<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#edges-sql">Kanter SQL</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></td>
<td><p><a class="reference internal" href="#edges-sql">Kanter SQL</a> enligt beskrivningen nedan.</p></td>
</tr>
</tbody>
</table>
<section id="optional-parameters">
<h3>Valfria parametrar<a class="headerlink" href="#optional-parameters" title="Link to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Standard</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">riktad</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
<td><ul class="simple">
<li><p>När <code class="docutils literal notranslate"><span class="pre">true</span></code> anses grafen vara <cite>Directed`</cite></p></li>
<li><p>När den är <code class="docutils literal notranslate"><span class="pre">falsk</span></code> betraktas grafen som <cite>Ondirected`</cite>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="contraction-optional-parameters">
<h3>Sammandragning valfria parametrar<a class="headerlink" href="#contraction-optional-parameters" title="Link to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Standard</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">metoder</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INTEGER[]`</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ARRAY[1,2]</span></code></p></td>
<td><p>Beställde sammandragningsoperationer.</p>
<ul class="simple">
<li><p>1 = Kontraktion i återvändsgränd</p></li>
<li><p>2 = Linjär sammandragning</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cykler</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p>Antal gånger som sammandragningsmetoderna ska utföras.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">förbjudet</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT[]`</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ARRAY[]::BIGINT[]`</span></code></p></td>
<td><p>Identifierare av hörn som är förbjudna för sammandragning.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="inner-queries">
<h2>Inre frågor<a class="headerlink" href="#inner-queries" title="Link to this heading">¶</a></h2>
<section id="edges-sql">
<h3>Kanter SQL<a class="headerlink" href="#edges-sql" title="Link to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 81">
<colgroup>
<col style="width: 17.7%" />
<col style="width: 17.7%" />
<col style="width: 8.9%" />
<col style="width: 55.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Standard</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare av kanten.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Källa</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare för den första slutpunktsvertexen på kanten.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mål</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifierare för den andra slutpunktsvertexen på kanten.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><strong>ANY-NUMERISK</strong></p></td>
<td></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">omvända_kostnader</span></code></p></td>
<td><p><strong>ANY-NUMERISK</strong></p></td>
<td><p>-1</p></td>
<td><p>Kantvikt (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>)</p>
<ul class="simple">
<li><p>När negativ: kanten (<code class="docutils literal notranslate"><span class="pre">mål</span></code>, <code class="docutils literal notranslate"><span class="pre">källa</span></code>) existerar inte, därför är den inte en del av grafen.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Var:</p>
<dl class="field-list simple">
<dt class="field-odd">ANY-TAL<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p>
</dd>
<dt class="field-even">ANY-NUMERICAL<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>, <code class="docutils literal notranslate"><span class="pre">REAL</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p>
</dd>
</dl>
</section>
</section>
<section id="result-columns">
<h2>Resultat kolumner<a class="headerlink" href="#result-columns" title="Link to this heading">¶</a></h2>
<p>Returnerar uppsättning av <code class="docutils literal notranslate"><span class="pre">(type,</span> <span class="pre">id,</span> <span class="pre">contracted_vertices,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost)</span></code></p>
<p>Funktionen returnerar en enda rad. Kolumnerna i raden är:</p>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typ</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></td>
<td><p>Typ av rad.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">v</span></code> när raden är en vertex.</p>
<ul>
<li><p>Kolumnen <code class="docutils literal notranslate"><span class="pre">id</span></code> har ett positivt värde.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code> när raden är en kant.</p>
<ul>
<li><p>Kolumnen <code class="docutils literal notranslate"><span class="pre">id</span></code> har ett negativt värde.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p>Alla siffror i denna kolumn är <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code></p>
<ul class="simple">
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’v’</strong>.</p>
<ul>
<li><p>Identifierare för det modifierade toppunktet.</p></li>
</ul>
</li>
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’e’</strong>.</p>
<ul>
<li><p>Minskande sekvens med början från <strong>-1</strong>.</p></li>
<li><p>Representerar ett pseudo-id som inte ingår i uppsättningen av ursprungliga kanter.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>”kontrakterade vertikaler</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ARRAY[BIGINT]</span></code></p></td>
<td><p>Array med identifierare för kontrakterade vertex.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Källa</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><ul class="simple">
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’v’</strong>: <span class="math notranslate nohighlight">\(-1\)</span></p></li>
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’e’</strong>: Identifierare av källvertexen för den aktuella kanten (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>).</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mål</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><ul class="simple">
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’v’</strong>: <span class="math notranslate nohighlight">\(-1\)</span></p></li>
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’e’</strong>: Identifierare av målvertexen för den aktuella kanten (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>).</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><ul class="simple">
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’v’</strong>: <span class="math notranslate nohighlight">\(-1\)</span></p></li>
<li><p>När <code class="docutils literal notranslate"><span class="pre">typ</span></code> = <strong>’e’</strong>: Vikt för den aktuella kanten (<code class="docutils literal notranslate"><span class="pre">källa</span></code>, <code class="docutils literal notranslate"><span class="pre">mål</span></code>).</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="additional-examples">
<h2>Ytterligare exempel<a class="headerlink" href="#additional-examples" title="Link to this heading">¶</a></h2>
<nav class="contents local" id="innehall">
<ul class="simple">
<li><p><a class="reference internal" href="#only-dead-end-contraction" id="id3">Endast återvändsgränd kontraktion</a></p></li>
<li><p><a class="reference internal" href="#only-linear-contraction" id="id4">Endast linjär sammandragning</a></p></li>
<li><p><a class="reference internal" href="#the-cycle" id="id5">Cykeln</a></p></li>
</ul>
</nav>
<section id="only-dead-end-contraction">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Endast återvändsgränd kontraktion</a><a class="headerlink" href="#only-dead-end-contraction" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">contracted_vertices</span> <span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span>
  <span class="n">methods</span> <span class="o">=&gt;</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span>
<span class="o">------+----+---------------------</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">}</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="p">{</span><span class="mi">9</span><span class="p">}</span>
 <span class="n">v</span>    <span class="o">|</span> <span class="mi">14</span> <span class="o">|</span> <span class="p">{</span><span class="mi">13</span><span class="p">}</span>
<span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="only-linear-contraction">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Endast linjär sammandragning</a><a class="headerlink" href="#only-linear-contraction" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span>
  <span class="n">methods</span> <span class="o">=&gt;</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
 <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span>
<span class="o">------+----+---------------------+--------+--------+------</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">}</span>                 <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">}</span>                 <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>    <span class="mi">2</span>
<span class="p">(</span><span class="mi">2</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="the-cycle">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Cykeln</a><a class="headerlink" href="#the-cycle" title="Link to this heading">¶</a></h3>
<p>Kontrahering av en graf kan göras med mer än en operation. Ordningen på operationerna påverkar den resulterande kontraherade grafen, efter att ha tillämpat en operation ändras uppsättningen toppar som kan kontraheras med en annan operation.</p>
<p>Denna implementation cyklar <code class="docutils literal notranslate"><span class="pre">cyklar</span></code> gånger genom <code class="docutils literal notranslate"><span class="pre">metoderna</span></code> .</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span>
<span class="n">do</span> <span class="n">max_cycles</span> <span class="n">times</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">operation</span> <span class="ow">in</span> <span class="n">operations_order</span><span class="p">)</span>
     <span class="p">{</span> <span class="n">do</span> <span class="n">operation</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="contracting-sample-data">
<h2>Upphandling av provdata<a class="headerlink" href="#contracting-sample-data" title="Link to this heading">¶</a></h2>
<p>I det här avsnittet visas exempel på hur man bygger upp och använder en kontraherad graf.</p>
<ul class="simple">
<li><p><a class="reference internal" href="sampledata.html"><span class="doc">Exempeldata</span></a> för en enkelriktad graf används</p></li>
<li><p>först en operation i en återvändsgränd och därefter en linjär operation.</p></li>
</ul>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#construction-of-the-graph-in-the-database" id="id6">Konstruktion av grafen i databasen</a></p></li>
</ul>
</nav>
<section id="construction-of-the-graph-in-the-database">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Konstruktion av grafen i databasen</a><a class="headerlink" href="#construction-of-the-graph-in-the-database" title="Link to this heading">¶</a></h3>
<p>Den ursprungliga grafen:</p>
<a class="reference internal image-reference" href="_images/Fig6-undirected.png"><img alt="_images/Fig6-undirected.png" src="_images/Fig6-undirected.png" style="width: 241.0px; height: 217.5px;" /></a>
<p>Resultaten representerar inte den sammandragna grafen. De representerar de ändringar som måste göras i grafen efter att man har tillämpat sammandragningsmetoderna.</p>
<p>Observera att toppar, till exempel <span class="math notranslate nohighlight">\(6\)</span>, inte visas i resultaten eftersom de inte påverkades av sammandragningsalgoritmen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
 <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span>
<span class="o">------+----+---------------------+--------+--------+------</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>                 <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>               <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span> <span class="mi">14</span> <span class="o">|</span> <span class="p">{</span><span class="mi">13</span><span class="p">}</span>                <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Efter att ha gjort den återvändsgränd sammandragning operation:</p>
<a class="reference internal image-reference" href="_images/undirected_sampledata_b.png"><img alt="_images/undirected_sampledata_b.png" src="_images/undirected_sampledata_b.png" style="width: 175.75px; height: 198.5px;" /></a>
<p>Efter att ha gjort den linjära sammandragningsoperationen på grafen ovan:</p>
<a class="reference internal image-reference" href="_images/undirected_sampledata_c.png"><img alt="_images/undirected_sampledata_c.png" src="_images/undirected_sampledata_c.png" style="width: 184.25px; height: 193.75px;" /></a>
</section>
</section>
<section id="the-process-to-create-the-contraction-graph-on-the-database">
<h2>Processen för att skapa sammandragningsgrafen i databasen:<a class="headerlink" href="#the-process-to-create-the-contraction-graph-on-the-database" title="Link to this heading">¶</a></h2>
<nav class="contents local" id="id2">
<ul class="simple">
<li><p><a class="reference internal" href="#add-additional-columns" id="id7">Lägg till ytterligare kolumner</a></p></li>
<li><p><a class="reference internal" href="#store-contraction-information" id="id8">Lagra information om sammandragning</a></p></li>
<li><p><a class="reference internal" href="#update-the-edges-and-vertices-tables" id="id9">Uppdatera tabellerna för kanter och toppar</a></p></li>
<li><p><a class="reference internal" href="#the-contracted-graph" id="id10">Den kontraherade grafen</a></p></li>
</ul>
</nav>
<section id="add-additional-columns">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Lägg till ytterligare kolumner</a><a class="headerlink" href="#add-additional-columns" title="Link to this heading">¶</a></h3>
<p>Lägga till extra kolumner i tabellerna edges och vertices. I denna dokumentation kommer följande att användas:</p>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Kolumn.</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>”kontrakterade vertikaler</p></td>
<td><p>Uppsättningen av toppar som hör till toppen/kanten</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">är_kontrakterad</span></code></p></td>
<td><p>På toppunktstabellen</p>
<ul class="simple">
<li><p>när <code class="docutils literal notranslate"><span class="pre">true</span></code> vertexen är kontraherad, är den inte en del av den kontraherade grafen.</p></li>
<li><p>när <code class="docutils literal notranslate"><span class="pre">false</span></code> är vertexen inte kontraherad, den är en del av den kontraherade grafen.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">är_ny</span></code></p></td>
<td><p>På kanten av bordet</p>
<ul class="simple">
<li><p>när <code class="docutils literal notranslate"><span class="pre">true</span></code> kanten genererades av sammandragningsalgoritmen. dess del av den sammandragna grafen.</p></li>
<li><p>när <code class="docutils literal notranslate"><span class="pre">false</span></code> är kanten en originalkant, som kan vara eller inte vara en del av den kontraherade grafen.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">vertices</span>
  <span class="n">ADD</span> <span class="n">is_contracted</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">,</span>
  <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edges</span>
  <span class="n">ADD</span> <span class="n">is_new</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">,</span>
  <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</section>
<section id="store-contraction-information">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Lagra information om sammandragning</a><a class="headerlink" href="#store-contraction-information" title="Link to this heading">¶</a></h3>
<p>Spara sammandragningsresultaten i en tabell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">INTO</span> <span class="n">contraction_results</span>
<span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">7</span>
</pre></div>
</div>
</section>
<section id="update-the-edges-and-vertices-tables">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Uppdatera tabellerna för kanter och toppar</a><a class="headerlink" href="#update-the-edges-and-vertices-tables" title="Link to this heading">¶</a></h3>
<p>Använd kolumnen <code class="docutils literal notranslate"><span class="pre">is_contracted</span></code> för att ange de toppar som är kontraherade.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertices</span>
<span class="n">SET</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span>  <span class="n">unnest</span><span class="p">(</span><span class="n">contracted_vertices</span><span class="p">)</span> <span class="n">FROM</span>  <span class="n">contraction_results</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Fyll i <code class="docutils literal notranslate"><span class="pre">contracted_vertices</span></code> med informationen från de resultat som hör till topparna.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertices</span>
<span class="n">SET</span> <span class="n">contracted_vertices</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">contracted_vertices</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span> <span class="n">AND</span> <span class="n">vertices</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Infoga de nya kanterna som genererats av pgr_contraction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">edges</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_new</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">true</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
<section id="the-contracted-graph">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Den kontraherade grafen</a><a class="headerlink" href="#the-contracted-graph" title="Link to this heading">¶</a></h3>
<p>Punkter som hör till den kontraherade grafen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">WHERE</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">false</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span>
<span class="o">----</span>
  <span class="mi">4</span>
  <span class="mi">7</span>
 <span class="mi">10</span>
 <span class="mi">11</span>
 <span class="mi">12</span>
 <span class="mi">14</span>
 <span class="mi">16</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Kanter som hör till den kontraherade grafen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">vertices_in_graph</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">WHERE</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">false</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span>
<span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span>
  <span class="n">EXISTS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">WHERE</span> <span class="n">NOT</span> <span class="n">is_contracted</span> <span class="n">AND</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
  <span class="n">AND</span>
  <span class="n">EXISTS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">WHERE</span> <span class="n">NOT</span> <span class="n">is_contracted</span> <span class="n">AND</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">contracted_vertices</span>
<span class="o">----+--------+--------+------+--------------+---------------------</span>
  <span class="mi">5</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>
  <span class="mi">9</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>
 <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
 <span class="mi">19</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>
 <span class="mi">20</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>
 <span class="mi">21</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>
 <span class="mi">22</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>
<span class="p">(</span><span class="mi">8</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Visuellt:</p>
<a class="reference internal image-reference" href="_images/newgraph.png"><img alt="_images/newgraph.png" src="_images/newgraph.png" style="width: 184.25px; height: 193.75px;" /></a>
</section>
</section>
<section id="using-the-contracted-graph">
<h2>Använda den kontraherade grafen<a class="headerlink" href="#using-the-contracted-graph" title="Link to this heading">¶</a></h2>
<p>Beroende på den slutliga tillämpningen ska grafen förberedas. I detta exempel kommer den slutliga tillämpningen att vara att beräkna kostnaden från två toppar i originalgrafen genom att använda den kontraherade grafen med <code class="docutils literal notranslate"><span class="pre">pgr_dijkstraCost</span></code></p>
<p>Det finns tre fall när man beräknar den kortaste vägen mellan en given källa och ett givet mål i en kontrakterad graf:</p>
<ul class="simple">
<li><p>Fall 1: Både källan och målet hör till den kontrakterade grafen.</p></li>
<li><p>Fall 2: Källa och/eller mål tillhör en edge-subgraf.</p></li>
<li><p>Fall 3: Källa och/eller mål hör till en vertex.</p></li>
</ul>
<p>Den slutliga applikationen bör ta hänsyn till alla dessa fall.</p>
<p>Skapa en vy (eller tabell) av den kontraherade grafen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">VIEW</span> <span class="n">IF</span> <span class="n">EXISTS</span> <span class="n">contracted_graph</span><span class="p">;</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">view</span> <span class="s2">&quot;contracted_graph&quot;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span><span class="p">,</span> <span class="n">skipping</span>
<span class="n">DROP</span> <span class="n">VIEW</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">contracted_graph</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span> <span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span>
  <span class="n">EXISTS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">WHERE</span> <span class="n">NOT</span> <span class="n">is_contracted</span> <span class="n">AND</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
  <span class="n">AND</span>
  <span class="n">EXISTS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">WHERE</span> <span class="n">NOT</span> <span class="n">is_contracted</span> <span class="n">AND</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">target</span><span class="p">);</span>
<span class="n">CREATE</span> <span class="n">VIEW</span>
</pre></div>
</div>
<p>Skapa den funktion som ska använda den kontraherade grafen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CREATE OR REPLACE FUNCTION path_cost(source BIGINT, target BIGINT)
RETURNS SETOF FLOAT AS
$BODY$

SELECT agg_cost FROM pgr_dijkstraCost(
  /* The inner query */
  &#39;WITH
  cul_de_sac AS (
    SELECT contracted_vertices || id::INTEGER as v
    FROM vertices WHERE &#39; || $1 ||&#39; = ANY(contracted_vertices)
    OR &#39; || $2 ||&#39; = ANY(contracted_vertices)),
  linears_to_expand AS (
    SELECT id, contracted_vertices
    FROM edges WHERE is_new AND (&#39; || $1 ||&#39; = ANY(contracted_vertices)
      OR &#39;|| $2 ||&#39;  = ANY(contracted_vertices))
  ),
  additional_vertices AS (
    SELECT * FROM cul_de_sac UNION SELECT contracted_vertices FROM linears_to_expand)
  SELECT id, source, target, cost, reverse_cost
  FROM edges, additional_vertices WHERE source = ANY(v) OR target = ANY(v)

  UNION

  SELECT id, source, target, cost, reverse_cost
  FROM contracted_graph LEFT JOIN linears_to_expand c USING (id) WHERE c.id IS NULL&#39;,

  source, target, false);

$BODY$ LANGUAGE SQL;
CREATE FUNCTION
</pre></div>
</div>
<p>Fall 1: Både källan och målet hör till den kontrakterade grafen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">path_cost</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">path_cost</span>
<span class="o">-----------</span>
         <span class="mi">2</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>Fall 2: Källa och/eller mål hör till en kant som har kontraherade toppar.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">path_cost</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">path_cost</span>
<span class="o">-----------</span>
         <span class="mi">3</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>Fall 3: Källa och/eller mål hör till en vertex som har kontrakterats.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">path_cost</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="n">path_cost</span>
<span class="o">-----------</span>
         <span class="mi">5</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="see-also">
<h2>Se även<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="contraction-family.html"><span class="doc">Sammandragning - Familj av funktioner</span></a></p></li>
</ul>
<p class="rubric">Index och tabeller</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Söksida</span></a></p></li>
</ul>
</section>
</section>


        </div>
          
    </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v4.0.<br/>
      Senast uppdaterad sep. 11, 2025.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>