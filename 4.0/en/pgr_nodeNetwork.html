

<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>pgr_nodeNetwork &#8212; pgRouting Manual (4.0-dev)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=e38b2961" />
    <script src="_static/documentation_options.js?v=798e95cd"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/page_history.js?v=9a91d2da"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pgr_extractVertices" href="pgr_extractVertices.html" />
    <link rel="prev" title="Topology - Family of Functions" href="topology-functions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">
          pgRouting</a>
        <span class="navbar-text pull-left"><b>v4.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Sample Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting Concepts</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="routingFunctions.html">Function Families</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Proposed Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="experimental.html">Experimental Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migration guide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code></a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#fixing-an-intersection">Fixing an intersection</a></li>
<li><a class="reference internal" href="#fixing-a-gap">Fixing a gap</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="topology-functions.html" title="Previous Chapter: Topology - Family of Functions"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; Topology - Fa...</span>
    </a>
  </li>
  <li>
    <a href="pgr_extractVertices.html" title="Next Chapter: pgr_extractVertices"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">pgr_extractVertices &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
    <div class="row">
      <div class="span3">
        <div id="sidebar" class="bs-sidenav well" data-spy="affix"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code></a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#fixing-an-intersection">Fixing an intersection</a></li>
<li><a class="reference internal" href="#fixing-a-gap">Fixing a gap</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  <li>
    <a href="topology-functions.html" title="Previous Chapter: Topology - Family of Functions"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; Topology - Fa...</span>
    </a>
  </li>
  <li>
    <a href="pgr_extractVertices.html" title="Next Chapter: pgr_extractVertices"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">pgr_extractVertices &raquo;</span>
    </a>
  </li>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
        <div class="body span9 content" role="main">
            <script> document.write(get_history('pgr_nodeNetwork','en'));  </script>
            
  <div class="line-block" id="index-0">
<div class="line"><br /></div>
</div>
<section id="pgr-nodenetwork">
<h1><code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code><a class="headerlink" href="#pgr-nodenetwork" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code> - Nodes an network edge table.</p>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Nicolas Ribot</p>
</dd>
<dt class="field-even">Copyright<span class="colon">:</span></dt>
<dd class="field-even"><p>Nicolas Ribot, The source code is released under the MIT-X license.</p>
</dd>
</dl>
<p>The function reads edges from a not “noded” network table and writes the “noded”
edges into a new table.</p>
<pre class="literal-block" id="index-1">| pgr_nodenetwork(edge_table, tolerance, [<strong>options</strong>])
| <strong>options:</strong> <code class="docutils literal notranslate"><span class="pre">[id,</span> <span class="pre">text</span> <span class="pre">the_geom,</span> <span class="pre">table_ending,</span> <span class="pre">rows_where,</span> <span class="pre">outall]</span></code>

| RETURNS <code class="docutils literal notranslate"><span class="pre">TEXT</span></code></pre>
<p class="rubric">Availability</p>
<ul class="simple">
<li><p>Version 3.8.0</p>
<ul>
<li><p>Not checking and not creating indexes.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">pgr_separateTouching</span></code> and <code class="docutils literal notranslate"><span class="pre">pgr_separateCrossing</span></code>.</p></li>
<li><p>Created table with <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>.</p></li>
</ul>
</li>
<li><p>Version 2.0.0</p>
<ul>
<li><p>Official function.</p></li>
</ul>
</li>
</ul>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p><strong>The main characteristics are:</strong></p>
<p>A common problem associated with bringing GIS data into pgRouting is the fact
that the data is often not “noded” correctly. This will create invalid
topologies, which will result in routes that are incorrect.</p>
<p>What we mean by “noded” is that at every intersection in the road network all
the edges will be broken into separate road segments. There are cases like an
over-pass and under-pass intersection where you can not traverse from the
over-pass to the under-pass, but this function does not have the ability to
detect and accommodate those situations.</p>
<p>This function reads the <code class="docutils literal notranslate"><span class="pre">edge_table</span></code> table, that has a primary key column
<code class="docutils literal notranslate"><span class="pre">id</span></code> and geometry column named <code class="docutils literal notranslate"><span class="pre">the_geom</span></code> and intersect all the segments in
it against all the other segments and then creates a table <code class="docutils literal notranslate"><span class="pre">edge_table_noded</span></code>.
It uses the <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> for deciding that multiple nodes within the tolerance
are considered the same node.</p>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<dl class="field-list simple">
<dt class="field-odd">edge_table<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">text</span></code> Network table name. (may contain the schema name as well)</p>
</dd>
<dt class="field-even">tolerance<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">float8</span></code> tolerance for coincident points (in projection unit)dd</p>
</dd>
<dt class="field-odd">id<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">text</span></code> Primary key column name of the network table. Default value is
<code class="docutils literal notranslate"><span class="pre">id</span></code>.</p>
</dd>
<dt class="field-even">the_geom<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">text</span></code> Geometry column name of the network table. Default value is
<code class="docutils literal notranslate"><span class="pre">the_geom</span></code>.</p>
</dd>
<dt class="field-odd">table_ending<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">text</span></code> Suffix for the new table’s. Default value is <code class="docutils literal notranslate"><span class="pre">noded</span></code>.</p>
</dd>
</dl>
<p>The output table will have for <code class="docutils literal notranslate"><span class="pre">edge_table_noded</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">id<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code> Unique identifier for the table</p>
</dd>
<dt class="field-even">old_id<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code> Identifier of the edge in original table</p>
</dd>
<dt class="field-odd">sub_id<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">integer</span></code> Segment number of the original edge</p>
</dd>
<dt class="field-even">source<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code> Empty source column</p>
</dd>
<dt class="field-odd">target<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">bigint</span></code> Empty target column</p>
</dd>
<dt class="field-even">the geom<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">geometry</span></code> Geometry column of the noded network</p>
</dd>
</dl>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>Create the topology for the data in <a class="reference internal" href="sampledata.html"><span class="doc">Sample Data</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">INTO</span> <span class="n">vertices</span>
<span class="n">FROM</span> <span class="n">pgr_extractVertices</span><span class="p">(</span><span class="s1">&#39;SELECT id, geom FROM edges ORDER BY id&#39;</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">17</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">source</span> <span class="n">information</span> <span class="o">*/</span>
<span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">AS</span> <span class="n">e</span>
<span class="n">SET</span> <span class="n">source</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span>
<span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span>
<span class="n">WHERE</span> <span class="n">ST_StartPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">18</span>
<span class="o">/*</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">target</span> <span class="n">information</span> <span class="o">*/</span>
<span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">AS</span> <span class="n">e</span>
<span class="n">SET</span> <span class="n">target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span>
<span class="n">FROM</span> <span class="n">vertices</span> <span class="n">AS</span> <span class="n">v</span>
<span class="n">WHERE</span> <span class="n">ST_EndPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">18</span>
</pre></div>
</div>
<p>Analyze the network for intersections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="n">id1</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="n">id2</span><span class="p">,</span> <span class="n">ST_ASTEXT</span><span class="p">(</span><span class="n">ST_Intersection</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">))</span> <span class="n">AS</span> <span class="n">point</span>
<span class="n">FROM</span> <span class="n">edges</span> <span class="n">e1</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e2</span>
<span class="n">WHERE</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="n">AND</span> <span class="n">ST_Crosses</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
 <span class="n">id1</span> <span class="o">|</span> <span class="n">id2</span> <span class="o">|</span>    <span class="n">point</span>
<span class="o">-----+-----+--------------</span>
  <span class="mi">13</span> <span class="o">|</span>  <span class="mi">18</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">3.5</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>Analyze the network for gaps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">data</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="n">inhere</span>
  <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">where</span> <span class="n">array_length</span><span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">),</span>
<span class="n">results</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">inhere</span><span class="p">,</span>
  <span class="p">(</span><span class="n">pgr_findCloseEdges</span><span class="p">(</span><span class="s1">&#39;SELECT id, geom FROM edges WHERE id != &#39;</span> <span class="o">||</span> <span class="n">inhere</span> <span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span><span class="o">.*</span>
  <span class="n">FROM</span> <span class="n">data</span> <span class="n">d</span>
<span class="p">)</span>
<span class="n">SELECT</span>
  <span class="nb">id</span><span class="p">,</span> <span class="n">inhere</span><span class="p">,</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">fraction</span><span class="p">,</span>
  <span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="n">AS</span> <span class="n">geom</span><span class="p">,</span> <span class="n">ST_AsText</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="n">AS</span> <span class="n">edge</span>
<span class="n">FROM</span> <span class="n">results</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">inhere</span> <span class="o">|</span> <span class="n">edge_id</span> <span class="o">|</span> <span class="n">fraction</span> <span class="o">|</span>           <span class="n">geom</span>            <span class="o">|</span>                 <span class="n">edge</span>
<span class="o">----+--------+---------+----------+---------------------------+--------------------------------------</span>
  <span class="mi">4</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>      <span class="mi">14</span> <span class="o">|</span>      <span class="mf">0.5</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">1.999999999999</span> <span class="mf">3.5</span><span class="p">)</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">1.999999999999</span> <span class="mf">3.5</span><span class="p">,</span><span class="mi">2</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>The analysis tell us that the network has a gap and an intersection.</p>
<section id="fixing-an-intersection">
<h3>Fixing an intersection<a class="headerlink" href="#fixing-an-intersection" title="Link to this heading">¶</a></h3>
<p>Storing the intersections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="n">id1</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="n">id2</span><span class="p">,</span> <span class="n">st_intersection</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="n">AS</span> <span class="n">point</span>
<span class="n">INTO</span> <span class="n">intersections</span>
<span class="n">FROM</span> <span class="n">edges</span> <span class="n">e1</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e2</span>
<span class="n">WHERE</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="n">AND</span> <span class="n">st_crosses</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">the_geom</span> <span class="o">=&gt;</span> <span class="s1">&#39;geom&#39;</span><span class="p">,</span> <span class="n">rows_where</span><span class="o">=&gt;</span><span class="s1">&#39;id in (&#39;</span><span class="o">||</span><span class="n">id1</span><span class="o">||</span><span class="s1">&#39;,&#39;</span><span class="o">||</span><span class="n">id2</span><span class="o">||</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">intersections</span><span class="p">;</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">PROCESSING</span><span class="p">:</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="nb">id</span><span class="p">:</span> <span class="nb">id</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">the_geom</span><span class="p">:</span> <span class="n">geom</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">table_ending</span><span class="p">:</span> <span class="n">noded</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">rows_where</span><span class="p">:</span> <span class="nb">id</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">outall</span><span class="p">:</span> <span class="n">f</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;geom&#39;</span><span class="p">,</span> <span class="s1">&#39;noded&#39;</span><span class="p">,</span> <span class="s1">&#39;id in (13,18)&#39;</span><span class="p">,</span>  <span class="n">f</span><span class="p">)</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Performing</span> <span class="n">checks</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span> <span class="o">.....</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Processing</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span> <span class="o">.....</span>
<span class="n">NOTICE</span><span class="p">:</span>    <span class="n">Split</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Untouched</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">NOTICE</span><span class="p">:</span>       <span class="n">Total</span> <span class="n">original</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Edges</span> <span class="n">generated</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Untouched</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">NOTICE</span><span class="p">:</span>         <span class="n">Total</span> <span class="n">New</span> <span class="n">segments</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">New</span> <span class="n">Table</span><span class="p">:</span> <span class="n">public</span><span class="o">.</span><span class="n">edges_noded</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="o">----------------------------------</span>
 <span class="n">pgr_nodenetwork</span>
<span class="o">-----------------</span>
 <span class="n">OK</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>Inspecting the generated table, we can see that edges 13 and 18 have been
segmented.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">old_id</span><span class="p">,</span> <span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">edges_noded</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">old_id</span><span class="p">,</span> <span class="n">sub_id</span><span class="p">;</span>
 <span class="n">old_id</span> <span class="o">|</span>         <span class="n">st_astext</span>
<span class="o">--------+---------------------------</span>
     <span class="mi">13</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mi">3</span> <span class="mi">3</span><span class="p">,</span><span class="mf">3.5</span> <span class="mi">3</span><span class="p">)</span>
     <span class="mi">13</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">3.5</span> <span class="mi">3</span><span class="p">,</span><span class="mi">4</span> <span class="mi">3</span><span class="p">)</span>
     <span class="mi">18</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">3.5</span> <span class="mf">2.3</span><span class="p">,</span><span class="mf">3.5</span> <span class="mi">3</span><span class="p">)</span>
     <span class="mi">18</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">3.5</span> <span class="mi">3</span><span class="p">,</span><span class="mf">3.5</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Update the topology</p>
<p>Add new segments to the edges table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">edges</span> <span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
<span class="n">WITH</span>
<span class="n">the_fractions</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="nb">id</span><span class="p">,</span> <span class="n">st_lineLocatePoint</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span> <span class="n">AS</span> <span class="n">fraction</span>
  <span class="n">FROM</span> <span class="n">intersections</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e1</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e2</span> <span class="n">WHERE</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id1</span> <span class="n">AND</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id2</span>
  <span class="n">UNION</span>
  <span class="n">SELECT</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">st_lineLocatePoint</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
  <span class="n">FROM</span> <span class="n">intersections</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e1</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e2</span> <span class="n">WHERE</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id1</span> <span class="n">AND</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id2</span>
<span class="p">)</span>
<span class="n">SELECT</span>
  <span class="n">CASE</span> <span class="n">WHEN</span> <span class="n">sub_id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">THEN</span> <span class="n">cost</span><span class="o">*</span><span class="n">fraction</span> <span class="n">ELSE</span> <span class="n">cost</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">fraction</span><span class="p">)</span> <span class="n">END</span> <span class="k">as</span> <span class="n">cost</span><span class="p">,</span>
  <span class="n">CASE</span> <span class="n">WHEN</span> <span class="n">sub_id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">THEN</span> <span class="n">reverse_cost</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">fraction</span><span class="p">)</span> <span class="n">ELSE</span> <span class="n">reverse_cost</span><span class="o">*</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span> <span class="n">END</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
  <span class="n">segments</span><span class="o">.</span><span class="n">geom</span>
<span class="n">FROM</span> <span class="n">edges</span> <span class="k">as</span> <span class="n">edges</span>
<span class="n">JOIN</span> <span class="n">edges_noded</span> <span class="k">as</span> <span class="n">segments</span> <span class="n">ON</span> <span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">old_id</span><span class="p">)</span>
<span class="n">JOIN</span> <span class="n">the_fractions</span> <span class="n">f</span> <span class="n">ON</span> <span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">old_id</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Insert the intersection as new vertices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">vertices</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">row_number</span><span class="p">()</span> <span class="n">over</span><span class="p">()</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">point</span>
<span class="n">FROM</span> <span class="n">intersections</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Update source and target information on the edges table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">e</span> <span class="n">SET</span> <span class="n">source</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span>
<span class="n">vertices</span> <span class="n">v</span> <span class="n">where</span> <span class="n">source</span> <span class="n">IS</span> <span class="n">NULL</span> <span class="n">AND</span> <span class="p">(</span><span class="n">st_startPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">4</span>
<span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">e</span> <span class="n">SET</span> <span class="n">target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span>
<span class="n">vertices</span> <span class="n">v</span> <span class="n">where</span> <span class="n">target</span> <span class="n">IS</span> <span class="n">NULL</span> <span class="n">AND</span> <span class="p">(</span><span class="n">st_endPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Delete original edge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="n">id1</span> <span class="n">FROM</span> <span class="n">intersections</span>
  <span class="n">UNION</span>
  <span class="n">SELECT</span> <span class="n">id2</span> <span class="n">FROM</span> <span class="n">intersections</span><span class="p">);</span>
<span class="n">DELETE</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Update the vertex topology</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span> <span class="n">data</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">select</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">in_edges</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">out_edges</span>
  <span class="n">FROM</span> <span class="n">pgr_extractVertices</span><span class="p">(</span><span class="s1">&#39;select id, source, target from edges&#39;</span><span class="p">)</span> <span class="n">p</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertices</span> <span class="n">v</span>
<span class="n">SET</span> <span class="p">(</span><span class="n">in_edges</span><span class="p">,</span><span class="n">out_edges</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">in_edges</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">out_edges</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">data</span> <span class="n">d</span> <span class="n">where</span> <span class="n">d</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">18</span>
</pre></div>
</div>
<p>Analyze the network for intersections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span>
<span class="n">FROM</span> <span class="n">edges_noded</span> <span class="n">e1</span><span class="p">,</span> <span class="n">edges</span> <span class="n">e2</span>
<span class="n">WHERE</span> <span class="n">e1</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">e2</span><span class="o">.</span><span class="n">id</span> <span class="n">AND</span> <span class="n">st_crosses</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="nb">id</span>
<span class="o">----+----</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="fixing-a-gap">
<h3>Fixing a gap<a class="headerlink" href="#fixing-a-gap" title="Link to this heading">¶</a></h3>
<p>Store the deadends</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">data</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="n">inhere</span>
  <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">where</span> <span class="n">array_length</span><span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">SELECT</span>
  <span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">inhere</span><span class="p">,</span>
  <span class="p">(</span><span class="n">pgr_findCloseEdges</span><span class="p">(</span><span class="s1">&#39;SELECT id, geom FROM edges WHERE id != &#39;</span> <span class="o">||</span> <span class="n">inhere</span> <span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span><span class="o">.*</span>
<span class="n">INTO</span> <span class="n">deadends</span>
<span class="n">FROM</span> <span class="n">data</span> <span class="n">d</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">pgr_nodeNetwork</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">the_geom</span> <span class="o">=&gt;</span> <span class="s1">&#39;geom&#39;</span><span class="p">,</span> <span class="n">rows_where</span><span class="o">=&gt;</span><span class="s1">&#39;id in (&#39;</span><span class="o">||</span><span class="n">inhere</span><span class="o">||</span><span class="s1">&#39;,&#39;</span><span class="o">||</span><span class="n">edge_id</span><span class="o">||</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">deadends</span><span class="p">;</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">PROCESSING</span><span class="p">:</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="nb">id</span><span class="p">:</span> <span class="nb">id</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">the_geom</span><span class="p">:</span> <span class="n">geom</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">table_ending</span><span class="p">:</span> <span class="n">noded</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">rows_where</span><span class="p">:</span> <span class="nb">id</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">outall</span><span class="p">:</span> <span class="n">f</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;geom&#39;</span><span class="p">,</span> <span class="s1">&#39;noded&#39;</span><span class="p">,</span> <span class="s1">&#39;id in (17,14)&#39;</span><span class="p">,</span>  <span class="n">f</span><span class="p">)</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Performing</span> <span class="n">checks</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span> <span class="o">.....</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Processing</span><span class="p">,</span> <span class="n">please</span> <span class="n">wait</span> <span class="o">.....</span>
<span class="n">NOTICE</span><span class="p">:</span>    <span class="n">Split</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Untouched</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">NOTICE</span><span class="p">:</span>       <span class="n">Total</span> <span class="n">original</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Edges</span> <span class="n">generated</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">Untouched</span> <span class="n">Edges</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">NOTICE</span><span class="p">:</span>         <span class="n">Total</span> <span class="n">New</span> <span class="n">segments</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">NOTICE</span><span class="p">:</span>   <span class="n">New</span> <span class="n">Table</span><span class="p">:</span> <span class="n">public</span><span class="o">.</span><span class="n">edges_noded</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="o">----------------------------------</span>
 <span class="n">pgr_nodenetwork</span>
<span class="o">-----------------</span>
 <span class="n">OK</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
<p>Inspecting the generated table, we can see that edge 14 has been segmented.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">old_id</span><span class="p">,</span> <span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">edges_noded</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">old_id</span><span class="p">,</span> <span class="n">sub_id</span><span class="p">;</span>
 <span class="n">old_id</span> <span class="o">|</span>               <span class="n">st_astext</span>
<span class="o">--------+----------------------------------------</span>
     <span class="mi">14</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mi">2</span> <span class="mi">3</span><span class="p">,</span><span class="mf">1.999999999999</span> <span class="mf">3.5</span><span class="p">)</span>
     <span class="mi">14</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">1.999999999999</span> <span class="mf">3.5</span><span class="p">,</span><span class="mi">2</span> <span class="mi">4</span><span class="p">)</span>
     <span class="mi">17</span> <span class="o">|</span> <span class="n">LINESTRING</span><span class="p">(</span><span class="mf">0.5</span> <span class="mf">3.5</span><span class="p">,</span><span class="mf">1.999999999999</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Update the topology</p>
<p>Add new segments to the edges table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">edges</span> <span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
<span class="n">SELECT</span>
  <span class="n">CASE</span> <span class="n">WHEN</span> <span class="n">sub_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">THEN</span> <span class="n">cost</span><span class="o">*</span><span class="n">fraction</span> <span class="n">ELSE</span> <span class="n">cost</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">fraction</span><span class="p">)</span> <span class="n">END</span> <span class="k">as</span> <span class="n">cost</span><span class="p">,</span>
  <span class="n">CASE</span> <span class="n">WHEN</span> <span class="n">sub_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">THEN</span> <span class="n">reverse_cost</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">fraction</span><span class="p">)</span> <span class="n">ELSE</span> <span class="n">reverse_cost</span><span class="o">*</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span> <span class="n">END</span> <span class="k">as</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">en</span><span class="o">.</span><span class="n">geom</span>
<span class="n">FROM</span> <span class="n">deadends</span> <span class="n">r</span> <span class="n">JOIN</span> <span class="n">edges_noded</span> <span class="n">en</span> <span class="n">ON</span> <span class="p">(</span><span class="n">old_id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span> <span class="n">JOIN</span> <span class="n">edges</span> <span class="n">e</span> <span class="n">ON</span> <span class="p">(</span><span class="n">old_id</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">UNION</span>
<span class="n">SELECT</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">edge</span> <span class="n">FROM</span> <span class="n">deadends</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Insert the intersection as new vertices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Update</span> <span class="n">the</span> <span class="n">vertices</span> <span class="n">table</span> <span class="o">*/</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">vertices</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
<span class="n">select</span> <span class="n">row_number</span><span class="p">()</span> <span class="n">over</span><span class="p">()</span> <span class="o">+</span> <span class="mi">200</span><span class="p">,</span> <span class="n">st_endpoint</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">deadends</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Update source and target information on the edges table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">e</span> <span class="n">SET</span> <span class="n">source</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span>
<span class="n">vertices</span> <span class="n">v</span> <span class="n">where</span> <span class="n">source</span> <span class="n">IS</span> <span class="n">NULL</span> <span class="n">AND</span> <span class="p">(</span><span class="n">st_startPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
<span class="n">UPDATE</span> <span class="n">edges</span> <span class="n">e</span> <span class="n">SET</span> <span class="n">target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span>
<span class="n">vertices</span> <span class="n">v</span> <span class="n">where</span> <span class="n">target</span> <span class="n">IS</span> <span class="n">NULL</span> <span class="n">AND</span> <span class="p">(</span><span class="n">st_endPoint</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Delete original edge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">edges</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">edge_id</span> <span class="n">FROM</span> <span class="n">deadends</span><span class="p">);</span>
<span class="n">DELETE</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Update the vertex topology</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span> <span class="n">data</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">select</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">in_edges</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">out_edges</span>
  <span class="n">FROM</span> <span class="n">pgr_extractVertices</span><span class="p">(</span><span class="s1">&#39;select id, source, target from edges&#39;</span><span class="p">)</span> <span class="n">p</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertices</span> <span class="n">v</span>
<span class="n">SET</span> <span class="p">(</span><span class="n">in_edges</span><span class="p">,</span><span class="n">out_edges</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">in_edges</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">out_edges</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">data</span> <span class="n">d</span> <span class="n">where</span> <span class="n">d</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">19</span>
</pre></div>
</div>
<p>Analyze the network for gaps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">data</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="n">inhere</span>
  <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">where</span> <span class="n">array_length</span><span class="p">(</span><span class="n">in_edges</span> <span class="o">||</span> <span class="n">out_edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span>
<span class="n">results</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="p">(</span><span class="n">pgr_findCloseEdges</span><span class="p">(</span>
      <span class="s1">&#39;SELECT id, geom FROM edges WHERE id != &#39;</span> <span class="o">||</span> <span class="n">inhere</span> <span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span><span class="o">.*</span><span class="p">,</span>
  <span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">inhere</span>
  <span class="n">FROM</span> <span class="n">data</span> <span class="n">d</span>
<span class="p">)</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">results</span><span class="p">;</span>
 <span class="n">edge_id</span> <span class="o">|</span> <span class="n">fraction</span> <span class="o">|</span> <span class="n">side</span> <span class="o">|</span>       <span class="n">distance</span>        <span class="o">|</span>                    <span class="n">geom</span>                    <span class="o">|</span>                                        <span class="n">edge</span>                                        <span class="o">|</span> <span class="nb">id</span>  <span class="o">|</span> <span class="n">inhere</span>
<span class="o">---------+----------+------+-----------------------+--------------------------------------------+------------------------------------------------------------------------------------+-----+--------</span>
      <span class="mi">17</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="n">l</span>    <span class="o">|</span> <span class="mf">1.000088900582341e-12</span> <span class="o">|</span> <span class="mi">010100000000000000000000400000000000000</span><span class="n">C40</span> <span class="o">|</span> <span class="mi">01020000000200000000000000000000400000000000000</span><span class="n">C4068EEFFFFFFFFFF3F0000000000000C40</span> <span class="o">|</span> <span class="mi">201</span> <span class="o">|</span>     <span class="mi">25</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="topology-functions.html"><span class="doc">Topology - Family of Functions</span></a> for an overview of a topology for routing algorithms.</p>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


        </div>
          
    </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v4.0.<br/>
      Last updated on Apr 29, 2025.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 8.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>