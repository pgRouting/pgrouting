<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Contraction - Familia de funciones &#8212; pgRouting Manual (3.3)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
<script src="_static/page_history.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/translations.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="pgr_contraction" href="pgr_contraction.html" />
    <link rel="prev" title="pgr_makeConnected - Experimental" href="pgr_makeConnected.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/pgrouting.png"></span>
          pgRouting</a>
        <span class="navbar-text navbar-version pull-left"><b>v3.3.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Soporte</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Datos Muestra</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">Conceptos de pgRouting</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="routingFunctions.html">Familias de Funciones</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Funciones propuestas</a></li>
<li class="toctree-l1"><a class="reference internal" href="experimental.html">Funciones Experimentales</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Notas de versión</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Contraction - Familia de funciones</a><ul>
<li><a class="reference internal" href="#introduction">Introducción</a></li>
<li><a class="reference internal" href="#dead-end-contraction">Contracción sin salida</a><ul>
<li><a class="reference internal" href="#dead-end">Sin salida</a><ul>
<li><a class="reference internal" href="#dead-end-vertex-on-undirected-graph">Vértice sin salida en un grafo sin dirigir</a></li>
<li><a class="reference internal" href="#dead-end-vertex-on-directed-graph">Vértice sin salida en un grafo dirigido</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operation-dead-end-contraction">Operación: Contracción sin salida</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linear-contraction">Contracción lineal</a><ul>
<li><a class="reference internal" href="#linear">Lineal</a><ul>
<li><a class="reference internal" href="#linear-vertex-on-undirected-graph">Vértice lineal en grafo no dirigido</a></li>
<li><a class="reference internal" href="#linear-vertex-on-directed-graph">Vértice lineal en grafo dirigido</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operation-linear-contraction">Operación: Contracción Lineal</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-cycle">El ciclo</a></li>
<li><a class="reference internal" href="#contracting-sample-data">Contracción de los datos de muestra</a><ul>
<li><a class="reference internal" href="#construction-of-the-graph-in-the-database">Construcción del grafo en la base de datos</a><ul>
<li><a class="reference internal" href="#contraction-results">Resultados de la Contracción</a></li>
<li><a class="reference internal" href="#add-additional-columns">Añadir columnas adicionales</a></li>
<li><a class="reference internal" href="#store-contraction-information">Almacenar información de contracción</a></li>
<li><a class="reference internal" href="#the-vertex-table-update">Actualización de la tabla de vértices</a></li>
<li><a class="reference internal" href="#the-edge-table-update">Actialización de la tabla de aristas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-contracted-graph">El grafo contraído</a><ul>
<li><a class="reference internal" href="#vertices-that-belong-to-the-contracted-graph">Vértices que pertenecen al grafo contraído.</a></li>
<li><a class="reference internal" href="#edges-that-belong-to-the-contracted-graph">Aristas que pertenecen al grafo contraído.</a></li>
<li><a class="reference internal" href="#contracted-graph">El grafo contraído</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-contracted-graph">Usando el grafo contraído</a><ul>
<li><a class="reference internal" href="#case-1-both-source-and-target-belong-to-the-contracted-graph">Caso 1: Tanto el origen como el destino pertenecen al grafo contraído.</a></li>
<li><a class="reference internal" href="#case-2-source-and-or-target-belong-to-an-edge-subgraph">Caso 2: El origen y/o el destino pertenecen a un subgrafo de aristas.</a></li>
<li><a class="reference internal" href="#case-3-source-and-or-target-belong-to-a-vertex">Caso 3: El origen y/o el destino pertenecen a un vértice.</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">Ver también</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="pgr_makeConnected.html" title="Previous Chapter: pgr_makeConnected - Experimental"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; pgr_makeConne...</span>
    </a>
  </li>
  <li>
    <a href="pgr_contraction.html" title="Next Chapter: pgr_contraction"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">pgr_contraction &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
 <div class="line"><br/></div> <script> document.write(get_history("contraction-family","es")); </script>
      
  <div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><p><strong>Supported versions:</strong>
</ul>
<section id="contraction-family-of-functions">
<h1>Contraction - Familia de funciones<a class="headerlink" href="#contraction-family-of-functions" title="Enlace permanente a este encabezado">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_contraction.html"><span class="doc">pgr_contraction</span></a></p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
<section id="introduction">
<h2>Introducción<a class="headerlink" href="#introduction" title="Enlace permanente a este encabezado">¶</a></h2>
<p>En grafos grandes, como los grafos de carretera o de redes eléctricas, la contracción de grafos se puede utilizar para acelerar algunos algoritmos. La contracción reduce el tamaño del grafo eliminando algunos de los vértices y aristas, por ejemplo, podría agregar aristas que representen una secuencia de las aristas originales disminuyendo el tiempo total y el espacio utilizados en los algoritmos de grafos.</p>
<p>Esta implementación proporciona un marco flexible para agregar algoritmos de contracción en el futuro, actualmente, admite dos algoritmos:</p>
<ol class="arabic simple">
<li><p>Contracción sin salida</p></li>
<li><p>Contracción lineal</p></li>
</ol>
<p>Permitiendo que el usuario:</p>
<ul class="simple">
<li><p>Prohíba la contracción en un conjunto de nodos.</p></li>
<li><p>Decida el orden de los algoritmos de contracción y establezca el número máximo de veces que se van a ejecutar.</p></li>
</ul>
</section>
<section id="dead-end-contraction">
<h2>Contracción sin salida<a class="headerlink" href="#dead-end-contraction" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Contracción de los nodos de hoja del grafo.</p>
<section id="dead-end">
<h3>Sin salida<a class="headerlink" href="#dead-end" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Un nodo se considera <strong>sin salida</strong> cuando</p>
<ul class="simple">
<li><p>En grafos no dirigidos:</p>
<ul>
<li><p>El número de vértices adyacentes es 1.</p></li>
</ul>
</li>
<li><p>En grafos dirigidos:</p>
<ul>
<li><p>El número de vértices adyacentes es 1.</p></li>
<li><p>No hay aristas salientes y tiene al menos una arista entrante.</p></li>
<li><p>No hay aristas entrantes y tiene al menos una arista saliente.</p></li>
</ul>
</li>
</ul>
<p>Cuando las condiciones son verdaderas, se puede hacer la <a class="reference internal" href="#operation-dead-end-contraction">Operación: Contracción de callejón sin salida</a>.</p>
<section id="dead-end-vertex-on-undirected-graph">
<h4>Vértice sin salida en un grafo sin dirigir<a class="headerlink" href="#dead-end-vertex-on-undirected-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<ul class="simple">
<li><p>Los nodos verdes son nodos <a class="reference internal" href="#dead-end">dead end</a></p></li>
<li><p>Los nodos azules tienen un número ilimitado de aristas.</p></li>
</ul>
<div class="graphviz"><img src="_images/graphviz-133c3d00246c459c4912dd2d409ee878545598e4.png" alt="graph G {
    u, v [shape=circle;style=filled;width=.4;color=deepskyblue];
    a, b [style=filled; color=green];
    G [shape=tripleoctagon;width=1.5;style=filled;
       color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -- {u, v} [dir=none, weight=1, penwidth=3];
    u -- a [color=black];
    u -- a [color=darkgray];
    v -- b;
}" class="graphviz" /></div>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Nodo</p></th>
<th class="head"><p>Nodos adyacentes</p></th>
<th class="head"><p>Número de vértices adyacentes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(a\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{u\}\)</span></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(b\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{v\}\)</span></p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dead-end-vertex-on-directed-graph">
<h4>Vértice sin salida en un grafo dirigido<a class="headerlink" href="#dead-end-vertex-on-directed-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<ul class="simple">
<li><p>Los nodos verdes son nodos <a class="reference internal" href="#dead-end">dead end</a></p></li>
<li><p>Los nodos azules tienen un número ilimitado de aristas entrantes y/o salientes.</p></li>
</ul>
<div class="graphviz"><img src="_images/graphviz-5efe3d7b813da1c75d98039a1a2825ccb5f14744.png" alt="digraph G {
    u, v, w, x, y [shape=circle;style=filled;width=.4;color=deepskyblue];
    a, b, c, d, e [style=filled; color=green];
    G [shape=tripleoctagon;width=1.5;style=filled;
       color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; {u, v, w} [dir=none, weight=1, penwidth=3];
    {x, y} -&gt; G  [dir=none, weight=1, penwidth=3];
    u -&gt; a -&gt; u;
    v -&gt; b;
    {w, v} -&gt; c;
    d -&gt; x;
    e -&gt; {x, y};
}" class="graphviz" /></div>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Nodo</p></th>
<th class="head"><p>Nodos adyacentes</p></th>
<th class="head"><p>Número de vértices adyacentes</p></th>
<th class="head"><p>Número de aristas entrantes</p></th>
<th class="head"><p>Número de aristas salientes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(a\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{u\}\)</span></p></td>
<td><p>1</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(b\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{v\}\)</span></p></td>
<td><p>1</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{v, w\}\)</span></p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(d\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{x\}\)</span></p></td>
<td><p>1</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(e\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{x, y\}\)</span></p></td>
<td><p>2</p></td>
<td><p>0</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p>De arriba, nodes <span class="math notranslate nohighlight">\(\{a, b, d\}\)</span> son callejones sin salida por que el número de vértices adyacentes es 1. No son necesarios los checks para esos nodos.</p>
<p>En al siguiente tabla, nodos <span class="math notranslate nohighlight">\(\{c, e\}\)</span> por que el par del numero de vértices adyacentes no es 1 para</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(c\)</span></p>
<ul>
<li><p>No hay aristas salientes y tiene al menos una arista entrante.</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(e\)</span></p>
<ul>
<li><p>No hay aristas entrantes y tiene al menos una arista saliente.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="operation-dead-end-contraction">
<h3>Operación: Contracción sin salida<a class="headerlink" href="#operation-dead-end-contraction" title="Enlace permanente a este encabezado">¶</a></h3>
<p>La contracción sin salida se detendrá hasta que no haya más nodos sin salida. Por ejemplo, del siguiente grafo donde <span class="math notranslate nohighlight">\(w\)</span> es el nodo <a class="reference internal" href="#dead-end">dead end</a>:</p>
<div class="graphviz"><img src="_images/graphviz-4fdcd0305dbfbab90073ec9514716ef0ad1e4f76.png" alt="digraph G {
    u, v [shape=circle;style=filled;width=.4;color=deepskyblue];
    w [style=filled; color=green];
    &quot;G&quot; [shape=tripleoctagon;style=filled;
    color=deepskyblue; label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; u [dir=none, weight=1, penwidth=3];
    u -&gt; v -&gt; w;
}" class="graphviz" /></div>
<p>Después de contraer <span class="math notranslate nohighlight">\(w\)</span>, el nodo ` <span class="math notranslate nohighlight">\(v\)</span> es ahora un nodo <a class="reference internal" href="#dead-end">dead end</a> y es contraído:</p>
<div class="graphviz"><img src="_images/graphviz-82174f96e766deeae75a75488fa01f23af7da497.png" alt="digraph G {
    u [shape=circle;style=filled;width=.4;color=deepskyblue];
    v [style=filled; color=green, label=&quot;v{w}&quot;];
    &quot;G&quot; [shape=tripleoctagon;style=filled;
        color=deepskyblue; label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; u [dir=none, weight=1, penwidth=3];
    u -&gt; v;
}" class="graphviz" /></div>
<p>Después de contraer math:<cite>v</cite>, detenerse El nodo math:<cite>u</cite> tiene la información de los nodos que se contraen.</p>
<div class="graphviz"><img src="_images/graphviz-2d7779194092aa64d7a74051e7b24d8a962d9e0f.png" alt="digraph G {
    u [style=filled; color=green, label=&quot;u{v,w}&quot;];
    &quot;G&quot; [shape=tripleoctagon;style=filled;
         color=deepskyblue; label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; u [dir=none, weight=1, penwidth=3];
}" class="graphviz" /></div>
<p>El nodo <span class="math notranslate nohighlight">\(u\)</span> tiene la información de los nodos que se contrajeron.</p>
</section>
</section>
<section id="linear-contraction">
<h2>Contracción lineal<a class="headerlink" href="#linear-contraction" title="Enlace permanente a este encabezado">¶</a></h2>
<p>En el algoritmo, la contracción lineal es representada con un 2.</p>
<section id="linear">
<h3>Lineal<a class="headerlink" href="#linear" title="Enlace permanente a este encabezado">¶</a></h3>
<p>En el caso de un grafo no dirigido, un nodo se considera un nodo <cite>lineal</cite> cuando</p>
<ul class="simple">
<li><p>El número de vértices adyacentes es 2.</p></li>
</ul>
<p>En el caso de un grafo dirigido, un nodo se considera <cite>lineal</cite> cuando</p>
<ul class="simple">
<li><p>El número de vértices adyacentes es 2.</p></li>
<li><p>La linealidad es simétrica</p></li>
</ul>
<section id="linear-vertex-on-undirected-graph">
<h4>Vértice lineal en grafo no dirigido<a class="headerlink" href="#linear-vertex-on-undirected-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<ul class="simple">
<li><p>Los nodos verdes son <a class="reference internal" href="#linear">lineales</a></p></li>
<li><p>Los nodos azules tienen un número ilimitado de aristas entrantes y salientes.</p></li>
</ul>
<p class="rubric">No dirigido</p>
<div class="graphviz"><img src="_images/graphviz-5565c2a3e64a5e493dd60c052a86cee32c294e38.png" alt="graph G {
    u, w [shape=circle;style=filled;width=.4;color=deepskyblue];
    v [style=filled; color=green];
    G [shape=tripleoctagon;width=1.5;style=filled;
       color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    w -- G -- u [dir=none, weight=1, penwidth=3];
    u -- v -- w;
}" class="graphviz" /></div>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Nodo</p></th>
<th class="head"><p>Nodos adyacentes</p></th>
<th class="head"><p>Número de vértices adyacentes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(v\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{u, w\}\)</span></p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</section>
<section id="linear-vertex-on-directed-graph">
<h4>Vértice lineal en grafo dirigido<a class="headerlink" href="#linear-vertex-on-directed-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<ul class="simple">
<li><p>Los nodos verdes son <a class="reference internal" href="#linear">lineales</a></p></li>
<li><p>Los nodos azules tienen un número ilimitado de aristas entrantes y salientes.</p></li>
<li><p>El nodo blanco no es linero por que la linealidad no es simétrica.</p>
<ul>
<li><p>Es posible ir a <span class="math notranslate nohighlight">\(y \rightarrow c \rightarrow z\)</span></p></li>
<li><p>No es posible ir a <span class="math notranslate nohighlight">\(z \rightarrow c \rightarrow y\)</span></p></li>
</ul>
</li>
</ul>
<div class="graphviz"><img src="_images/graphviz-726b2c9e619c1609c8d06996b6392b09095c2986.png" alt="digraph G {
    u, v, w, x, y, z [shape=circle;style=filled;width=.4;color=deepskyblue];
    a, b [style=filled; color=green];
    G [shape=tripleoctagon;width=1.5;style=filled;
      color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    {u, v} -&gt; G -&gt; {x, w, y, z} [dir=none, weight=1, penwidth=3];
    u -&gt; a -&gt; v;
    w -&gt; b -&gt; x;
    x -&gt; b -&gt; w [color=darkgray];
    y -&gt; c -&gt; z -&gt; c;
}" class="graphviz" /></div>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Nodo</p></th>
<th class="head"><p>Nodos adyacentes</p></th>
<th class="head"><p>Número de vértices adyacentes</p></th>
<th class="head"><p>Es simétrico?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(a\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{u, v\}\)</span></p></td>
<td><p>2</p></td>
<td><p>sí</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(b\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{w, x\}\)</span></p></td>
<td><p>2</p></td>
<td><p>sí</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(c\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\{y, z\}\)</span></p></td>
<td><p>2</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="operation-linear-contraction">
<h3>Operación: Contracción Lineal<a class="headerlink" href="#operation-linear-contraction" title="Enlace permanente a este encabezado">¶</a></h3>
<p>La contracción lineal se detendrá hasta que no hayan más nodos lineales. Por ejemplo, en el siguiente grafo donde ` <span class="math notranslate nohighlight">\(v\)</span> y <span class="math notranslate nohighlight">\(w\)</span> son nodos <a class="reference internal" href="#linear">lineales</a> :</p>
<div class="graphviz"><img src="_images/graphviz-5d6780661464bc07b07b2af1a5d6b5f8f36ca90a.png" alt="digraph G {
    u, z [shape=circle;style=filled;color=deepskyblue];
    v, w [style=filled; color=green];
    &quot;G&quot; [shape=tripleoctagon; style=filled;
         color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; {u, z} [dir=none, weight=1, penwidth=3];
    u -&gt; v -&gt; w -&gt; z;
}" class="graphviz" /></div>
<p>Contrayendo <span class="math notranslate nohighlight">\(w\)</span>,</p>
<ul class="simple">
<li><p>El vértice <span class="math notranslate nohighlight">\(w\)</span> se elimina del grafo</p></li>
<li><p>Los aristas <span class="math notranslate nohighlight">\(v \rightarrow w\)</span> y  <span class="math notranslate nohighlight">\(w \rightarrow z\)</span> fueron eliminados del grafo.</p></li>
<li><p>Se inserta un nuevo arista <span class="math notranslate nohighlight">\(v \rightarrow z\)</span> y se representa con color rojo.</p></li>
</ul>
<div class="graphviz"><img src="_images/graphviz-14be5626ee411f35a47287f42c24255e0dc350bb.png" alt="digraph G {
    u, z [shape=circle;style=filled;color=deepskyblue];
    v [style=filled; color=green];
    &quot;G&quot; [shape=tripleoctagon; style=filled;
         color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; {u, z} [dir=none, weight=1, penwidth=3];
    u -&gt; v;
    v -&gt; z [label=&quot;{w}&quot;;color=red]
}" class="graphviz" /></div>
<p>Contrayendo <span class="math notranslate nohighlight">\(v\)</span>:</p>
<ul class="simple">
<li><p>El vértice <span class="math notranslate nohighlight">\(v\)</span> se elimina del grafo</p></li>
<li><p>Los aristas <span class="math notranslate nohighlight">\(u \rightarrow v\)</span>  y  <span class="math notranslate nohighlight">\(v \rightarrow z\)</span>  son removidos del grafo.</p></li>
<li><p>Se inserta un nuevo arista <span class="math notranslate nohighlight">\(u \rightarrow z\)</span> y se representa con color rojo.</p></li>
</ul>
<div class="graphviz"><img src="_images/graphviz-12be2629d707913e64a07fee1e387ff25af98fb6.png" alt="digraph G {
    u, z [shape=circle;style=filled;color=deepskyblue];
    &quot;G&quot; [shape=tripleoctagon; style=filled;
         color=deepskyblue;label = &quot;Rest of the Graph&quot;];

    rankdir=LR;
    G -&gt; {u, z} [dir=none, weight=1, penwidth=3];
    u -&gt; z [label=&quot;{v, w}&quot;;color=red]
}" class="graphviz" /></div>
<p>El arista <span class="math notranslate nohighlight">\(u \rightarrow z\)</span> tiene la información de los nodos que fueron contraídos.</p>
</section>
</section>
<section id="the-cycle">
<h2>El ciclo<a class="headerlink" href="#the-cycle" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Contraer un grafo se puede hacer con más de una operación. El orden de las operaciones afecta al gráfico contraído resultante; después de aplicar una operación, el conjunto de vértices que se pueden contraer con otra operación cambia.</p>
<p>Esta implementación alterna los tiempos `` max_cycles`` a través de `` operations_order``.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span>
<span class="n">do</span> <span class="n">max_cycles</span> <span class="n">times</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">operation</span> <span class="ow">in</span> <span class="n">operations_order</span><span class="p">)</span>
     <span class="p">{</span> <span class="n">do</span> <span class="n">operation</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="contracting-sample-data">
<h2>Contracción de los datos de muestra<a class="headerlink" href="#contracting-sample-data" title="Enlace permanente a este encabezado">¶</a></h2>
<p>En esta sección, la creación y el uso de un grafo contraído se mostrarán en el ejemplo.</p>
<ul class="simple">
<li><p>Se usa <a class="reference internal" href="sampledata.html"><span class="doc">Datos Muestra</span></a> para un grafo no dirigido</p></li>
<li><p>una operación sin salida primero seguida de una operación lineal.</p></li>
</ul>
<nav class="contents local" id="contenido">
<ul class="simple">
<li><p><a class="reference internal" href="#construction-of-the-graph-in-the-database" id="id2">Construcción del grafo en la base de datos</a></p>
<ul>
<li><p><a class="reference internal" href="#contraction-results" id="id3">Resultados de la Contracción</a></p></li>
<li><p><a class="reference internal" href="#add-additional-columns" id="id4">Añadir columnas adicionales</a></p></li>
<li><p><a class="reference internal" href="#store-contraction-information" id="id5">Almacenar información de contracción</a></p></li>
<li><p><a class="reference internal" href="#the-vertex-table-update" id="id6">Actualización de la tabla de vértices</a></p></li>
<li><p><a class="reference internal" href="#the-edge-table-update" id="id7">Actialización de la tabla de aristas</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-contracted-graph" id="id8">El grafo contraído</a></p>
<ul>
<li><p><a class="reference internal" href="#vertices-that-belong-to-the-contracted-graph" id="id9">Vértices que pertenecen al grafo contraído.</a></p></li>
<li><p><a class="reference internal" href="#edges-that-belong-to-the-contracted-graph" id="id10">Aristas que pertenecen al grafo contraído.</a></p></li>
<li><p><a class="reference internal" href="#contracted-graph" id="id11">El grafo contraído</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-contracted-graph" id="id12">Usando el grafo contraído</a></p>
<ul>
<li><p><a class="reference internal" href="#case-1-both-source-and-target-belong-to-the-contracted-graph" id="id13">Caso 1: Tanto el origen como el destino pertenecen al grafo contraído.</a></p></li>
<li><p><a class="reference internal" href="#case-2-source-and-or-target-belong-to-an-edge-subgraph" id="id14">Caso 2: El origen y/o el destino pertenecen a un subgrafo de aristas.</a></p></li>
<li><p><a class="reference internal" href="#case-3-source-and-or-target-belong-to-a-vertex" id="id15">Caso 3: El origen y/o el destino pertenecen a un vértice.</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="construction-of-the-graph-in-the-database">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Construcción del grafo en la base de datos</a><a class="headerlink" href="#construction-of-the-graph-in-the-database" title="Enlace permanente a este encabezado">¶</a></h3>
<p class="rubric">Datos Originales</p>
<p>La siguiente consulta muestra los datos originales implicados en la operación de contracción.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span>
<span class="n">FROM</span> <span class="n">edges</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span>
<span class="o">----+--------+--------+------+--------------</span>
  <span class="mi">1</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">3</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">15</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">4</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">5</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span>
  <span class="mi">6</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">9</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span>
 <span class="mi">12</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span>
 <span class="mi">13</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span>
 <span class="mi">14</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">15</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">16</span> <span class="o">|</span>     <span class="mi">15</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">17</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">18</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>     <span class="mi">14</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
<span class="p">(</span><span class="mi">18</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>El grafo original:</p>
<a class="reference internal image-reference" href="_images/Fig6-undirected.png"><img alt="_images/Fig6-undirected.png" src="_images/Fig6-undirected.png" style="width: 241.0px; height: 217.5px;" /></a>
<section id="contraction-results">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Resultados de la Contracción</a><a class="headerlink" href="#contraction-results" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Los resultados no representan al grafo contraído. Representan los cambios realizados en el grafo después de aplicar el algoritmo de contracción.</p>
<p>Observe que los vértices, por ejemplo, <span class="math notranslate nohighlight">\(6\)</span> , no aparecen en los resultados porque no se vieron afectados por el algoritmo de contracción.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span>
  <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">directed</span> <span class="o">=&gt;</span> <span class="n">false</span><span class="p">);</span>
 <span class="nb">type</span> <span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span>
<span class="o">------+----+---------------------+--------+--------+------</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>                 <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>               <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">v</span>    <span class="o">|</span> <span class="mi">14</span> <span class="o">|</span> <span class="p">{</span><span class="mi">13</span><span class="p">}</span>                <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>               <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
 <span class="n">e</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>                <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Después de realizar la operación de contracción sin salida:</p>
<a class="reference internal image-reference" href="_images/undirected_sampledata_b.png"><img alt="_images/undirected_sampledata_b.png" src="_images/undirected_sampledata_b.png" style="width: 175.75px; height: 198.5px;" /></a>
<p>Después de hacer la operación de contracción lineal al grafo anterior:</p>
<a class="reference internal image-reference" href="_images/undirected_sampledata_c.png"><img alt="_images/undirected_sampledata_c.png" src="_images/undirected_sampledata_c.png" style="width: 184.25px; height: 193.75px;" /></a>
<p>El proceso para crear el grafo de contracción en la base de datos:</p>
</section>
<section id="add-additional-columns">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Añadir columnas adicionales</a><a class="headerlink" href="#add-additional-columns" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Agregar de columnas adicionales a las tablas <code class="docutils literal notranslate"><span class="pre">edge_table</span></code> y <code class="docutils literal notranslate"><span class="pre">edge_table_vertices_pgr</span></code> donde:</p>
<table class="docutils align-default" style="width: 80">
<thead>
<tr class="row-odd"><th class="head"><p>Columna</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">contracted_vertices</span></code></p></td>
<td><p>El conjunto de vértices que pertenecen al vértice/arista</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">is_contracted</span></code></p></td>
<td><p>En la tabla de vértices</p>
<ul class="simple">
<li><p>En caso de “”true”” se contrae el vértice, no forma parte del grafo contraído.</p></li>
<li><p>En caso de “”false”” el vértice no se contrae, su parte del grafo contraído.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">is_new</span></code></p></td>
<td><p>En la tabla de aristas</p>
<ul class="simple">
<li><p>En caso de `` true``, la arista se generó por el algoritmo de contracción. Es parte del grafo contraído.</p></li>
<li><p>En caso de <code class="docutils literal notranslate"><span class="pre">false</span></code> , la arista es una arista original, podría ser o no parte del grafo contraído.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">vertices</span> <span class="n">ADD</span> <span class="n">is_contracted</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">vertices</span> <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edges</span> <span class="n">ADD</span> <span class="n">is_new</span> <span class="n">BOOLEAN</span> <span class="n">DEFAULT</span> <span class="n">false</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">edges</span> <span class="n">ADD</span> <span class="n">contracted_vertices</span> <span class="n">BIGINT</span><span class="p">[];</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</section>
<section id="store-contraction-information">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Almacenar información de contracción</a><a class="headerlink" href="#store-contraction-information" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Almacenar los <a class="reference internal" href="#contraction-results">resultados de la contracción</a> en una tabla</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">INTO</span> <span class="n">contraction_results</span>
<span class="n">FROM</span> <span class="n">pgr_contraction</span><span class="p">(</span>
  <span class="s1">&#39;SELECT id, source, target, cost, reverse_cost FROM edges&#39;</span><span class="p">,</span>
  <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">directed</span> <span class="o">=&gt;</span> <span class="n">false</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">7</span>
</pre></div>
</div>
</section>
<section id="the-vertex-table-update">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Actualización de la tabla de vértices</a><a class="headerlink" href="#the-vertex-table-update" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Usar la columna <code class="docutils literal notranslate"><span class="pre">is_contracted</span></code> para indicar los vértices contraídos.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertices</span>
<span class="n">SET</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span>  <span class="n">unnest</span><span class="p">(</span><span class="n">contracted_vertices</span><span class="p">)</span> <span class="n">FROM</span>  <span class="n">contraction_results</span><span class="p">);</span>
<span class="n">UPDATE</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Lllena <code class="docutils literal notranslate"><span class="pre">contracted_vertices</span></code> con la información de los resultados que pertenecen a los vértices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertices</span>
<span class="n">SET</span> <span class="n">contracted_vertices</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">contracted_vertices</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span> <span class="n">AND</span> <span class="n">vertices</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">contraction_results</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<p>La tabla de vértices modificada:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_contracted</span>
<span class="n">FROM</span> <span class="n">vertices</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">is_contracted</span>
<span class="o">----+---------------------+---------------</span>
  <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">2</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">3</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>                 <span class="o">|</span> <span class="n">f</span>
  <span class="mi">5</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">6</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">7</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>               <span class="o">|</span> <span class="n">f</span>
  <span class="mi">8</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
  <span class="mi">9</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">10</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">11</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">12</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">13</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">14</span> <span class="o">|</span> <span class="p">{</span><span class="mi">13</span><span class="p">}</span>                <span class="o">|</span> <span class="n">f</span>
 <span class="mi">15</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
 <span class="mi">16</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">17</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">t</span>
<span class="p">(</span><span class="mi">17</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="the-edge-table-update">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Actialización de la tabla de aristas</a><a class="headerlink" href="#the-edge-table-update" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Inserte las nuevas aristas generadas por pgr_contraction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">edges</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_new</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">true</span>
<span class="n">FROM</span> <span class="n">contraction_results</span>
<span class="n">WHERE</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">4</span>
</pre></div>
</div>
<p>La modificada <code class="docutils literal notranslate"><span class="pre">edge_table</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">,</span> <span class="n">is_new</span>
<span class="n">FROM</span> <span class="n">edges</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">contracted_vertices</span> <span class="o">|</span> <span class="n">is_new</span>
<span class="o">----+--------+--------+------+--------------+---------------------+--------</span>
  <span class="mi">1</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">3</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">15</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">4</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">5</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">6</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
  <span class="mi">9</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">12</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">13</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">14</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">15</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>     <span class="mi">17</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">16</span> <span class="o">|</span>     <span class="mi">15</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">17</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">18</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>     <span class="mi">14</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>                     <span class="o">|</span> <span class="n">f</span>
 <span class="mi">19</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>               <span class="o">|</span> <span class="n">t</span>
 <span class="mi">20</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>               <span class="o">|</span> <span class="n">t</span>
 <span class="mi">21</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>                <span class="o">|</span> <span class="n">t</span>
 <span class="mi">22</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>                <span class="o">|</span> <span class="n">t</span>
<span class="p">(</span><span class="mi">22</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="the-contracted-graph">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">El grafo contraído</a><a class="headerlink" href="#the-contracted-graph" title="Enlace permanente a este encabezado">¶</a></h3>
<section id="vertices-that-belong-to-the-contracted-graph">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Vértices que pertenecen al grafo contraído.</a><a class="headerlink" href="#vertices-that-belong-to-the-contracted-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span>
<span class="n">FROM</span> <span class="n">vertices</span>
<span class="n">WHERE</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">false</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span>
<span class="o">----</span>
  <span class="mi">4</span>
  <span class="mi">7</span>
 <span class="mi">10</span>
 <span class="mi">11</span>
 <span class="mi">12</span>
 <span class="mi">14</span>
 <span class="mi">16</span>
<span class="p">(</span><span class="mi">7</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="edges-that-belong-to-the-contracted-graph">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Aristas que pertenecen al grafo contraído.</a><a class="headerlink" href="#edges-that-belong-to-the-contracted-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">vertices_in_graph</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="nb">id</span>
  <span class="n">FROM</span> <span class="n">vertices</span>
  <span class="n">WHERE</span> <span class="n">is_contracted</span> <span class="o">=</span> <span class="n">false</span>
<span class="p">)</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">contracted_vertices</span>
<span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span> <span class="n">source</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">vertices_in_graph</span><span class="p">)</span>
<span class="n">AND</span> <span class="n">target</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">vertices_in_graph</span><span class="p">)</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">contracted_vertices</span>
<span class="o">----+--------+--------+------+--------------+---------------------</span>
  <span class="mi">5</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>
  <span class="mi">9</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span>
 <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
 <span class="mi">19</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>
 <span class="mi">20</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>
 <span class="mi">21</span> <span class="o">|</span>     <span class="mi">12</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">17</span><span class="p">}</span>
 <span class="mi">22</span> <span class="o">|</span>     <span class="mi">10</span> <span class="o">|</span>     <span class="mi">16</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>           <span class="o">-</span><span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">}</span>
<span class="p">(</span><span class="mi">8</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="contracted-graph">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">El grafo contraído</a><a class="headerlink" href="#contracted-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<a class="reference internal image-reference" href="_images/newgraph.png"><img alt="_images/newgraph.png" src="_images/newgraph.png" style="width: 184.25px; height: 193.75px;" /></a>
</section>
</section>
<section id="using-the-contracted-graph">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Usando el grafo contraído</a><a class="headerlink" href="#using-the-contracted-graph" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Uso del grafo contraído con <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></p>
<p>Hay tres casos al calcular la ruta más corta entre un origen y un destino determinados en un grafo contraído:</p>
<ul class="simple">
<li><p>Caso 1: Tanto el origen como el destino pertenecen al grafo contraído.</p></li>
<li><p>Caso 2: El origen y/o el destino pertenecen a un subgrafo de aristas.</p></li>
<li><p>Caso 3: El origen y/o el destino pertenecen a un vértice.</p></li>
</ul>
<section id="case-1-both-source-and-target-belong-to-the-contracted-graph">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Caso 1: Tanto el origen como el destino pertenecen al grafo contraído.</a><a class="headerlink" href="#case-1-both-source-and-target-belong-to-the-contracted-graph" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Usando las <a class="reference internal" href="#edges-that-belong-to-the-contracted-graph">Aristas que pertenecen al grafo contraído.</a> en las líneas 10 a 19.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>CREATE OR REPLACE FUNCTION my_dijkstra(
<span class="linenos"> 2</span>  departure BIGINT, destination BIGINT,
<span class="linenos"> 3</span>  OUT seq INTEGER, OUT path_seq INTEGER,
<span class="linenos"> 4</span>  OUT node BIGINT, OUT edge BIGINT,
<span class="linenos"> 5</span>  OUT cost FLOAT, OUT agg_cost FLOAT)
<span class="linenos"> 6</span>RETURNS SETOF RECORD AS
<span class="linenos"> 7</span>$BODY$
<span class="linenos"> 8</span>SELECT * FROM pgr_dijkstra(
<span class="linenos"> 9</span>  $$
<span class="hll"><span class="linenos">10</span>  WITH
</span><span class="hll"><span class="linenos">11</span>  vertices_in_graph AS (
</span><span class="hll"><span class="linenos">12</span>    SELECT id
</span><span class="hll"><span class="linenos">13</span>    FROM vertices
</span><span class="hll"><span class="linenos">14</span>    WHERE is_contracted = false
</span><span class="hll"><span class="linenos">15</span>  )
</span><span class="hll"><span class="linenos">16</span>  SELECT id, source, target, cost, reverse_cost
</span><span class="hll"><span class="linenos">17</span>  FROM edges
</span><span class="hll"><span class="linenos">18</span>  WHERE source IN (SELECT * FROM vertices_in_graph)
</span><span class="hll"><span class="linenos">19</span>  AND target IN (SELECT * FROM vertices_in_graph)
</span><span class="linenos">20</span>  $$,
<span class="linenos">21</span>  departure, destination, false);
<span class="linenos">22</span>$BODY$
<span class="linenos">23</span>LANGUAGE SQL VOLATILE;
<span class="linenos">24</span>CREATE FUNCTION
</pre></div>
</div>
<p class="rubric">Caso 1</p>
<p>Cuando el origen y el destino pertenecen al grafo contraído, se encuentra ruta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">10</span> <span class="o">|</span>    <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">2</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 2</p>
<p>Cuando el origen y/o el destino pertenecen a un subgrafo de aristas, no se encuentra una ruta.</p>
<p>En este caso, el grafo contraído no tiene una arista que se conecte con el nodo <span class="math notranslate nohighlight">\(4\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 3</p>
<p>Cuando el origen y/o el destino pertenecen a un vértice, no se encuentra ruta.</p>
<p>En este caso, el grafo contraído no tiene algún arista que conecte con el nodo <span class="math notranslate nohighlight">\(7\)</span> ni con el nodo <span class="math notranslate nohighlight">\(4\)</span> del segundo caso.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="case-2-source-and-or-target-belong-to-an-edge-subgraph">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Caso 2: El origen y/o el destino pertenecen a un subgrafo de aristas.</a><a class="headerlink" href="#case-2-source-and-or-target-belong-to-an-edge-subgraph" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Refinar la función anterior para incluir nodos que pertenezcan a una arista.</p>
<ul class="simple">
<li><p>Los vértices que deben ampliarse se calculan en las líneas 10 a 16.</p></li>
<li><p>Añadiendo al grafo contraído esa sección adicional en las líneas 25 a 27.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>CREATE OR REPLACE FUNCTION my_dijkstra(
<span class="linenos"> 2</span>  departure BIGINT, destination BIGINT,
<span class="linenos"> 3</span>  OUT seq INTEGER, OUT path_seq INTEGER,
<span class="linenos"> 4</span>  OUT node BIGINT, OUT edge BIGINT,
<span class="linenos"> 5</span>  OUT cost FLOAT, OUT agg_cost FLOAT)
<span class="linenos"> 6</span>RETURNS SETOF RECORD AS
<span class="linenos"> 7</span>$BODY$
<span class="linenos"> 8</span>SELECT * FROM pgr_dijkstra(
<span class="linenos"> 9</span>  $$
<span class="hll"><span class="linenos">10</span>  WITH
</span><span class="hll"><span class="linenos">11</span>  edges_to_expand AS (
</span><span class="hll"><span class="linenos">12</span>    SELECT id
</span><span class="hll"><span class="linenos">13</span>    FROM edges
</span><span class="hll"><span class="linenos">14</span>    WHERE ARRAY[$$ || departure || $$]::BIGINT[] &lt;@ contracted_vertices
</span><span class="hll"><span class="linenos">15</span>    OR ARRAY[$$ || destination || $$]::BIGINT[] &lt;@ contracted_vertices
</span><span class="hll"><span class="linenos">16</span>  ),
</span><span class="linenos">17</span>
<span class="linenos">18</span>  vertices_in_graph AS (
<span class="linenos">19</span>    SELECT id
<span class="linenos">20</span>    FROM vertices
<span class="linenos">21</span>    WHERE is_contracted = false
<span class="linenos">22</span>
<span class="linenos">23</span>    UNION
<span class="linenos">24</span>
<span class="hll"><span class="linenos">25</span>    SELECT unnest(contracted_vertices)
</span><span class="hll"><span class="linenos">26</span>    FROM edges
</span><span class="hll"><span class="linenos">27</span>    WHERE id IN (SELECT id FROM edges_to_expand)
</span><span class="linenos">28</span>  )
<span class="linenos">29</span>
<span class="linenos">30</span>  SELECT id, source, target, cost, reverse_cost
<span class="linenos">31</span>  FROM edges
<span class="linenos">32</span>  WHERE source IN (SELECT * FROM vertices_in_graph)
<span class="linenos">33</span>  AND target IN (SELECT * FROM vertices_in_graph)
<span class="linenos">34</span>  $$,
<span class="linenos">35</span>  departure, destination, false);
<span class="linenos">36</span>$BODY$
<span class="linenos">37</span>LANGUAGE SQL VOLATILE;
<span class="linenos">38</span>CREATE FUNCTION
</pre></div>
</div>
<p class="rubric">Caso 1</p>
<p>Cuando el origen y el destino pertenecen al grafo contraído, se encuentra ruta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">10</span> <span class="o">|</span>    <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">2</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 2</p>
<p>Cuando el origen y/o el destino pertenecen a un subgrafo de arista, entonces se encuentra una ruta.</p>
<p>El grafo de ruteo ahora tiene un arista que se conecta con el nodo <span class="math notranslate nohighlight">\(4\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span>   <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">16</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">3</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 3</p>
<p>Cuando el origen y/o el destino pertenecen a un vértice, no se encuentra ruta.</p>
<p>En este caso, el grafo contraído no tiene una arista que se conecte con el nodo <span class="math notranslate nohighlight">\(7\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="case-3-source-and-or-target-belong-to-a-vertex">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Caso 3: El origen y/o el destino pertenecen a un vértice.</a><a class="headerlink" href="#case-3-source-and-or-target-belong-to-a-vertex" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Refinar la función anterior para incluir nodos que pertenezcan a una arista.</p>
<ul class="simple">
<li><p>Los vértices que deben ampliarse se calculan en las líneas 18 a 23.</p></li>
<li><p>Añadiendo al grafo contraído esa sección adicional en las líneas 38 a 40.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>CREATE OR REPLACE FUNCTION my_dijkstra(
<span class="linenos"> 2</span>  departure BIGINT, destination BIGINT,
<span class="linenos"> 3</span>  OUT seq INTEGER, OUT path_seq INTEGER,
<span class="linenos"> 4</span>  OUT node BIGINT, OUT edge BIGINT,
<span class="linenos"> 5</span>  OUT cost FLOAT, OUT agg_cost FLOAT)
<span class="linenos"> 6</span>RETURNS SETOF RECORD AS
<span class="linenos"> 7</span>$BODY$
<span class="linenos"> 8</span>SELECT * FROM pgr_dijkstra(
<span class="linenos"> 9</span>  $$
<span class="linenos">10</span>  WITH
<span class="linenos">11</span>  edges_to_expand AS (
<span class="linenos">12</span>    SELECT id
<span class="linenos">13</span>    FROM edges
<span class="linenos">14</span>    WHERE ARRAY[$$ || departure || $$]::BIGINT[] &lt;@ contracted_vertices
<span class="linenos">15</span>    OR ARRAY[$$ || destination || $$]::BIGINT[] &lt;@ contracted_vertices
<span class="linenos">16</span>  ),
<span class="linenos">17</span>
<span class="hll"><span class="linenos">18</span>  vertices_to_expand AS (
</span><span class="hll"><span class="linenos">19</span>    SELECT id
</span><span class="hll"><span class="linenos">20</span>    FROM vertices
</span><span class="hll"><span class="linenos">21</span>    WHERE ARRAY[$$ || departure || $$]::BIGINT[] &lt;@ contracted_vertices
</span><span class="hll"><span class="linenos">22</span>    OR ARRAY[$$ || destination || $$]::BIGINT[] &lt;@ contracted_vertices
</span><span class="hll"><span class="linenos">23</span>  ),
</span><span class="linenos">24</span>
<span class="linenos">25</span>  vertices_in_graph AS (
<span class="linenos">26</span>    SELECT id
<span class="linenos">27</span>    FROM vertices
<span class="linenos">28</span>    WHERE is_contracted = false
<span class="linenos">29</span>
<span class="linenos">30</span>    UNION
<span class="linenos">31</span>
<span class="linenos">32</span>    SELECT unnest(contracted_vertices)
<span class="linenos">33</span>    FROM edges
<span class="linenos">34</span>    WHERE id IN (SELECT id FROM edges_to_expand)
<span class="linenos">35</span>
<span class="linenos">36</span>    UNION
<span class="linenos">37</span>
<span class="hll"><span class="linenos">38</span>    SELECT unnest(contracted_vertices)
</span><span class="hll"><span class="linenos">39</span>    FROM vertices
</span><span class="hll"><span class="linenos">40</span>    WHERE id IN (SELECT id FROM vertices_to_expand)
</span><span class="linenos">41</span>  )
<span class="linenos">42</span>
<span class="linenos">43</span>  SELECT id, source, target, cost, reverse_cost
<span class="linenos">44</span>  FROM edges
<span class="linenos">45</span>  WHERE source IN (SELECT * FROM vertices_in_graph)
<span class="linenos">46</span>  AND target IN (SELECT * FROM vertices_in_graph)
<span class="linenos">47</span>  $$,
<span class="linenos">48</span>  departure, destination, false);
<span class="linenos">49</span>$BODY$
<span class="linenos">50</span>LANGUAGE SQL VOLATILE;
<span class="linenos">51</span>CREATE FUNCTION
</pre></div>
</div>
<p class="rubric">Caso 1</p>
<p>Cuando el origen y el destino pertenecen al grafo contraído, se encuentra ruta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">10</span> <span class="o">|</span>    <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>   <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">2</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 2</p>
<p>El cambio de código no afecta a este caso, por lo que cuando el origen o el destino pertenecen a un subgrafo de aristas, aún se puede encontrar ruta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span>   <span class="mi">16</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">16</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">3</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p class="rubric">Caso 3</p>
<p>Cuando el origen y/o el destino pertenecen a un vértice, entonces se encuentra ruta.</p>
<p>Ahora, el grafo de ruteo tiene un arista que se conecta con el nodo <span class="math notranslate nohighlight">\(7\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">my_dijkstra</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">path_seq</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">agg_cost</span>
<span class="o">-----+----------+------+------+------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">0</span>
   <span class="mi">2</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>   <span class="mi">10</span> <span class="o">|</span>   <span class="mi">19</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>        <span class="mi">1</span>
   <span class="mi">3</span> <span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span>    <span class="mi">7</span> <span class="o">|</span>    <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">3</span>
   <span class="mi">4</span> <span class="o">|</span>        <span class="mi">4</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>    <span class="mi">6</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>        <span class="mi">4</span>
   <span class="mi">5</span> <span class="o">|</span>        <span class="mi">5</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">5</span>
<span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
</section>
<section id="see-also">
<h2>Ver también<a class="headerlink" href="#see-also" title="Enlace permanente a este encabezado">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_contraction.html"><span class="doc">pgr_contraction</span></a></p></li>
<li><p><a class="reference internal" href="sampledata.html"><span class="doc">Datos Muestra</span></a></p></li>
<li><p><a class="reference external" href="https://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf">https://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf</a></p></li>
<li><p><a class="reference external" href="https://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf">https://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf</a></p></li>
</ul>
<p class="rubric">Índices y tablas</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Índice</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Página de Búsqueda</span></a></p></li>
</ul>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v3.3.5.<br/>
      Actualizado por última vez en oct 11, 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>