<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>pgr_lineGraphFull - Experimental &#8212; pgRouting Manual (3.3)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
<script src="_static/page_history.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Vehicle Routing Functions - Category (Experimental)" href="VRP-category.html" />
    <link rel="prev" title="pgr_lineGraph - Experimental" href="pgr_lineGraph.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/pgrouting.png"></span>
          pgRouting</a>
        <span class="navbar-text navbar-version pull-left"><b>v3.3.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Sample Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting Concepts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="routingFunctions.html">Function Families</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Proposed Functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="experimental.html">Experimental Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> - Experimental</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#signatures">Signatures</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#inner-queries">Inner Queries</a><ul>
<li><a class="reference internal" href="#edges-sql">Edges SQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result-columns">Result Columns</a></li>
<li><a class="reference internal" href="#additional-examples">Additional Examples</a><ul>
<li><a class="reference internal" href="#the-data">The data</a></li>
<li><a class="reference internal" href="#the-transformation">The transformation</a></li>
<li><a class="reference internal" href="#creating-table-that-identifies-transformed-vertices">Creating table that identifies transformed vertices</a><ul>
<li><a class="reference internal" href="#store-edge-results">Store edge results</a></li>
<li><a class="reference internal" href="#create-the-mapping-table">Create the mapping table</a></li>
<li><a class="reference internal" href="#filling-the-mapping-table">Filling the mapping table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-soft-restriction">Adding a soft restriction</a><ul>
<li><a class="reference internal" href="#idenifying-the-restriction">Idenifying the restriction</a></li>
<li><a class="reference internal" href="#adding-a-value-to-the-restriction">Adding a value to the restriction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplifying-leaf-vertices">Simplifying leaf vertices</a><ul>
<li><a class="reference internal" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value">Using the vertex map give the leaf verices their original value.</a></li>
<li><a class="reference internal" href="#removing-self-loops-on-leaf-nodes">Removing self loops on leaf nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-routing-graph">Complete routing graph</a><ul>
<li><a class="reference internal" href="#add-edges-from-the-original-graph">Add edges from the original graph</a></li>
<li><a class="reference internal" href="#add-the-newly-calculated-edges">Add the newly calculated edges</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-routing-graph">Using the routing graph</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="pgr_lineGraph.html" title="Previous Chapter: pgr_lineGraph - Experimental"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; pgr_lineGraph...</span>
    </a>
  </li>
  <li>
    <a href="VRP-category.html" title="Next Chapter: Vehicle Routing Functions - Category (Experimental)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Vehicle Routi... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
 <div class="line"><br/></div> <script> document.write(get_history("pgr_lineGraphFull","en")); </script>
      
  <div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
</ul>
<section id="pgr-linegraphfull-experimental">
<h1><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> - Experimental<a class="headerlink" href="#pgr-linegraphfull-experimental" title="Permalink to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> — Transforms a given graph into a new graph where all of
the vertices from the original graph are converted to line graphs.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Possible server crash</p>
<ul class="simple">
<li><p>These functions might create a server crash</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Experimental functions</p>
<ul class="simple">
<li><p>They are not officially of the current release.</p></li>
<li><p>They likely will not be officially be part of the next release:</p>
<ul>
<li><p>The functions might not make use of ANY-INTEGER and ANY-NUMERICAL</p></li>
<li><p>Name might change.</p></li>
<li><p>Signature might change.</p></li>
<li><p>Functionality might change.</p></li>
<li><p>pgTap tests might be missing.</p></li>
<li><p>Might need c/c++ coding.</p></li>
<li><p>May lack documentation.</p></li>
<li><p>Documentation if any might need to be rewritten.</p></li>
<li><p>Documentation examples might need to be automatically generated.</p></li>
<li><p>Might need a lot of feedback from the comunity.</p></li>
<li><p>Might depend on a proposed function of pgRouting</p></li>
<li><p>Might depend on a deprecated function of pgRouting</p></li>
</ul>
</li>
</ul>
</div>
<p class="rubric">Availability</p>
<ul class="simple">
<li><p>Version 2.6.0</p>
<ul>
<li><p>New <strong>Experimental</strong> function</p></li>
</ul>
</li>
</ul>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code>, converts original directed graph to a directed line graph
by converting each vertex to a complete graph and keeping all the original
edges.
The new connecting edges have a cost 0 and go between the adjacent original
edges, respecting the directionality.</p>
<p>A possible application of the resulting graph is <strong>“routing with two edge
restrictions”</strong>:</p>
<ul class="simple">
<li><p>Setting a cost of using the vertex when routing between edges on the
connecting edge</p></li>
<li><p>Forbid the routing between two edges by removing the connecting edge</p></li>
</ul>
<p>This is possible because each of the intersections (vertices) in the original
graph are now complete graphs that have a new edge for each possible turn across
that intersection.</p>
<p>The main characteristics are:</p>
<ul class="simple">
<li><p>This function is for <strong>directed</strong> graphs.</p></li>
<li><p>Results are undefined when a negative vertex id is used in the input graph.</p></li>
<li><p>Results are undefined when a duplicated edge id is used in the input graph.</p></li>
<li><p>Running time: TBD</p></li>
</ul>
</section>
<section id="signatures">
<span id="index-0"></span><h2>Signatures<a class="headerlink" href="#signatures" title="Permalink to this heading">¶</a></h2>
<p class="rubric">Summary</p>
<div class="signatures admonition">
<p class="admonition-title"></p>
<div class="line-block">
<div class="line">pgr_lineGraphFull(<a class="reference internal" href="#edges-sql">Edges SQL</a>)</div>
</div>
<div class="line-block">
<div class="line">RETURNS SET OF <code class="docutils literal notranslate"><span class="pre">(seq,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost,</span> <span class="pre">edge)</span></code></div>
<div class="line">OR EMPTY SET</div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>Full line graph of subgraph of edges <span class="math notranslate nohighlight">\(\{4, 7, 8, 10\}\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
 seq | source | target | cost | edge
-----+--------+--------+------+------
   1 |     -1 |      7 |    1 |    4
   2 |      6 |     -1 |    0 |    0
   3 |     -2 |      6 |    1 |   -4
   4 |     -3 |      3 |    1 |   -7
   5 |     -4 |     11 |    1 |    8
   6 |     -5 |      8 |    1 |   10
   7 |      7 |     -2 |    0 |    0
   8 |      7 |     -3 |    0 |    0
   9 |      7 |     -4 |    0 |    0
  10 |      7 |     -5 |    0 |    0
  11 |     -6 |     -2 |    0 |    0
  12 |     -6 |     -3 |    0 |    0
  13 |     -6 |     -4 |    0 |    0
  14 |     -6 |     -5 |    0 |    0
  15 |     -7 |     -2 |    0 |    0
  16 |     -7 |     -3 |    0 |    0
  17 |     -7 |     -4 |    0 |    0
  18 |     -7 |     -5 |    0 |    0
  19 |     -8 |     -2 |    0 |    0
  20 |     -8 |     -3 |    0 |    0
  21 |     -8 |     -4 |    0 |    0
  22 |     -8 |     -5 |    0 |    0
  23 |     -9 |     -6 |    1 |    7
  24 |      3 |     -9 |    0 |    0
  25 |    -10 |     -7 |    1 |   -8
  26 |     11 |    -10 |    0 |    0
  27 |    -11 |     -8 |    1 |  -10
  28 |      8 |    -11 |    0 |    0
(28 rows)

</pre></div>
</div>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#edges-sql">Edges SQL</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></td>
<td><p><a class="reference internal" href="#edges-sql">Edges SQL</a> as described below.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="inner-queries">
<h2>Inner Queries<a class="headerlink" href="#inner-queries" title="Permalink to this heading">¶</a></h2>
<section id="edges-sql">
<h3>Edges SQL<a class="headerlink" href="#edges-sql" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 81">
<colgroup>
<col style="width: 17.7%" />
<col style="width: 17.7%" />
<col style="width: 8.9%" />
<col style="width: 55.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifier of the edge.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifier of the first end point vertex of the edge.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p><strong>ANY-INTEGER</strong></p></td>
<td></td>
<td><p>Identifier of the second end point vertex of the edge.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><strong>ANY-NUMERICAL</strong></p></td>
<td></td>
<td><p>Weight of the edge (<code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code></p></td>
<td><p><strong>ANY-NUMERICAL</strong></p></td>
<td><p>-1</p></td>
<td><p>Weight of the edge (<code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>)</p>
<ul class="simple">
<li><p>When negative: edge (<code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>) does not exist, therefore
it’s not part of the graph.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<dl class="field-list simple">
<dt class="field-odd">ANY-INTEGER<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p>
</dd>
<dt class="field-even">ANY-NUMERICAL<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>, <code class="docutils literal notranslate"><span class="pre">REAL</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p>
</dd>
</dl>
</section>
</section>
<section id="result-columns">
<h2>Result Columns<a class="headerlink" href="#result-columns" title="Permalink to this heading">¶</a></h2>
<p>RETURNS SET OF <code class="docutils literal notranslate"><span class="pre">(seq,</span> <span class="pre">source,</span> <span class="pre">target,</span> <span class="pre">cost,</span> <span class="pre">edge)</span></code></p>
<table class="docutils align-default" style="width: 81">
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></td>
<td><p>Sequential value starting from <strong>1</strong>.</p>
<ul class="simple">
<li><p>Gives a local identifier for the edge</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p>Identifier of the source vertex of the current edge.</p>
<ul class="simple">
<li><p>When <cite>negative</cite>: the source is the reverse edge in the original graph.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BIGINT</span></code></p></td>
<td><p>Identifier of the target vertex of the current edge.</p>
<ul class="simple">
<li><p>When <cite>negative</cite>: the target is the reverse edge in the original graph.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cost</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><p>Weight of the edge (<code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>).</p>
<ul class="simple">
<li><p>When <cite>negative</cite>: edge (<code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>) does not exist,
therefore it’s not part of the graph.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code></p></td>
<td><p>Weight of the edge (<code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>).</p>
<ul class="simple">
<li><p>When <cite>negative</cite>: edge (<code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>) does not exist,
therefore it’s not part of the graph.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="additional-examples">
<h2>Additional Examples<a class="headerlink" href="#additional-examples" title="Permalink to this heading">¶</a></h2>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#the-data" id="id1">The data</a></p></li>
<li><p><a class="reference internal" href="#the-transformation" id="id2">The transformation</a></p></li>
<li><p><a class="reference internal" href="#creating-table-that-identifies-transformed-vertices" id="id3">Creating table that identifies transformed vertices</a></p>
<ul>
<li><p><a class="reference internal" href="#store-edge-results" id="id4">Store edge results</a></p></li>
<li><p><a class="reference internal" href="#create-the-mapping-table" id="id5">Create the mapping table</a></p></li>
<li><p><a class="reference internal" href="#filling-the-mapping-table" id="id6">Filling the mapping table</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-soft-restriction" id="id7">Adding a soft restriction</a></p>
<ul>
<li><p><a class="reference internal" href="#idenifying-the-restriction" id="id8">Idenifying the restriction</a></p></li>
<li><p><a class="reference internal" href="#adding-a-value-to-the-restriction" id="id9">Adding a value to the restriction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#simplifying-leaf-vertices" id="id10">Simplifying leaf vertices</a></p>
<ul>
<li><p><a class="reference internal" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value" id="id11">Using the vertex map give the leaf verices their original value.</a></p></li>
<li><p><a class="reference internal" href="#removing-self-loops-on-leaf-nodes" id="id12">Removing self loops on leaf nodes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#complete-routing-graph" id="id13">Complete routing graph</a></p>
<ul>
<li><p><a class="reference internal" href="#add-edges-from-the-original-graph" id="id14">Add edges from the original graph</a></p></li>
<li><p><a class="reference internal" href="#add-the-newly-calculated-edges" id="id15">Add the newly calculated edges</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-routing-graph" id="id16">Using the routing graph</a></p></li>
</ul>
</nav>
<p>The examples of this section are based on the <a class="reference internal" href="sampledata.html"><span class="doc">Sample Data</span></a> network.
The examples include the subgraph including edges 4, 7, 8, and 10 with
<code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code>.</p>
<section id="the-data">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">The data</a><a class="headerlink" href="#the-data" title="Permalink to this heading">¶</a></h3>
<p>This example displays how this graph transformation works to create additional
edges for each possible turn in a graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span>
<span class="n">FROM</span> <span class="n">edges</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">reverse_cost</span>
<span class="o">----+--------+--------+------+--------------</span>
  <span class="mi">4</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>            <span class="mi">1</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<div class="line-block">
<div class="line"><img alt="first" class="align-middle" src="_images/original.png" /></div>
</div>
</section>
<section id="the-transformation">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">The transformation</a><a class="headerlink" href="#the-transformation" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
 seq | source | target | cost | edge
-----+--------+--------+------+------
   1 |     -1 |      7 |    1 |    4
   2 |      6 |     -1 |    0 |    0
   3 |     -2 |      6 |    1 |   -4
   4 |     -3 |      3 |    1 |   -7
   5 |     -4 |     11 |    1 |    8
   6 |     -5 |      8 |    1 |   10
   7 |      7 |     -2 |    0 |    0
   8 |      7 |     -3 |    0 |    0
   9 |      7 |     -4 |    0 |    0
  10 |      7 |     -5 |    0 |    0
  11 |     -6 |     -2 |    0 |    0
  12 |     -6 |     -3 |    0 |    0
  13 |     -6 |     -4 |    0 |    0
  14 |     -6 |     -5 |    0 |    0
  15 |     -7 |     -2 |    0 |    0
  16 |     -7 |     -3 |    0 |    0
  17 |     -7 |     -4 |    0 |    0
  18 |     -7 |     -5 |    0 |    0
  19 |     -8 |     -2 |    0 |    0
  20 |     -8 |     -3 |    0 |    0
  21 |     -8 |     -4 |    0 |    0
  22 |     -8 |     -5 |    0 |    0
  23 |     -9 |     -6 |    1 |    7
  24 |      3 |     -9 |    0 |    0
  25 |    -10 |     -7 |    1 |   -8
  26 |     11 |    -10 |    0 |    0
  27 |    -11 |     -8 |    1 |  -10
  28 |      8 |    -11 |    0 |    0
(28 rows)

</pre></div>
</div>
<div class="line-block">
<div class="line"><img alt="second" class="align-middle" src="_images/transformation.png" /></div>
</div>
<p>In the transformed graph, all of the edges from the original graph are still
present (yellow), but we now have additional edges for every turn that could be
made across vertex 7 (orange).</p>
</section>
<section id="creating-table-that-identifies-transformed-vertices">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Creating table that identifies transformed vertices</a><a class="headerlink" href="#creating-table-that-identifies-transformed-vertices" title="Permalink to this heading">¶</a></h3>
<p>The vertices in the transformed graph are each created by splitting up the
vertices in the original graph.
Unless a vertex in the original graph is a leaf
vertex, it will generate more than one vertex in the transformed graph.
One of the newly created vertices in the transformed graph will be given the
same vertex identifier as the vertex that it was created from in the original
graph, but the rest of the newly created vertices will have negative vertex ids.</p>
<p>Following is an example of how to generate a table that maps the ids of the
newly created vertices with the original vertex that they were created from</p>
<section id="store-edge-results">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Store edge results</a><a class="headerlink" href="#store-edge-results" title="Permalink to this heading">¶</a></h4>
<p>The first step is to store the results of the <code class="docutils literal notranslate"><span class="pre">pgr_lineGraphFull</span></code> call into a
table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq AS id, source, target, cost, edge
INTO lineGraph_edges
FROM pgr_lineGraphFull(
  $$SELECT id, source, target, cost, reverse_cost
  FROM edges
  WHERE id IN (4, 7, 8, 10)$$);
SELECT 28
</pre></div>
</div>
</section>
<section id="create-the-mapping-table">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Create the mapping table</a><a class="headerlink" href="#create-the-mapping-table" title="Permalink to this heading">¶</a></h4>
<p>From the original graph’s vertex information</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">NULL</span><span class="p">::</span><span class="n">BIGINT</span> <span class="n">original_id</span>
<span class="n">INTO</span> <span class="n">vertex_map</span>
<span class="n">FROM</span> <span class="n">vertices</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Add the new vertices</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>INSERT INTO vertex_map (id)
(SELECT id
FROM pgr_extractVertices(
  $$SELECT id, source, target FROM lineGraph_edges$$) WHERE id &lt; 0);
INSERT 0 11
</pre></div>
</div>
</section>
<section id="filling-the-mapping-table">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Filling the mapping table</a><a class="headerlink" href="#filling-the-mapping-table" title="Permalink to this heading">¶</a></h4>
<p>The positive vertex identifiers are the original identifiers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">vertex_map</span>
<span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="nb">id</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Inspecting the vertices map</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="mi">17</span> <span class="o">|</span>          <span class="mi">17</span>
  <span class="mi">16</span> <span class="o">|</span>          <span class="mi">16</span>
  <span class="mi">15</span> <span class="o">|</span>          <span class="mi">15</span>
  <span class="mi">14</span> <span class="o">|</span>          <span class="mi">14</span>
  <span class="mi">13</span> <span class="o">|</span>          <span class="mi">13</span>
  <span class="mi">12</span> <span class="o">|</span>          <span class="mi">12</span>
  <span class="mi">11</span> <span class="o">|</span>          <span class="mi">11</span>
  <span class="mi">10</span> <span class="o">|</span>          <span class="mi">10</span>
   <span class="mi">9</span> <span class="o">|</span>           <span class="mi">9</span>
   <span class="mi">8</span> <span class="o">|</span>           <span class="mi">8</span>
   <span class="mi">7</span> <span class="o">|</span>           <span class="mi">7</span>
   <span class="mi">6</span> <span class="o">|</span>           <span class="mi">6</span>
   <span class="mi">5</span> <span class="o">|</span>           <span class="mi">5</span>
   <span class="mi">4</span> <span class="o">|</span>           <span class="mi">4</span>
   <span class="mi">3</span> <span class="o">|</span>           <span class="mi">3</span>
   <span class="mi">2</span> <span class="o">|</span>           <span class="mi">2</span>
   <span class="mi">1</span> <span class="o">|</span>           <span class="mi">1</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>
<span class="p">(</span><span class="mi">28</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>The self loops happen when there is no cost traveling to the <code class="docutils literal notranslate"><span class="pre">target</span></code> and the
source has an original value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">source</span> <span class="n">AS</span> <span class="n">targets_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span>
  <span class="n">WHERE</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">edge</span> <span class="o">|</span> <span class="n">targets_original_id</span>
<span class="o">----+--------+--------+------+------+---------------------</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">6</span>
  <span class="mi">7</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
  <span class="mi">8</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
  <span class="mi">9</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
 <span class="mi">10</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">7</span>
 <span class="mi">24</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">3</span>
 <span class="mi">26</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                  <span class="mi">11</span>
 <span class="mi">28</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">8</span>
<span class="p">(</span><span class="mi">8</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Updating values from self loops</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">self_loops</span> <span class="n">AS</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="n">AS</span> <span class="n">targets_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span>
  <span class="n">WHERE</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertex_map</span> <span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="n">targets_original_id</span>
<span class="n">FROM</span> <span class="n">self_loops</span> <span class="n">WHERE</span> <span class="n">target</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Inspecting the vertices table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>           <span class="mi">6</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>           <span class="mi">3</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>          <span class="mi">11</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>           <span class="mi">8</span>
<span class="p">(</span><span class="mi">11</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Updating from inner self loops</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">assigned_vertices</span>
<span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">original_id</span>
  <span class="n">FROM</span> <span class="n">vertex_map</span>
  <span class="n">WHERE</span> <span class="n">original_id</span> <span class="n">IS</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">),</span>
<span class="n">cross_edges</span>
<span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">original_id</span> <span class="n">AS</span> <span class="n">source_original_id</span>
  <span class="n">FROM</span> <span class="n">lineGraph_edges</span> <span class="n">AS</span> <span class="n">e</span>
  <span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v</span> <span class="n">ON</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">source</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">assigned_vertices</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">UPDATE</span> <span class="n">vertex_map</span> <span class="n">SET</span> <span class="n">original_id</span> <span class="o">=</span> <span class="n">source_original_id</span>
<span class="n">FROM</span> <span class="n">cross_edges</span> <span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Inspecting the vertices map</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">vertex_map</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span> <span class="n">DESC</span><span class="p">;</span>
 <span class="nb">id</span>  <span class="o">|</span> <span class="n">original_id</span>
<span class="o">-----+-------------</span>
  <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>           <span class="mi">6</span>
  <span class="o">-</span><span class="mi">2</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">3</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">4</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">5</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">6</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">7</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">8</span> <span class="o">|</span>           <span class="mi">7</span>
  <span class="o">-</span><span class="mi">9</span> <span class="o">|</span>           <span class="mi">3</span>
 <span class="o">-</span><span class="mi">10</span> <span class="o">|</span>          <span class="mi">11</span>
 <span class="o">-</span><span class="mi">11</span> <span class="o">|</span>           <span class="mi">8</span>
<span class="p">(</span><span class="mi">11</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="adding-a-soft-restriction">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Adding a soft restriction</a><a class="headerlink" href="#adding-a-soft-restriction" title="Permalink to this heading">¶</a></h3>
<p>A soft restriction going from vertex 6 to vertex 3 using edges 4 -&gt; 7 is wanted.</p>
<section id="idenifying-the-restriction">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Idenifying the restriction</a><a class="headerlink" href="#idenifying-the-restriction" title="Permalink to this heading">¶</a></h4>
<p>Running a <a class="reference internal" href="pgr_dijkstraNear.html"><span class="doc">pgr_dijkstraNear - Proposed</span></a> the edge with cost 0, edge 8, is where the
cost will be increased</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, path_seq, start_vid, end_vid, node, original_id, edge, cost, agg_cost
FROM (SELECT * FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))) dn
JOIN vertex_map AS v1 ON (node = v1.id);
 seq | path_seq | start_vid | end_vid | node | original_id | edge | cost | agg_cost
-----+----------+-----------+---------+------+-------------+------+------+----------
   3 |        3 |        -1 |       3 |   -3 |           7 |    4 |    1 |        1
   1 |        1 |        -1 |       3 |   -1 |           6 |    1 |    1 |        0
   4 |        4 |        -1 |       3 |    3 |           3 |   -1 |    0 |        2
   2 |        2 |        -1 |       3 |    7 |           7 |    8 |    0 |        1
(4 rows)

</pre></div>
</div>
<p>The edge to be altered is <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">cost</span> <span class="pre">=</span> <span class="pre">0</span> <span class="pre">AND</span> <span class="pre">seq</span> <span class="pre">!=</span> <span class="pre">1</span> <span class="pre">AND</span> <span class="pre">edge</span> <span class="pre">!=</span> <span class="pre">-1</span></code> from
the previus query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT edge FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))
WHERE cost = 0 AND seq != 1 AND edge != -1;
 edge
------
    8
(1 row)

</pre></div>
</div>
</section>
<section id="adding-a-value-to-the-restriction">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Adding a value to the restriction</a><a class="headerlink" href="#adding-a-value-to-the-restriction" title="Permalink to this heading">¶</a></h4>
<p>Updating the cost to the edge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>UPDATE lineGraph_edges
SET cost = 100
WHERE id IN (
SELECT edge FROM pgr_dijkstraNear(
  $$SELECT * FROM lineGraph_edges$$,
  (SELECT array_agg(id) FROM vertex_map where original_id = 6),
  (SELECT array_agg(id) FROM vertex_map where original_id = 3))
WHERE cost = 0 AND seq != 1 AND edge != -1);
UPDATE 1
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>Routing from <span class="math notranslate nohighlight">\(6\)</span> to <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<p>Now the route does not use edge 8 and does a U turn on a leaf vertex.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstraNear(
    $$SELECT * FROM lineGraph_edges$$,
    (SELECT array_agg(id) FROM vertex_map where original_id = 6),
    (SELECT array_agg(id) FROM vertex_map where original_id = 3)))
SELECT seq, path_seq, start_vid, end_vid, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | start_vid | end_vid | node | original_id | edge | cost | agg_cost
-----+----------+-----------+---------+------+-------------+------+------+----------
   1 |        1 |        -1 |       3 |   -1 |           6 |    1 |    1 |        0
   2 |        2 |        -1 |       3 |    7 |           7 |   10 |    0 |        1
   3 |        3 |        -1 |       3 |   -5 |           7 |    6 |    1 |        1
   4 |        4 |        -1 |       3 |    8 |           8 |   28 |    0 |        2
   5 |        5 |        -1 |       3 |  -11 |           8 |   27 |    1 |        2
   6 |        6 |        -1 |       3 |   -8 |           7 |   20 |    0 |        3
   7 |        7 |        -1 |       3 |   -3 |           7 |    4 |    1 |        3
   8 |        8 |        -1 |       3 |    3 |           3 |   -1 |    0 |        4
(8 rows)

</pre></div>
</div>
</section>
</section>
<section id="simplifying-leaf-vertices">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Simplifying leaf vertices</a><a class="headerlink" href="#simplifying-leaf-vertices" title="Permalink to this heading">¶</a></h3>
<p>In this example, there is no additional cost for traversing a leaf vertex.</p>
<section id="using-the-vertex-map-give-the-leaf-verices-their-original-value">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Using the vertex map give the leaf verices their original value.</a><a class="headerlink" href="#using-the-vertex-map-give-the-leaf-verices-their-original-value" title="Permalink to this heading">¶</a></h4>
<p>On the source column</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">u_turns</span> <span class="n">AS</span> <span class="p">(</span>
<span class="n">SELECT</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">eid</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">linegraph_edges</span> <span class="k">as</span> <span class="n">e</span>
<span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v1</span> <span class="n">ON</span> <span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">AND</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">UPDATE</span> <span class="n">lineGraph_edges</span>
<span class="n">SET</span> <span class="n">source</span> <span class="o">=</span> <span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">u_turns</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
<p>On the target column</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WITH</span>
<span class="n">u_turns</span> <span class="n">AS</span> <span class="p">(</span>
<span class="n">SELECT</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">eid</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">linegraph_edges</span> <span class="k">as</span> <span class="n">e</span>
<span class="n">JOIN</span> <span class="n">vertex_map</span> <span class="n">AS</span> <span class="n">v1</span> <span class="n">ON</span> <span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">AND</span> <span class="n">v1</span><span class="o">.</span><span class="n">original_id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">UPDATE</span> <span class="n">lineGraph_edges</span>
<span class="n">SET</span> <span class="n">target</span> <span class="o">=</span> <span class="n">original_id</span>
<span class="n">FROM</span> <span class="n">u_turns</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="mi">8</span>
</pre></div>
</div>
</section>
<section id="removing-self-loops-on-leaf-nodes">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Removing self loops on leaf nodes</a><a class="headerlink" href="#removing-self-loops-on-leaf-nodes" title="Permalink to this heading">¶</a></h4>
<p>The self loops of the leaf nodes are</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">linegraph_edges</span>
<span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="n">target</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">cost</span> <span class="o">|</span> <span class="n">edge</span>
<span class="o">----+--------+--------+------+------</span>
  <span class="mi">2</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">24</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">26</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>     <span class="mi">11</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
 <span class="mi">28</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>      <span class="mi">8</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>    <span class="mi">0</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Which can be removed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">linegraph_edges</span>
<span class="n">WHERE</span> <span class="n">source</span> <span class="o">=</span> <span class="n">target</span><span class="p">;</span>
<span class="n">DELETE</span> <span class="mi">4</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>Routing from <span class="math notranslate nohighlight">\(6\)</span> to <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<p>Routing can be done now using the original vertices id using <a class="reference internal" href="pgr_dijkstra.html"><span class="doc">pgr_dijkstra</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM lineGraph_edges$$, 6, 3))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    6 |           6 |    1 |    1 |        0
   2 |        2 |    7 |           7 |    9 |    0 |        1
   3 |        3 |   -4 |           7 |    5 |    1 |        1
   4 |        4 |   11 |          11 |   25 |    1 |        2
   5 |        5 |   -7 |           7 |   16 |    0 |        3
   6 |        6 |   -3 |           7 |    4 |    1 |        3
   7 |        7 |    3 |           3 |   -1 |    0 |        4
(7 rows)

</pre></div>
</div>
</section>
</section>
<section id="complete-routing-graph">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Complete routing graph</a><a class="headerlink" href="#complete-routing-graph" title="Permalink to this heading">¶</a></h3>
<section id="add-edges-from-the-original-graph">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Add edges from the original graph</a><a class="headerlink" href="#add-edges-from-the-original-graph" title="Permalink to this heading">¶</a></h4>
<p>Add all the edges that are not involved in the line graph process to the new
table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span>
<span class="n">INTO</span> <span class="n">new_graph</span> <span class="kn">from</span> <span class="nn">edges</span>
<span class="n">WHERE</span> <span class="nb">id</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">SELECT</span> <span class="mi">14</span>
</pre></div>
</div>
<p>Some administrative tasks to get new identifiers for the edges</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">new_graph_id_seq</span><span class="p">;</span>
<span class="n">CREATE</span> <span class="n">SEQUENCE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">new_graph</span> <span class="n">ALTER</span> <span class="n">COLUMN</span> <span class="nb">id</span> <span class="n">SET</span> <span class="n">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;new_graph_id_seq&#39;</span><span class="p">);</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">new_graph</span> <span class="n">ALTER</span> <span class="n">COLUMN</span> <span class="nb">id</span> <span class="n">SET</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">SEQUENCE</span> <span class="n">new_graph_id_seq</span> <span class="n">OWNED</span> <span class="n">BY</span> <span class="n">new_graph</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">SEQUENCE</span>
<span class="n">SELECT</span> <span class="n">setval</span><span class="p">(</span><span class="s1">&#39;new_graph_id_seq&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">new_graph</span><span class="p">));</span>
 <span class="n">setval</span>
<span class="o">--------</span>
     <span class="mi">18</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="add-the-newly-calculated-edges">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Add the newly calculated edges</a><a class="headerlink" href="#add-the-newly-calculated-edges" title="Permalink to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">new_graph</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="n">FROM</span> <span class="n">lineGraph_edges</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">24</span>
</pre></div>
</div>
</section>
</section>
<section id="using-the-routing-graph">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Using the routing graph</a><a class="headerlink" href="#using-the-routing-graph" title="Permalink to this heading">¶</a></h3>
<p>When using this method for routing with soft restrictions there will be uturns</p>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>Routing from <span class="math notranslate nohighlight">\(6\)</span> to <span class="math notranslate nohighlight">\(3\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM new_graph$$, 6, 3))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    6 |           6 |   35 |    1 |        0
   2 |        2 |    7 |           7 |   20 |    0 |        1
   3 |        3 |   -4 |           7 |   41 |    1 |        1
   4 |        4 |   11 |          11 |   37 |    1 |        2
   5 |        5 |   -7 |           7 |   27 |    0 |        3
   6 |        6 |   -3 |           7 |   40 |    1 |        3
   7 |        7 |    3 |           3 |   -1 |    0 |        4
(7 rows)

</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>Routing from <span class="math notranslate nohighlight">\(5\)</span> to <span class="math notranslate nohighlight">\(1\)</span></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WITH
results AS (
  SELECT * FROM pgr_dijkstra(
    $$SELECT * FROM new_graph$$, 5, 1))
SELECT seq, path_seq, node, original_id, edge, cost, agg_cost
FROM results
LEFT JOIN vertex_map AS v1 ON (node = v1.id) ORDER BY seq;
 seq | path_seq | node | original_id | edge | cost | agg_cost
-----+----------+------+-------------+------+------+----------
   1 |        1 |    5 |           5 |    1 |    1 |        0
   2 |        2 |    6 |           6 |   35 |    1 |        1
   3 |        3 |    7 |           7 |   20 |    0 |        2
   4 |        4 |   -4 |           7 |   41 |    1 |        2
   5 |        5 |   11 |          11 |   37 |    1 |        3
   6 |        6 |   -7 |           7 |   27 |    0 |        4
   7 |        7 |   -3 |           7 |   40 |    1 |        4
   8 |        8 |    3 |           3 |    6 |    1 |        5
   9 |        9 |    1 |           1 |   -1 |    0 |        6
(9 rows)

</pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Line_graph">https://en.wikipedia.org/wiki/Line_graph</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Complete_graph">https://en.wikipedia.org/wiki/Complete_graph</a></p></li>
</ul>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v3.3.5.<br/>
      Last updated on Oct 11, 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>