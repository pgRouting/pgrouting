BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
CREATE TABLE jet_customers (
    id integer,
    x integer,
    y integer,
    pindex integer,
    dindex integer,
    demand integer,
    opentime double precision,
    closetime double precision,
    servicetime double precision
);
CREATE TABLE
CREATE TABLE stops (
    iata_faa character varying(20),
    x integer,
    y integer,
    longitude double precision,
    latitude double precision
);
CREATE TABLE
COPY jet_customers (id, x, y, pindex, dindex, demand, opentime, closetime, servicetime) FROM stdin;
COPY 29
COPY stops (iata_faa, x, y, longitude, latitude) FROM stdin;
COPY 8
WITH
pickups AS (
    SELECT id, demand, x as p_x, y as p_y, opentime as p_open, closetime as p_close, servicetime as p_service
    FROM  jet_customers WHERE pindex = 0 AND id != 0
),
deliveries AS (
    SELECT pindex AS id, x as d_x, y as d_y, opentime as d_open, closetime as d_close, servicetime as d_service
    FROM  jet_customers WHERE dindex = 0 AND id != 0
)
SELECT * INTO jet_orders
FROM pickups JOIN deliveries USING(id) ORDER BY pickups.id;
SELECT 14
SELECT * FROM _pgr_pickDeliver(
    'SELECT id, x, y, demand, opentime, closetime, servicetime, pindex, dindex
     FROM jet_customers ORDER BY id', max_vehicles := 20, capacity:= 100, speed := 1000);
 seq | vehicle_id | vehicle_seq | stop_id |    travel_time    |   arrival_time    | wait_time | service_time |  departure_time
-----+------------+-------------+---------+-------------------+-------------------+-----------+--------------+------------------
   1 |          1 |           1 |       0 |                 0 |                 0 |         0 |            0 |                0
   2 |          1 |           2 |      27 | 0.617668195716762 | 0.617668195716762 |         0 |           30 | 30.6176681957168
   3 |          1 |           3 |      25 |                 0 |  30.6176681957168 |         0 |           30 | 60.6176681957168
   4 |          1 |           4 |      23 |                 0 |  60.6176681957168 |         0 |           30 | 90.6176681957168
   5 |          1 |           5 |      26 | 0.714478831037001 |  91.3321470267538 |         0 |           30 | 121.332147026754
   6 |          1 |           6 |      19 |                 0 |  121.332147026754 |         0 |           30 | 151.332147026754
   7 |          1 |           7 |       7 | 0.587132864009502 |  151.919279890763 |         0 |           30 | 181.919279890763
   8 |          1 |           8 |       5 |                 0 |  181.919279890763 |         0 |           30 | 211.919279890763
   9 |          1 |           9 |       3 |                 0 |  211.919279890763 |         0 |           30 | 241.919279890763
  10 |          1 |          10 |       1 |                 0 |  241.919279890763 |         0 |           30 | 271.919279890763
  11 |          1 |          11 |      24 |  1.33232503541741 |  273.251604926181 |         0 |           30 | 303.251604926181
  12 |          1 |          12 |      20 |                 0 |  303.251604926181 |         0 |           30 | 333.251604926181
  13 |          1 |          13 |      12 |                 0 |  333.251604926181 |         0 |           30 | 363.251604926181
  14 |          1 |          14 |       4 |                 0 |  363.251604926181 |         0 |           30 | 393.251604926181
  15 |          1 |          15 |      21 |   1.7278440323131 |  394.979448958494 |         0 |           30 | 424.979448958494
  16 |          1 |          16 |      17 |                 0 |  424.979448958494 |         0 |           30 | 454.979448958494
  17 |          1 |          17 |       6 |                 0 |  454.979448958494 |         0 |           30 | 484.979448958494
  18 |          1 |          18 |      15 | 0.415245710393256 |  485.394694668887 |         0 |           30 | 515.394694668887
  19 |          1 |          19 |      13 |                 0 |  515.394694668887 |         0 |           30 | 545.394694668887
  20 |          1 |          20 |      11 |                 0 |  545.394694668887 |         0 |           30 | 575.394694668887
  21 |          1 |          21 |       9 |                 0 |  575.394694668887 |         0 |           30 | 605.394694668887
  22 |          1 |          22 |      18 | 0.328105166067223 |  605.722799834954 |         0 |           30 | 635.722799834954
  23 |          1 |          23 |      10 |                 0 |  635.722799834954 |         0 |           30 | 665.722799834954
  24 |          1 |          24 |       2 |                 0 |  665.722799834954 |         0 |           30 | 695.722799834954
  25 |          1 |          25 |      28 | 0.414019323220547 |  696.136819158175 |         0 |           30 | 726.136819158175
  26 |          1 |          26 |      22 |                 0 |  726.136819158175 |         0 |           30 | 756.136819158175
  27 |          1 |          27 |      16 |                 0 |  756.136819158175 |         0 |           30 | 786.136819158175
  28 |          1 |          28 |       8 |                 0 |  786.136819158175 |         0 |           30 | 816.136819158175
  29 |          1 |          29 |      14 | 0.409882910109704 |  816.546702068285 |         0 |           30 | 846.546702068285
  30 |          1 |          30 |       0 | 0.117720006795786 |   846.66442207508 |         0 |            0 |  846.66442207508
  31 |         -2 |           0 |       0 |  6.66442207508029 |                -1 |         0 |          840 |  846.66442207508
(31 rows)

SELECT * FROM _pgr_pickDeliverEuclidean(
    'SELECT * FROM jet_orders ORDER BY id',
    'SELECT 0 AS id,
    2138 AS start_x, -119 AS start_y,
    0 AS start_open, 60000 AS start_close,
    100 AS capacity, 20 AS number, 1000 as speed',
    30);
 seq | vehicle_number | vehicle_id | vehicle_seq | order_id | stop_type | cargo |    travel_time    |   arrival_time    | wait_time | service_time |  departure_time
-----+----------------+------------+-------------+----------+-----------+-------+-------------------+-------------------+-----------+--------------+------------------
   1 |              1 |          0 |           1 |       -1 |         1 |     0 |                 0 |                 0 |         0 |            0 |                0
   2 |              1 |          0 |           2 |       27 |         2 |     6 | 0.617668195716762 | 0.617668195716762 |         0 |           30 | 30.6176681957168
   3 |              1 |          0 |           3 |       25 |         2 |    26 |                 0 |  30.6176681957168 |         0 |           30 | 60.6176681957168
   4 |              1 |          0 |           4 |       23 |         2 |    40 |                 0 |  60.6176681957168 |         0 |           30 | 90.6176681957168
   5 |              1 |          0 |           5 |       25 |         3 |    20 | 0.714478831037001 |  91.3321470267538 |         0 |           30 | 121.332147026754
   6 |              1 |          0 |           6 |       19 |         2 |    36 |                 0 |  121.332147026754 |         0 |           30 | 151.332147026754
   7 |              1 |          0 |           7 |        7 |         2 |    41 | 0.587132864009502 |  151.919279890763 |         0 |           30 | 181.919279890763
   8 |              1 |          0 |           8 |        5 |         2 |    51 |                 0 |  181.919279890763 |         0 |           30 | 211.919279890763
   9 |              1 |          0 |           9 |        3 |         2 |    68 |                 0 |  211.919279890763 |         0 |           30 | 241.919279890763
  10 |              1 |          0 |          10 |        1 |         2 |    75 |                 0 |  241.919279890763 |         0 |           30 | 271.919279890763
  11 |              1 |          0 |          11 |       23 |         3 |    61 |  1.33232503541741 |  273.251604926181 |         0 |           30 | 303.251604926181
  12 |              1 |          0 |          12 |       19 |         3 |    45 |                 0 |  303.251604926181 |         0 |           30 | 333.251604926181
  13 |              1 |          0 |          13 |       11 |         3 |    33 |                 0 |  333.251604926181 |         0 |           30 | 363.251604926181
  14 |              1 |          0 |          14 |        3 |         3 |    16 |                 0 |  363.251604926181 |         0 |           30 | 393.251604926181
  15 |              1 |          0 |          15 |       21 |         2 |    22 |   1.7278440323131 |  394.979448958494 |         0 |           30 | 424.979448958494
  16 |              1 |          0 |          16 |       17 |         2 |    28 |                 0 |  424.979448958494 |         0 |           30 | 454.979448958494
  17 |              1 |          0 |          17 |        5 |         3 |    18 |                 0 |  454.979448958494 |         0 |           30 | 484.979448958494
  18 |              1 |          0 |          18 |       15 |         2 |    20 | 0.415245710393256 |  485.394694668887 |         0 |           30 | 515.394694668887
  19 |              1 |          0 |          19 |       13 |         2 |    29 |                 0 |  515.394694668887 |         0 |           30 | 545.394694668887
  20 |              1 |          0 |          20 |       11 |         2 |    41 |                 0 |  545.394694668887 |         0 |           30 | 575.394694668887
  21 |              1 |          0 |          21 |        9 |         2 |    54 |                 0 |  575.394694668887 |         0 |           30 | 605.394694668887
  22 |              1 |          0 |          22 |       17 |         3 |    48 | 0.328105166067223 |  605.722799834954 |         0 |           30 | 635.722799834954
  23 |              1 |          0 |          23 |        9 |         3 |    35 |                 0 |  635.722799834954 |         0 |           30 | 665.722799834954
  24 |              1 |          0 |          24 |        1 |         3 |    28 |                 0 |  665.722799834954 |         0 |           30 | 695.722799834954
  25 |              1 |          0 |          25 |       27 |         3 |    22 | 0.414019323220547 |  696.136819158175 |         0 |           30 | 726.136819158175
  26 |              1 |          0 |          26 |       21 |         3 |    16 |                 0 |  726.136819158175 |         0 |           30 | 756.136819158175
  27 |              1 |          0 |          27 |       15 |         3 |    14 |                 0 |  756.136819158175 |         0 |           30 | 786.136819158175
  28 |              1 |          0 |          28 |        7 |         3 |     9 |                 0 |  786.136819158175 |         0 |           30 | 816.136819158175
  29 |              1 |          0 |          29 |       13 |         3 |     0 | 0.409882910109704 |  816.546702068285 |         0 |           30 | 846.546702068285
  30 |              1 |          0 |          30 |       -1 |         6 |     0 | 0.117720006795786 |   846.66442207508 |         0 |            0 |  846.66442207508
  31 |             -2 |          0 |           0 |       -1 |        -1 |    -1 |  6.66442207508029 |                -1 |         0 |          840 |  846.66442207508
(31 rows)

ROLLBACK;
ROLLBACK
