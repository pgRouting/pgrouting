<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Migration guide &#8212; pgRouting Manual (3.5)</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
<script src="_static/page_history.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Release Notes" href="release_notes.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">
          pgRouting</a>
        <span class="navbar-text pull-left"><b>v3.5.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Sample Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgRouting-concepts.html">pgRouting Concepts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="routingFunctions.html">Function Families</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Proposed Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="experimental.html">Experimental Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Migration guide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Migration guide</a><ul>
<li><a class="reference internal" href="#migration-of-pgr-dijkstra">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a></li>
<li><a class="reference internal" href="#migration-of-pgr-maxcardinalitymatch">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_maxCardinalityMatch</span></code></a></li>
<li><a class="reference internal" href="#migration-of-restrictions">Migration of restrictions</a><ul>
<li><a class="reference internal" href="#old-restrictions-structure">Old restrictions structure</a><ul>
<li><a class="reference internal" href="#old-restrictions-contents">Old restrictions contents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-restrictions-structure">New restrictions structure</a><ul>
<li><a class="reference internal" href="#restrictions-data">Restrictions data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration">Migration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-of-pgr-trsp-vertices">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices)</a><ul>
<li><a class="reference internal" href="#migrating-pgr-trsp-vertices-using-pgr-dijkstra">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a></li>
<li><a class="reference internal" href="#migrating-pgr-trsp-vertices-using-pgr-trsp">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-of-pgr-trsp-edges">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges)</a><ul>
<li><a class="reference internal" href="#migrating-pgr-trsp-edges-using-pgr-withpoints">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_withPoints</span></code></a></li>
<li><a class="reference internal" href="#migrating-pgr-trsp-edges-using-pgr-trsp-withpoints">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp_withPoints</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-of-pgr-trspviavertices">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code></a><ul>
<li><a class="reference internal" href="#migrating-pgr-trspviavertices-using-pgr-dijkstravia">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstraVia</span></code></a></li>
<li><a class="reference internal" href="#migrating-pgr-trspviavertices-using-pgr-trspvia">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#migration-of-pgr-trspviaedges">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code></a><ul>
<li><a class="reference internal" href="#migrating-pgr-trspviaedges-using-pgr-withpointsvia">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_withPointsVia</span></code></a></li>
<li><a class="reference internal" href="#migrating-pgr-trspviaedges-using-pgr-trspvia-withpoints">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia_withPoints</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="release_notes.html" title="Previous Chapter: Release Notes"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; Release Notes</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
 <div class="line"><br/></div> <script> document.write(get_history("migration","en")); </script>
      
  <div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
</ul>
<section id="migration-guide">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Migration guide</a><a class="headerlink" href="#migration-guide" title="Permalink to this heading">Â¶</a></h1>
<p>Several functions are having changes on the signatures, and/or have been
replaced by new functions.</p>
<p>Results can be different because of the changes.</p>
<p>Migrating functions:</p>
<p><a class="reference internal" href="pgr_maxCardinalityMatch.html"><span class="doc">pgr_maxCardinalityMatch</span></a> works only for undirected graphs, therefore the
<code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has been removed.</p>
<p><a class="reference internal" href="pgr_trsp.html"><span class="doc">pgr_trsp - Proposed</span></a> signatures have changed and many issues have been fixed in the new
signatures. This section will show how to migrate from the old signatures to the
new replacement functions. This also affects the restrictions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All deprecated functions will be removed on next mayor version 4.0.0</p>
</div>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#migration-guide" id="id1">Migration guide</a></p>
<ul>
<li><p><a class="reference internal" href="#migration-of-pgr-dijkstra" id="id2">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a></p></li>
<li><p><a class="reference internal" href="#migration-of-pgr-maxcardinalitymatch" id="id3">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_maxCardinalityMatch</span></code></a></p></li>
<li><p><a class="reference internal" href="#migration-of-restrictions" id="id4">Migration of restrictions</a></p>
<ul>
<li><p><a class="reference internal" href="#old-restrictions-structure" id="id5">Old restrictions structure</a></p>
<ul>
<li><p><a class="reference internal" href="#old-restrictions-contents" id="id6">Old restrictions contents</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#new-restrictions-structure" id="id7">New restrictions structure</a></p>
<ul>
<li><p><a class="reference internal" href="#restrictions-data" id="id8">Restrictions data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration" id="id9">Migration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration-of-pgr-trsp-vertices" id="id10">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices)</a></p>
<ul>
<li><p><a class="reference internal" href="#migrating-pgr-trsp-vertices-using-pgr-dijkstra" id="id11">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a></p></li>
<li><p><a class="reference internal" href="#migrating-pgr-trsp-vertices-using-pgr-trsp" id="id12">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration-of-pgr-trsp-edges" id="id13">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges)</a></p>
<ul>
<li><p><a class="reference internal" href="#migrating-pgr-trsp-edges-using-pgr-withpoints" id="id14">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_withPoints</span></code></a></p></li>
<li><p><a class="reference internal" href="#migrating-pgr-trsp-edges-using-pgr-trsp-withpoints" id="id15">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp_withPoints</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration-of-pgr-trspviavertices" id="id16">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#migrating-pgr-trspviavertices-using-pgr-dijkstravia" id="id17">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstraVia</span></code></a></p></li>
<li><p><a class="reference internal" href="#migrating-pgr-trspviavertices-using-pgr-trspvia" id="id18">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migration-of-pgr-trspviaedges" id="id19">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#migrating-pgr-trspviaedges-using-pgr-withpointsvia" id="id20">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_withPointsVia</span></code></a></p></li>
<li><p><a class="reference internal" href="#migrating-pgr-trspviaedges-using-pgr-trspvia-withpoints" id="id21">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia_withPoints</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#see-also" id="id22">See Also</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="migration-of-pgr-dijkstra">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a><a class="headerlink" href="#migration-of-pgr-dijkstra" title="Permalink to this heading">Â¶</a></h2>
<p>Signatures to be migrated:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to One</cite>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to Many</cite>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>Many to One</cite>)</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Before Migration<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>Output columns are <code class="docutils literal notranslate"><span class="pre">(seq,</span> <span class="pre">path_seq,</span> <span class="pre">[start_vid],</span> <span class="pre">[end_vid],</span> <span class="pre">node,</span> <span class="pre">edge,</span> <span class="pre">cost,</span> <span class="pre">agg_cost)</span></code></p>
<ul>
<li><p>Depending on the overload used the columns <code class="docutils literal notranslate"><span class="pre">start_vid</span></code> and <code class="docutils literal notranslate"><span class="pre">end_vid</span></code>
might be missing:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to One</cite>) does not have <code class="docutils literal notranslate"><span class="pre">start_vid</span></code> and
<code class="docutils literal notranslate"><span class="pre">end_vid</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to Many</cite>) does not have <code class="docutils literal notranslate"><span class="pre">start_vid</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>Many to One</cite>) does not have <code class="docutils literal notranslate"><span class="pre">end_vid</span></code>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Migration<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>Be aware of the existance of the additional columns.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to One</cite>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">start_vid</span></code> contains the <strong>start vid</strong> parameter value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end_vid</span></code> contains the <strong>end vid</strong> parameter value.</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  6, 10);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |         6 |      10 |    6 |    4 |    1 |        0
   2 |        2 |         6 |      10 |    7 |    8 |    1 |        1
   3 |        3 |         6 |      10 |   11 |    9 |    1 |        2
   4 |        4 |         6 |      10 |   16 |   16 |    1 |        3
   5 |        5 |         6 |      10 |   15 |    3 |    1 |        4
   6 |        6 |         6 |      10 |   10 |   -1 |    0 |        5
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>One to Many</cite>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">start_vid</span></code> contains the <strong>start vid</strong> parameter value.</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  6, ARRAY[3, 10]);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |         6 |       3 |    6 |    4 |    1 |        0
   2 |        2 |         6 |       3 |    7 |    7 |    1 |        1
   3 |        3 |         6 |       3 |    3 |   -1 |    0 |        2
   4 |        1 |         6 |      10 |    6 |    4 |    1 |        0
   5 |        2 |         6 |      10 |    7 |    8 |    1 |        1
   6 |        3 |         6 |      10 |   11 |    9 |    1 |        2
   7 |        4 |         6 |      10 |   16 |   16 |    1 |        3
   8 |        5 |         6 |      10 |   15 |    3 |    1 |        4
   9 |        6 |         6 |      10 |   10 |   -1 |    0 |        5
(9 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> (<cite>Many to One</cite>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">end_vid</span></code> contains the <strong>end vid</strong> parameter value.</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  ARRAY[3, 6], 10);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |         3 |      10 |    3 |    7 |    1 |        0
   2 |        2 |         3 |      10 |    7 |    8 |    1 |        1
   3 |        3 |         3 |      10 |   11 |    9 |    1 |        2
   4 |        4 |         3 |      10 |   16 |   16 |    1 |        3
   5 |        5 |         3 |      10 |   15 |    3 |    1 |        4
   6 |        6 |         3 |      10 |   10 |   -1 |    0 |        5
   7 |        1 |         6 |      10 |    6 |    4 |    1 |        0
   8 |        2 |         6 |      10 |    7 |    8 |    1 |        1
   9 |        3 |         6 |      10 |   11 |    9 |    1 |        2
  10 |        4 |         6 |      10 |   16 |   16 |    1 |        3
  11 |        5 |         6 |      10 |   15 |    3 |    1 |        4
  12 |        6 |         6 |      10 |   10 |   -1 |    0 |        5
(12 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>If needed filter out the added columns, for example:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, path_seq, node, edge, cost, agg_cost FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  6, 10);
 seq | path_seq | node | edge | cost | agg_cost
-----+----------+------+------+------+----------
   1 |        1 |    6 |    4 |    1 |        0
   2 |        2 |    7 |    8 |    1 |        1
   3 |        3 |   11 |    9 |    1 |        2
   4 |        4 |   16 |   16 |    1 |        3
   5 |        5 |   15 |    3 |    1 |        4
   6 |        6 |   10 |   -1 |    0 |        5
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>If needed add the new columns, for example:</p>
<ul>
<li><p>In <a class="reference external" href="https://docs.pgrouting.org/3.0/en/contraction-family.html#case-1-both-source-and-target-belong-to-the-contracted-graph">v3.0</a>
the function <code class="docutils literal notranslate"><span class="pre">my_dijkstra</span></code> uses <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code>.</p></li>
<li><p>Starting from <a class="reference external" href="https://docs.pgrouting.org/3.5/en/contraction-family.html#case-1-both-source-and-target-belong-to-the-contracted-graph">v3.5</a>
the function <code class="docutils literal notranslate"><span class="pre">my_dijkstra</span></code> returns the new additional columns of
<code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="migration-of-pgr-maxcardinalitymatch">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_maxCardinalityMatch</span></code></a><a class="headerlink" href="#migration-of-pgr-maxcardinalitymatch" title="Permalink to this heading">Â¶</a></h2>
<p>Signature to be migrated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_maxCardinalityMatch</span><span class="p">(</span><span class="n">Edges</span> <span class="n">SQL</span><span class="p">,</span> <span class="p">[</span><span class="n">directed</span><span class="p">])</span>
 <span class="n">RETURNS</span> <span class="n">SETOF</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
<p>Migration is needed, because:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">cost</span></code> and <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> on the inner query</p></li>
<li><p>Results are ordered</p></li>
<li><p>Works for undirected graphs.</p></li>
<li><p>New signature</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pgr_maxCardinalityMatch(text)</span></code> returns only <code class="docutils literal notranslate"><span class="pre">edge</span></code> column.</p></li>
<li><p>The optional flag <code class="docutils literal notranslate"><span class="pre">directed</span></code> is removed.</p></li>
</ul>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Before migration<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_maxCardinalityMatch(
  $$SELECT id, source, target, cost AS going, reverse_cost AS coming FROM edges$$,
  directed =&gt; true
);
WARNING:  pgr_maxCardinalityMatch(text,boolean) deprecated on v3.4.0
 seq | edge | source | target
-----+------+--------+--------
   1 |    1 |      5 |      6
   2 |    5 |     10 |     11
   3 |    6 |      1 |      3
   4 |   13 |     12 |     17
   5 |   14 |      8 |      9
   6 |   16 |     15 |     16
   7 |   17 |      2 |      4
   8 |   18 |     13 |     14
(8 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>Columns used are <code class="docutils literal notranslate"><span class="pre">going</span></code> and <code class="docutils literal notranslate"><span class="pre">coming</span></code> to represent the existence of an
edge.</p></li>
<li><p>Flag <code class="docutils literal notranslate"><span class="pre">directed</span></code> was used to indicate if it was for a <strong>directed</strong> or
<strong>undirected</strong> graph.</p>
<ul>
<li><p>The flag <code class="docutils literal notranslate"><span class="pre">directed</span></code> is ignored.</p>
<ul>
<li><p>Regardless of itâs value it gives the result considering the graph as
<strong>undirected</strong>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Migration<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><p>Use the columns <code class="docutils literal notranslate"><span class="pre">cost</span></code> and <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> to represent the existence of an
edge.</p></li>
<li><p>Do not use the flag <code class="docutils literal notranslate"><span class="pre">directed</span></code>.</p></li>
<li><p>In the query returns only <code class="docutils literal notranslate"><span class="pre">edge</span></code> column.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_maxCardinalityMatch(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$
);
 edge
------
    1
    5
    6
   13
   14
   16
   17
   18
(8 rows)

</pre></div>
</div>
</section>
<section id="migration-of-restrictions">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Migration of restrictions</a><a class="headerlink" href="#migration-of-restrictions" title="Permalink to this heading">Â¶</a></h2>
<p>The structure of the restrictions have changed:</p>
<section id="old-restrictions-structure">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Old restrictions structure</a><a class="headerlink" href="#old-restrictions-structure" title="Permalink to this heading">Â¶</a></h3>
<p>On the deprecated signatures:</p>
<ul class="simple">
<li><p>Column <code class="docutils literal notranslate"><span class="pre">rid</span></code> is ignored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">via_path</span></code></p>
<ul>
<li><p>Must be in reverse order.</p></li>
<li><p>Is of type <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>.</p></li>
<li><p>When more than one via edge must be separated with <code class="docutils literal notranslate"><span class="pre">,</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_id</span></code></p>
<ul>
<li><p>Is the last edge of the forbidden path.</p></li>
<li><p>Is of type <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_cost</span></code></p>
<ul>
<li><p>Is of type <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.</p></li>
</ul>
</li>
</ul>
<p>Creation of the old restrictions table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">old_restrictions</span> <span class="p">(</span>
    <span class="n">rid</span> <span class="n">BIGINT</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">to_cost</span> <span class="n">FLOAT</span><span class="p">,</span>
    <span class="n">target_id</span> <span class="n">BIGINT</span><span class="p">,</span>
    <span class="n">via_path</span> <span class="n">TEXT</span>
<span class="p">);</span>
<span class="n">CREATE</span> <span class="n">TABLE</span>
</pre></div>
</div>
<p>Old restrictions fill up</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">old_restrictions</span> <span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">to_cost</span><span class="p">,</span> <span class="n">target_id</span><span class="p">,</span> <span class="n">via_path</span><span class="p">)</span> <span class="n">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="s1">&#39;4&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="s1">&#39;8&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="s1">&#39;7&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="s1">&#39;5, 3&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">5</span>
</pre></div>
</div>
<section id="old-restrictions-contents">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Old restrictions contents</a><a class="headerlink" href="#old-restrictions-contents" title="Permalink to this heading">Â¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">old_restrictions</span><span class="p">;</span>
 <span class="n">rid</span> <span class="o">|</span> <span class="n">to_cost</span> <span class="o">|</span> <span class="n">target_id</span> <span class="o">|</span> <span class="n">via_path</span>
<span class="o">-----+---------+-----------+----------</span>
   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">100</span> <span class="o">|</span>         <span class="mi">7</span> <span class="o">|</span> <span class="mi">4</span>
   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">100</span> <span class="o">|</span>        <span class="mi">11</span> <span class="o">|</span> <span class="mi">8</span>
   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">100</span> <span class="o">|</span>        <span class="mi">10</span> <span class="o">|</span> <span class="mi">7</span>
   <span class="mi">2</span> <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>         <span class="mi">9</span> <span class="o">|</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span>
   <span class="mi">3</span> <span class="o">|</span>     <span class="mi">100</span> <span class="o">|</span>         <span class="mi">9</span> <span class="o">|</span> <span class="mi">16</span>
<span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>The restriction with <code class="docutils literal notranslate"><span class="pre">rid</span> <span class="pre">=</span> <span class="pre">2</span></code> is representing <span class="math notranslate nohighlight">\(3 \rightarrow 5
\rightarrow9\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(3\rightarrow5\)</span></p>
<ul>
<li><p>is on column <code class="docutils literal notranslate"><span class="pre">via_path</span></code> in reverse order</p></li>
<li><p>is of type <code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(9\)</span></p>
<ul>
<li><p>is on column <code class="docutils literal notranslate"><span class="pre">target_id</span></code></p></li>
<li><p>is of type <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="new-restrictions-structure">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">New restrictions structure</a><a class="headerlink" href="#new-restrictions-structure" title="Permalink to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>Column <code class="docutils literal notranslate"><span class="pre">id</span></code> is ignored</p></li>
<li><p>Column <code class="docutils literal notranslate"><span class="pre">path</span></code></p>
<ul>
<li><p>Is of type <code class="docutils literal notranslate"><span class="pre">ARRAY[ANY-INTEGER]</span></code>.</p></li>
<li><p>Contains all the edges involved on the restriction.</p></li>
<li><p>The array has the ordered edges of the restriction.</p></li>
</ul>
</li>
<li><p>Column <code class="docutils literal notranslate"><span class="pre">cost</span></code></p>
<ul>
<li><p>Is of type <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code></p></li>
</ul>
</li>
</ul>
<p>The creation of the restrictions table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">restrictions</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">SERIAL</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
    <span class="n">path</span> <span class="n">BIGINT</span><span class="p">[],</span>
    <span class="n">cost</span> <span class="n">FLOAT</span>
<span class="p">);</span>
<span class="n">CREATE</span> <span class="n">TABLE</span>
</pre></div>
</div>
<p>Adding the restrictions</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">restrictions</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="n">VALUES</span>
<span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">100</span><span class="p">),</span>
<span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="mi">100</span><span class="p">),</span>
<span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="mi">100</span><span class="p">),</span>
<span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="mi">100</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">5</span>
</pre></div>
</div>
<section id="restrictions-data">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Restrictions data</a><a class="headerlink" href="#restrictions-data" title="Permalink to this heading">Â¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">restrictions</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span>  <span class="n">path</span>   <span class="o">|</span> <span class="n">cost</span>
<span class="o">----+---------+------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span>   <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">4</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span> <span class="o">|</span>    <span class="mi">4</span>
  <span class="mi">5</span> <span class="o">|</span> <span class="p">{</span><span class="mi">9</span><span class="p">,</span><span class="mi">16</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
<span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>The restriction with <code class="docutils literal notranslate"><span class="pre">rid</span> <span class="pre">=</span> <span class="pre">2</span></code> represents the path <span class="math notranslate nohighlight">\(3 \rightarrow5
\rightarrow9\)</span>.</p>
<ul class="simple">
<li><p>By inspection the path is clear.</p></li>
</ul>
</section>
</section>
<section id="migration">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Migration</a><a class="headerlink" href="#migration" title="Permalink to this heading">Â¶</a></h3>
<p>To transform the old restrictions table to the new restrictions structure,</p>
<ul class="simple">
<li><p>Create a new table with the new restrictions structure.</p>
<ul>
<li><p>In this migration guide <code class="docutils literal notranslate"><span class="pre">new_restrictions</span></code> is been used.</p></li>
</ul>
</li>
<li><p>For this migration pgRouting supplies an auxiliary function for reversal of an
array <code class="docutils literal notranslate"><span class="pre">_pgr_array_reverse</span></code> needed for the migration.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_pgr_array_reverse</span></code>:</p>
<ul>
<li><p>Was created temporally for this migration</p></li>
<li><p>Is not documented.</p></li>
<li><p>Will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">rid</span> <span class="n">AS</span> <span class="nb">id</span><span class="p">,</span>
  <span class="n">_pgr_array_reverse</span><span class="p">(</span>
    <span class="n">array_prepend</span><span class="p">(</span><span class="n">target_id</span><span class="p">,</span> <span class="n">string_to_array</span><span class="p">(</span><span class="n">via_path</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)::</span><span class="n">BIGINT</span><span class="p">[]))</span> <span class="n">AS</span> <span class="n">path</span><span class="p">,</span>
  <span class="n">to_cost</span> <span class="n">AS</span> <span class="n">cost</span>
  <span class="n">INTO</span> <span class="n">new_restrictions</span>
<span class="n">FROM</span> <span class="n">old_restrictions</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The migrated table contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">new_restrictions</span><span class="p">;</span>
 <span class="nb">id</span> <span class="o">|</span>  <span class="n">path</span>   <span class="o">|</span> <span class="n">cost</span>
<span class="o">----+---------+------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span>   <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span> <span class="o">|</span>    <span class="mi">4</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>  <span class="o">|</span>  <span class="mi">100</span>
<span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="migration-of-pgr-trsp-vertices">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices)</a><a class="headerlink" href="#migration-of-pgr-trsp-vertices" title="Permalink to this heading">Â¶</a></h2>
<p>Signature to be migrated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_trsp</span><span class="p">(</span><span class="n">Edges</span> <span class="n">SQL</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
         <span class="n">directed</span> <span class="n">boolean</span><span class="p">,</span> <span class="n">has_rcost</span> <span class="n">boolean</span>
         <span class="p">[,</span><span class="n">restrict_sql</span> <span class="n">text</span><span class="p">]);</span>
 <span class="n">RETURNS</span> <span class="n">SETOF</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The integral type of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
<li><p>The floating point type of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag is compulsory.</p>
<ul>
<li><p>Does not have a default value.</p></li>
</ul>
</li>
<li><p>Does not autodetect if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column exist.</p>
<ul>
<li><p>User must be careful to match the existence of the column with the value of
<code class="docutils literal notranslate"><span class="pre">has_rcost</span></code> parameter.</p></li>
</ul>
</li>
<li><p>The restrictions inner query is optional.</p></li>
<li><p>The output column names are meaningless</p></li>
</ul>
<p>Migrate by using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_dijkstra.html"><span class="doc">pgr_dijkstra</span></a> when there are no restrictions,</p></li>
<li><p><a class="reference internal" href="pgr_trsp.html"><span class="doc">pgr_trsp - Proposed</span></a> (One to One) when there are restrictions.</p></li>
</ul>
<section id="migrating-pgr-trsp-vertices-using-pgr-dijkstra">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code></a><a class="headerlink" href="#migrating-pgr-trsp-vertices-using-pgr-dijkstra" title="Permalink to this heading">Â¶</a></h3>
<p>The following query does not have restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  15, 16,
  true, true);
WARNING:  pgr_trsp(text,integer,integer,boolean,boolean) deprecated on v3.4.0
 seq | id1 | id2 | cost
-----+-----+-----+------
   0 |  15 |   3 |    1
   1 |  10 |   5 |    1
   2 |  11 |   9 |    1
   3 |  16 |  -1 |    0
(4 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_dijkstra.html"><span class="doc">pgr_dijkstra</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  15, 16);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |        15 |      16 |   15 |    3 |    1 |        0
   2 |        2 |        15 |      16 |   10 |    5 |    1 |        1
   3 |        3 |        15 |      16 |   11 |    9 |    1 |        2
   4 |        4 |        15 |      16 |   16 |   -1 |    0 |        3
(4 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The types casting has been removed.</p></li>
<li><p><a class="reference internal" href="pgr_dijkstra.html"><span class="doc">pgr_dijkstra</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types of the
function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, node::INTEGER AS id1, edge::INTEGER AS id2, cost
FROM pgr_dijkstra(
  $$SELECT id, source, target, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  15, 16);
 seq | id1 | id2 | cost
-----+-----+-----+------
   1 |  15 |   3 |    1
   2 |  10 |   5 |    1
   3 |  11 |   9 |    1
   4 |  16 |  -1 |    0
(4 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the edge</p></li>
</ul>
</section>
<section id="migrating-pgr-trsp-vertices-using-pgr-trsp">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Vertices) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code></a><a class="headerlink" href="#migrating-pgr-trsp-vertices-using-pgr-trsp" title="Permalink to this heading">Â¶</a></h3>
<p>The following query has restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  15, 16,
  true, true,
  $$SELECT to_cost, target_id::INTEGER, via_path
    FROM old_restrictions$$);
WARNING:  pgr_trsp(text,integer,integer,boolean,boolean) deprecated on v3.4.0
 seq | id1 | id2 | cost
-----+-----+-----+------
   0 |  15 |   3 |    1
   1 |  10 |   5 |    1
   2 |  11 |  11 |    1
   3 |  12 |  13 |    1
   4 |  17 |  15 |    1
   5 |  16 |  -1 |    0
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
<li><p>The restrictions are the last parameter of the function</p>
<ul>
<li><p>Using the old structure of restrictions</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_trsp.html"><span class="doc">pgr_trsp - Proposed</span></a> (One to One) instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp(
  $$SELECT id, source, target, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  $$SELECT * FROM new_restrictions$$,
  15, 16);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |        15 |      16 |   15 |    3 |    1 |        0
   2 |        2 |        15 |      16 |   10 |    5 |    1 |        1
   3 |        3 |        15 |      16 |   11 |   11 |    1 |        2
   4 |        4 |        15 |      16 |   12 |   13 |    1 |        3
   5 |        5 |        15 |      16 |   17 |   15 |    1 |        4
   6 |        6 |        15 |      16 |   16 |   -1 |    0 |        5
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The new structure of restrictions is been used.</p>
<ul>
<li><p>It is the second parameter.</p></li>
</ul>
</li>
<li><p>The types casting has been removed.</p></li>
<li><p><a class="reference internal" href="pgr_trsp.html"><span class="doc">pgr_trsp - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types of the
function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, node::INTEGER AS id1, edge::INTEGER AS id2, cost
FROM pgr_trsp(
  $$SELECT id, source, target, cost, reverse_cost
    FROM edges WHERE id != 16$$,
  $$SELECT * FROM new_restrictions$$,
  15, 16);
 seq | id1 | id2 | cost
-----+-----+-----+------
   1 |  15 |   3 |    1
   2 |  10 |   5 |    1
   3 |  11 |  11 |    1
   4 |  12 |  13 |    1
   5 |  17 |  15 |    1
   6 |  16 |  -1 |    0
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the edge</p></li>
</ul>
</section>
</section>
<section id="migration-of-pgr-trsp-edges">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges)</a><a class="headerlink" href="#migration-of-pgr-trsp-edges" title="Permalink to this heading">Â¶</a></h2>
<p>Signature to be migrated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_trsp</span><span class="p">(</span><span class="n">sql</span> <span class="n">text</span><span class="p">,</span> <span class="n">source_edge</span> <span class="n">integer</span><span class="p">,</span> <span class="n">source_pos</span> <span class="n">float8</span><span class="p">,</span>
                 <span class="n">target_edge</span> <span class="n">integer</span><span class="p">,</span> <span class="n">target_pos</span> <span class="n">float8</span><span class="p">,</span>
                 <span class="n">directed</span> <span class="n">boolean</span><span class="p">,</span> <span class="n">has_rcost</span> <span class="n">boolean</span>
                 <span class="p">[,</span><span class="n">restrict_sql</span> <span class="n">text</span><span class="p">]);</span>
<span class="n">RETURNS</span> <span class="n">SETOF</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The integral types of the <code class="docutils literal notranslate"><span class="pre">sql</span></code> can only be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
<li><p>The floating point type of the <code class="docutils literal notranslate"><span class="pre">sql</span></code> can only be <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag is compulsory.</p>
<ul>
<li><p>Does not have a default value.</p></li>
</ul>
</li>
<li><p>Does not autodetect if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column exist.</p>
<ul>
<li><p>User must be careful to match the existence of the column with the value of
<code class="docutils literal notranslate"><span class="pre">has_rcost</span></code> parameter.</p></li>
</ul>
</li>
<li><p>The restrictions inner query is optional.</p></li>
</ul>
<p>For these migration guide the following points will be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">pid</span><span class="p">,</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">side</span> <span class="n">FROM</span> <span class="n">pointsOfInterest</span>
<span class="n">WHERE</span> <span class="n">pid</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
 <span class="n">pid</span> <span class="o">|</span> <span class="n">edge_id</span> <span class="o">|</span> <span class="n">fraction</span> <span class="o">|</span> <span class="n">side</span>
<span class="o">-----+---------+----------+------</span>
   <span class="mi">3</span> <span class="o">|</span>      <span class="mi">12</span> <span class="o">|</span>      <span class="mf">0.6</span> <span class="o">|</span> <span class="n">l</span>
   <span class="mi">4</span> <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="mf">0.3</span> <span class="o">|</span> <span class="n">r</span>
<span class="p">(</span><span class="mi">2</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>Migrate by using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_withPoints.html"><span class="doc">pgr_withPoints - Proposed</span></a> when there are no restrictions,</p></li>
<li><p><a class="reference internal" href="pgr_trsp_withPoints.html"><span class="doc">pgr_trsp_withPoints - Proposed</span></a> (One to One) when there are restrictions.</p></li>
</ul>
<section id="migrating-pgr-trsp-edges-using-pgr-withpoints">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_withPoints</span></code></a><a class="headerlink" href="#migrating-pgr-trsp-edges-using-pgr-withpoints" title="Permalink to this heading">Â¶</a></h3>
<p>The following query does not have restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost
    FROM edges$$,
  6, 0.3, 12, 0.6,
  true, true);
WARNING:  pgr_trsp(text,integer,float,integer,float,boolean,boolean) deprecated on v3.4.0
 seq | id1 | id2 | cost
-----+-----+-----+------
   0 |  -1 |   6 |  0.7
   1 |   3 |   7 |    1
   2 |   7 |  10 |    1
   3 |   8 |  12 |  0.6
   4 |  -2 |  -1 |    0
(5 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_withPoints.html"><span class="doc">pgr_withPoints - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT pid, edge_id, fraction FROM pointsOfInterest WHERE pid IN (4, 3)$$,
  -4, -3,
  details =&gt; false);
 seq | path_seq | node | edge | cost | agg_cost
-----+----------+------+------+------+----------
   1 |        1 |   -4 |    6 |  0.7 |        0
   2 |        2 |    3 |    7 |    1 |      0.7
   3 |        3 |    7 |   10 |    1 |      1.7
   4 |        4 |    8 |   12 |  0.6 |      2.7
   5 |        5 |   -3 |   -1 |    0 |      3.3
(5 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The types casting has been removed.</p></li>
<li><p>Do not show details, as the deprecated function does not show details.</p></li>
<li><p><a class="reference internal" href="pgr_withPoints.html"><span class="doc">pgr_withPoints - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types, and node
values of the function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, node::INTEGER AS id1, edge::INTEGER AS id2, cost
FROM pgr_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM (VALUES (1, 6, 0.3),(2, 12, 0.6)) AS t(pid, edge_id, fraction)$$,
  -1, -2,
  details =&gt; false);
 seq | id1 | id2 | cost
-----+-----+-----+------
   1 |  -1 |   6 |  0.7
   2 |   3 |   7 |    1
   3 |   7 |  10 |    1
   4 |   8 |  12 |  0.6
   5 |  -2 |  -1 |    0
(5 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the edge</p></li>
</ul>
</section>
<section id="migrating-pgr-trsp-edges-using-pgr-trsp-withpoints">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trsp</span></code> (Edges) using <code class="docutils literal notranslate"><span class="pre">pgr_trsp_withPoints</span></code></a><a class="headerlink" href="#migrating-pgr-trsp-edges-using-pgr-trsp-withpoints" title="Permalink to this heading">Â¶</a></h3>
<p>The following query has restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost FROM edges$$,
  6, 0.3, 12, 0.6, true, true,
  $$SELECT to_cost, target_id::INTEGER, via_path FROM old_restrictions$$);
WARNING:  pgr_trsp(text,integer,float,integer,float,boolean,boolean) deprecated on v3.4.0
 seq | id1 | id2 | cost
-----+-----+-----+------
   0 |  -1 |   6 |  0.7
   1 |   3 |   7 |    1
   2 |   7 |   8 |    1
   3 |  11 |   9 |    1
   4 |  16 |  16 |    1
   5 |  15 |   3 |    1
   6 |  10 |   2 |    1
   7 |   6 |   4 |    1
   8 |   7 |  10 |    1
   9 |   8 |  12 |  0.6
(10 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
<li><p>The restrictions are the last parameter of the function</p>
<ul>
<li><p>Using the old structure of restrictions</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_trsp_withPoints.html"><span class="doc">pgr_trsp_withPoints - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trsp_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  $$SELECT pid, edge_id, fraction FROM pointsOfInterest WHERE pid IN (4, 3)$$,
  -4, -3,
  details =&gt; false);
 seq | path_seq | start_vid | end_vid | node | edge | cost | agg_cost
-----+----------+-----------+---------+------+------+------+----------
   1 |        1 |        -4 |      -3 |   -4 |    6 |  0.7 |        0
   2 |        2 |        -4 |      -3 |    3 |    7 |    1 |      0.7
   3 |        3 |        -4 |      -3 |    7 |    8 |    1 |      1.7
   4 |        4 |        -4 |      -3 |   11 |    9 |    1 |      2.7
   5 |        5 |        -4 |      -3 |   16 |   16 |    1 |      3.7
   6 |        6 |        -4 |      -3 |   15 |    3 |    1 |      4.7
   7 |        7 |        -4 |      -3 |   10 |    2 |    1 |      5.7
   8 |        8 |        -4 |      -3 |    6 |    4 |    1 |      6.7
   9 |        9 |        -4 |      -3 |    7 |   10 |    1 |      7.7
  10 |       10 |        -4 |      -3 |    8 |   12 |  0.6 |      8.7
  11 |       11 |        -4 |      -3 |   -3 |   -1 |    0 |      9.3
(11 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The new structure of restrictions is been used.</p>
<ul>
<li><p>It is the second parameter.</p></li>
</ul>
</li>
<li><p>The types casting has been removed.</p></li>
<li><p>Do not show details, as the deprecated function does not show details.</p></li>
<li><p><a class="reference internal" href="pgr_trsp_withPoints.html"><span class="doc">pgr_trsp_withPoints - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types, and node
values of the function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT seq, node::INTEGER AS id1, edge::INTEGER AS id2, cost
FROM pgr_trsp_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  $$SELECT * FROM (VALUES (1, 6, 0.3),(2, 12, 0.6)) AS t(pid, edge_id, fraction)$$,
  -1, -2,
  details =&gt; false)
WHERE edge != -1;
 seq | id1 | id2 | cost
-----+-----+-----+------
   1 |  -1 |   6 |  0.7
   2 |   3 |   7 |    1
   3 |   7 |   8 |    1
   4 |  11 |   9 |    1
   5 |  16 |  16 |    1
   6 |  15 |   3 |    1
   7 |  10 |   2 |    1
   8 |   6 |   4 |    1
   9 |   7 |  10 |    1
  10 |   8 |  12 |  0.6
(10 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the edge</p></li>
</ul>
</section>
</section>
<section id="migration-of-pgr-trspviavertices">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code></a><a class="headerlink" href="#migration-of-pgr-trspviavertices" title="Permalink to this heading">Â¶</a></h2>
<p>Signature to be migrated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_trspViaVertices</span><span class="p">(</span><span class="n">sql</span> <span class="n">text</span><span class="p">,</span> <span class="n">vids</span> <span class="n">integer</span><span class="p">[],</span>
                  <span class="n">directed</span> <span class="n">boolean</span><span class="p">,</span> <span class="n">has_rcost</span> <span class="n">boolean</span>
                  <span class="p">[,</span> <span class="n">turn_restrict_sql</span> <span class="n">text</span><span class="p">]);</span>
<span class="n">RETURNS</span> <span class="n">SETOF</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">id3</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The integral types of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
<li><p>The floating point type of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag is compulsory.</p>
<ul>
<li><p>Does not have a default value.</p></li>
</ul>
</li>
<li><p>Does not autodetect if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column exist.</p>
<ul>
<li><p>User must be careful to match the existence of the column with the value of
<code class="docutils literal notranslate"><span class="pre">has_rcost</span></code> parameter.</p></li>
</ul>
</li>
<li><p>The restrictions inner query is optional.</p></li>
</ul>
<p>Migrate by using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_dijkstraVia.html"><span class="doc">pgr_dijkstraVia - Proposed</span></a> when there are no restrictions,</p></li>
<li><p><a class="reference internal" href="pgr_trspVia.html"><span class="doc">pgr_trspVia - Proposed</span></a> when there are restrictions.</p></li>
</ul>
<section id="migrating-pgr-trspviavertices-using-pgr-dijkstravia">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_dijkstraVia</span></code></a><a class="headerlink" href="#migrating-pgr-trspviavertices-using-pgr-dijkstravia" title="Permalink to this heading">Â¶</a></h3>
<p>The following query does not have restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspViaVertices(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost FROM edges$$,
  ARRAY[6, 3, 6],
  true, true);
WARNING:  pgr_trspViaVertices(text,anyarray,boolean,boolean,text) is been deprecated
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |   6 |   4 |    1
   2 |   1 |   7 |   7 |    1
   3 |   2 |   3 |   7 |    1
   4 |   2 |   7 |   4 |    1
   5 |   2 |   6 |  -1 |    0
(5 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_dijkstraVia.html"><span class="doc">pgr_dijkstraVia - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_dijkstraVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  ARRAY[6, 3, 6]);
 seq | path_id | path_seq | start_vid | end_vid | node | edge | cost | agg_cost | route_agg_cost
-----+---------+----------+-----------+---------+------+------+------+----------+----------------
   1 |       1 |        1 |         6 |       3 |    6 |    4 |    1 |        0 |              0
   2 |       1 |        2 |         6 |       3 |    7 |    7 |    1 |        1 |              1
   3 |       1 |        3 |         6 |       3 |    3 |   -1 |    0 |        2 |              2
   4 |       2 |        1 |         3 |       6 |    3 |    7 |    1 |        0 |              2
   5 |       2 |        2 |         3 |       6 |    7 |    4 |    1 |        1 |              3
   6 |       2 |        3 |         3 |       6 |    6 |   -2 |    0 |        2 |              4
(6 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The types casting has been removed.</p></li>
<li><p><a class="reference internal" href="pgr_dijkstraVia.html"><span class="doc">pgr_dijkstraVia - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types of the
function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT row_number() over(ORDER BY seq) AS seq,
  path_id::INTEGER AS id1, node::INTEGER AS id2,
  CASE WHEN edge &gt;= 0 THEN edge::INTEGER ELSE -1 END AS id3, cost::FLOAT
FROM pgr_dijkstraVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  ARRAY[6, 3, 6])
WHERE edge != -1;
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |   6 |   4 |    1
   2 |   1 |   7 |   7 |    1
   3 |   2 |   3 |   7 |    1
   4 |   2 |   7 |   4 |    1
   5 |   2 |   6 |  -1 |    0
(5 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the path identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id3</span></code> is the edge</p></li>
</ul>
</section>
<section id="migrating-pgr-trspviavertices-using-pgr-trspvia">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaVertices</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia</span></code></a><a class="headerlink" href="#migrating-pgr-trspviavertices-using-pgr-trspvia" title="Permalink to this heading">Â¶</a></h3>
<p>The following query has restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspViaVertices(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost FROM edges$$,
  ARRAY[6, 3, 6],
  true, true,
  $$SELECT to_cost, target_id::INTEGER, via_path FROM old_restrictions$$);
WARNING:  pgr_trspViaVertices(text,anyarray,boolean,boolean,text) is been deprecated
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |   6 |   4 |    1
   2 |   1 |   7 |   8 |    1
   3 |   1 |  11 |   9 |    1
   4 |   1 |  16 |  16 |    1
   5 |   1 |  15 |   3 |    1
   6 |   1 |  10 |   5 |    1
   7 |   1 |  11 |   8 |    1
   8 |   1 |   7 |   7 |    1
   9 |   2 |   3 |   7 |    1
  10 |   2 |   7 |   4 |    1
  11 |   2 |   6 |  -1 |    0
(11 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
<li><p>The restrictions are the last parameter of the function</p>
<ul>
<li><p>Using the old structure of restrictions</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_trspVia.html"><span class="doc">pgr_trspVia - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  ARRAY[6, 3, 6]);
 seq | path_id | path_seq | start_vid | end_vid | node | edge | cost | agg_cost | route_agg_cost
-----+---------+----------+-----------+---------+------+------+------+----------+----------------
   1 |       1 |        1 |         6 |       3 |    6 |    4 |    1 |        0 |              0
   2 |       1 |        2 |         6 |       3 |    7 |    8 |    1 |        1 |              1
   3 |       1 |        3 |         6 |       3 |   11 |    9 |    1 |        2 |              2
   4 |       1 |        4 |         6 |       3 |   16 |   16 |    1 |        3 |              3
   5 |       1 |        5 |         6 |       3 |   15 |    3 |    1 |        4 |              4
   6 |       1 |        6 |         6 |       3 |   10 |    5 |    1 |        5 |              5
   7 |       1 |        7 |         6 |       3 |   11 |    8 |    1 |        6 |              6
   8 |       1 |        8 |         6 |       3 |    7 |    7 |    1 |        7 |              7
   9 |       1 |        9 |         6 |       3 |    3 |   -1 |    0 |        8 |              8
  10 |       2 |        1 |         3 |       6 |    3 |    7 |    1 |        0 |              8
  11 |       2 |        2 |         3 |       6 |    7 |    4 |    1 |        1 |              9
  12 |       2 |        3 |         3 |       6 |    6 |   -2 |    0 |        2 |             10
(12 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The new structure of restrictions is been used.</p>
<ul>
<li><p>It is the second parameter.</p></li>
</ul>
</li>
<li><p>The types casting has been removed.</p></li>
<li><p><a class="reference internal" href="pgr_trspVia.html"><span class="doc">pgr_trspVia - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types of the
function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT row_number() over(ORDER BY seq) AS seq,
  path_id::INTEGER AS id1, node::INTEGER AS id2,
  CASE WHEN edge &gt;= 0 THEN edge::INTEGER ELSE -1 END AS id3, cost::FLOAT
FROM pgr_trspVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  ARRAY[6, 3, 6])
WHERE edge != -1;
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |   6 |   4 |    1
   2 |   1 |   7 |   8 |    1
   3 |   1 |  11 |   9 |    1
   4 |   1 |  16 |  16 |    1
   5 |   1 |  15 |   3 |    1
   6 |   1 |  10 |   5 |    1
   7 |   1 |  11 |   8 |    1
   8 |   1 |   7 |   7 |    1
   9 |   2 |   3 |   7 |    1
  10 |   2 |   7 |   4 |    1
  11 |   2 |   6 |  -1 |    0
(11 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the path identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id3</span></code> is the edge</p></li>
</ul>
</section>
</section>
<section id="migration-of-pgr-trspviaedges">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Migration of <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code></a><a class="headerlink" href="#migration-of-pgr-trspviaedges" title="Permalink to this heading">Â¶</a></h2>
<p>Signature to be migrated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_trspViaEdges</span><span class="p">(</span><span class="n">sql</span> <span class="n">text</span><span class="p">,</span> <span class="n">eids</span> <span class="n">integer</span><span class="p">[],</span> <span class="n">pcts</span> <span class="n">float8</span><span class="p">[],</span>
                  <span class="n">directed</span> <span class="n">boolean</span><span class="p">,</span> <span class="n">has_rcost</span> <span class="n">boolean</span>
                  <span class="p">[,</span> <span class="n">turn_restrict_sql</span> <span class="n">text</span><span class="p">]);</span>
<span class="n">RETURNS</span> <span class="n">SETOF</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">id3</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The integral types of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
<li><p>The floating point type of the <code class="docutils literal notranslate"><span class="pre">Edges</span> <span class="pre">SQL</span></code> can only be <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag is compulsory.</p>
<ul>
<li><p>Does not have a default value.</p></li>
</ul>
</li>
<li><p>Does not autodetect if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column exist.</p>
<ul>
<li><p>User must be careful to match the existence of the column with the value of
<code class="docutils literal notranslate"><span class="pre">has_rcost</span></code> parameter.</p></li>
</ul>
</li>
<li><p>The restrictions inner query is optional.</p></li>
</ul>
<p>For these migration guide the following points will be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">pid</span><span class="p">,</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">side</span> <span class="n">FROM</span> <span class="n">pointsOfInterest</span>
<span class="n">WHERE</span> <span class="n">pid</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
 <span class="n">pid</span> <span class="o">|</span> <span class="n">edge_id</span> <span class="o">|</span> <span class="n">fraction</span> <span class="o">|</span> <span class="n">side</span>
<span class="o">-----+---------+----------+------</span>
   <span class="mi">3</span> <span class="o">|</span>      <span class="mi">12</span> <span class="o">|</span>      <span class="mf">0.6</span> <span class="o">|</span> <span class="n">l</span>
   <span class="mi">4</span> <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="mf">0.3</span> <span class="o">|</span> <span class="n">r</span>
   <span class="mi">6</span> <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>      <span class="mf">0.7</span> <span class="o">|</span> <span class="n">b</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
<p>And will travel thru the following Via points <span class="math notranslate nohighlight">\(4\rightarrow3\rightarrow6\)</span></p>
<p>Migrate by using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="pgr_withPointsVia.html"><span class="doc">pgr_withPointsVia - Proposed</span></a> when there are no restrictions,</p></li>
<li><p><a class="reference internal" href="pgr_trspVia_withPoints.html"><span class="doc">pgr_trspVia_withPoints - Proposed</span></a> when there are restrictions.</p></li>
</ul>
<section id="migrating-pgr-trspviaedges-using-pgr-withpointsvia">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_withPointsVia</span></code></a><a class="headerlink" href="#migrating-pgr-trspviaedges-using-pgr-withpointsvia" title="Permalink to this heading">Â¶</a></h3>
<p>The following query does not have restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspViaEdges(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost FROM edges$$,
  ARRAY[6, 12, 4], ARRAY[0.3, 0.6, 0.7],
  true, true);
WARNING:  pgr_trspViaEdges(text,integer[],float[],boolean,boolean,text) deprecated on v3.4.0
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |  -1 |   6 |  0.7
   2 |   1 |   3 |   7 |    1
   3 |   1 |   7 |  10 |    1
   4 |   1 |   8 |  12 |  0.6
   5 |   1 |  -2 |  -1 |    0
   6 |   2 |  -2 |  12 |  0.4
   7 |   2 |  12 |  13 |    1
   8 |   2 |  17 |  15 |    1
   9 |   2 |  16 |   9 |    1
  10 |   2 |  11 |   8 |    1
  11 |   2 |   7 |   4 |  0.7
  12 |   2 |  -3 |  -2 |    0
(12 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_withPointsVia.html"><span class="doc">pgr_withPointsVia - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_withPointsVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT pid, edge_id, fraction FROM pointsOfInterest WHERE pid IN (3, 4, 6)$$,
  ARRAY[-4, -3, -6],
  details =&gt; false);
 seq | path_id | path_seq | start_vid | end_vid | node | edge | cost | agg_cost | route_agg_cost
-----+---------+----------+-----------+---------+------+------+------+----------+----------------
   1 |       1 |        1 |        -4 |      -3 |   -4 |    6 |  0.7 |        0 |              0
   2 |       1 |        2 |        -4 |      -3 |    3 |    7 |    1 |      0.7 |            0.7
   3 |       1 |        3 |        -4 |      -3 |    7 |   10 |    1 |      1.7 |            1.7
   4 |       1 |        4 |        -4 |      -3 |    8 |   12 |  0.6 |      2.7 |            2.7
   5 |       1 |        5 |        -4 |      -3 |   -3 |   -1 |    0 |      3.3 |            3.3
   6 |       2 |        1 |        -3 |      -6 |   -3 |   12 |  0.4 |        0 |            3.3
   7 |       2 |        2 |        -3 |      -6 |   12 |   13 |    1 |      0.4 |            3.7
   8 |       2 |        3 |        -3 |      -6 |   17 |   15 |    1 |      1.4 |            4.7
   9 |       2 |        4 |        -3 |      -6 |   16 |    9 |    1 |      2.4 |            5.7
  10 |       2 |        5 |        -3 |      -6 |   11 |    8 |    1 |      3.4 |            6.7
  11 |       2 |        6 |        -3 |      -6 |    7 |    4 |  0.3 |      4.4 |            7.7
  12 |       2 |        7 |        -3 |      -6 |   -6 |   -2 |    0 |      4.7 |              8
(12 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The types casting has been removed.</p></li>
<li><p>Do not show details, as the deprecated function does not show details.</p></li>
<li><p><a class="reference internal" href="pgr_withPointsVia.html"><span class="doc">pgr_withPointsVia - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types, and node
values of the function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT row_number() over(ORDER BY seq) AS seq,
path_id::INTEGER AS id1, node::INTEGER AS id2,
CASE WHEN edge &gt;= 0 THEN edge::INTEGER ELSE -1 END AS id3, cost::FLOAT
FROM pgr_withPointsVia(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM (VALUES (1, 6, 0.3),(2, 12, 0.6),(3, 4, 0.7)) AS t(pid, edge_id, fraction)$$,
  ARRAY[-1, -2, -3],
  details=&gt; false);
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |  -1 |   6 |  0.7
   2 |   1 |   3 |   7 |    1
   3 |   1 |   7 |  10 |    1
   4 |   1 |   8 |  12 |  0.6
   5 |   1 |  -2 |  -1 |    0
   6 |   2 |  -2 |  12 |  0.4
   7 |   2 |  12 |  13 |    1
   8 |   2 |  17 |  15 |    1
   9 |   2 |  16 |   9 |    1
  10 |   2 |  11 |   8 |    1
  11 |   2 |   7 |   4 |  0.3
  12 |   2 |  -3 |  -1 |    0
(12 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the path identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id3</span></code> is the edge</p></li>
</ul>
</section>
<section id="migrating-pgr-trspviaedges-using-pgr-trspvia-withpoints">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Migrating <code class="docutils literal notranslate"><span class="pre">pgr_trspViaEdges</span></code> using <code class="docutils literal notranslate"><span class="pre">pgr_trspVia_withPoints</span></code></a><a class="headerlink" href="#migrating-pgr-trspviaedges-using-pgr-trspvia-withpoints" title="Permalink to this heading">Â¶</a></h3>
<p>The following query has restrictions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspViaEdges(
  $$SELECT id::INTEGER, source::INTEGER, target::INTEGER, cost, reverse_cost FROM edges$$,
  ARRAY[6, 12, 4], ARRAY[0.3, 0.6, 0.7],
  true, true,
  $$SELECT to_cost, target_id::INTEGER, via_path FROM old_restrictions$$);
WARNING:  pgr_trspViaEdges(text,integer[],float[],boolean,boolean,text) deprecated on v3.4.0
WARNING:  pgr_trsp(text,integer,float,integer,float,boolean,boolean) deprecated on v3.4.0
WARNING:  pgr_trsp(text,integer,float,integer,float,boolean,boolean) deprecated on v3.4.0
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |  -1 |   6 |  0.7
   2 |   1 |   3 |   7 |    1
   3 |   1 |   7 |   8 |    1
   4 |   1 |  11 |   9 |    1
   5 |   1 |  16 |  16 |    1
   6 |   1 |  15 |   3 |    1
   7 |   1 |  10 |   2 |    1
   8 |   1 |   6 |   4 |    1
   9 |   1 |   7 |  10 |    1
  10 |   1 |   8 |  12 |    1
  11 |   2 |  12 |  13 |    1
  12 |   2 |  17 |  15 |    1
  13 |   2 |  16 |   9 |    1
  14 |   2 |  11 |   8 |    1
  15 |   2 |   7 |   4 |  0.3
(15 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>A message about deprecation is shown</p>
<ul>
<li><p>Deprecated functions will be removed on the next mayor version 4.0.0</p></li>
</ul>
</li>
<li><p>The restrictions are the last parameter of the function</p>
<ul>
<li><p>Using the old structure of restrictions</p></li>
</ul>
</li>
</ul>
<p>Use <a class="reference internal" href="pgr_trspVia_withPoints.html"><span class="doc">pgr_trspVia_withPoints - Proposed</span></a> instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT * FROM pgr_trspVia_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  $$SELECT pid, edge_id, fraction FROM pointsOfInterest WHERE pid IN (3, 4, 6)$$,
  ARRAY[-4, -3, -6],
  details =&gt; false);
 seq | path_id | path_seq | start_vid | end_vid | node | edge | cost | agg_cost | route_agg_cost
-----+---------+----------+-----------+---------+------+------+------+----------+----------------
   1 |       1 |        1 |        -4 |      -3 |   -4 |    6 |  0.7 |        0 |              0
   2 |       1 |        2 |        -4 |      -3 |    3 |    7 |    1 |      0.7 |            0.7
   3 |       1 |        3 |        -4 |      -3 |    7 |    4 |  0.6 |      1.7 |            1.7
   4 |       1 |        4 |        -4 |      -3 |    7 |   10 |    1 |      2.3 |            2.3
   5 |       1 |        5 |        -4 |      -3 |    8 |   12 |  0.6 |      3.3 |            3.3
   6 |       1 |        6 |        -4 |      -3 |   -3 |   -1 |    0 |      3.9 |            3.9
   7 |       2 |        1 |        -3 |      -6 |   -3 |   12 |  0.4 |        0 |            3.9
   8 |       2 |        2 |        -3 |      -6 |   12 |   13 |    1 |      0.4 |            4.3
   9 |       2 |        3 |        -3 |      -6 |   17 |   15 |    1 |      1.4 |            5.3
  10 |       2 |        4 |        -3 |      -6 |   16 |    9 |    1 |      2.4 |            6.3
  11 |       2 |        5 |        -3 |      -6 |   11 |    8 |    1 |      3.4 |            7.3
  12 |       2 |        6 |        -3 |      -6 |    7 |    4 |  0.3 |      4.4 |            8.3
  13 |       2 |        7 |        -3 |      -6 |   -6 |   -2 |    0 |      4.7 |            8.6
(13 rows)

</pre></div>
</div>
<ul class="simple">
<li><p>The new structure of restrictions is been used.</p>
<ul>
<li><p>It is the second parameter.</p></li>
</ul>
</li>
<li><p>The types casting has been removed.</p></li>
<li><p>Do not show details, as the deprecated function does not show details.</p></li>
<li><p><a class="reference internal" href="pgr_trspVia_withPoints.html"><span class="doc">pgr_trspVia_withPoints - Proposed</span></a>:</p>
<ul>
<li><p>Autodetects if <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> column is in the edges
SQL.</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-INTEGER</span></code> on integral types</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">ANY-NUMERICAL</span></code> on floating point types</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directed</span></code> flag has a default value of <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<ul>
<li><p>Use the same value that on the original query.</p></li>
<li><p>In this example it is <code class="docutils literal notranslate"><span class="pre">true</span></code> which is the default value.</p>
<ul>
<li><p>The flag has been omitted and the default is been used.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On the points query do not include the <code class="docutils literal notranslate"><span class="pre">side</span></code> column.</p></li>
</ul>
</li>
</ul>
<p>When the need of using strictly the same (meaningless) names and types, and node
values of the function been migrated then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT row_number() over(ORDER BY seq) AS seq,
path_id::INTEGER AS id1, node::INTEGER AS id2,
CASE WHEN edge &gt;= 0 THEN edge::INTEGER ELSE -1 END AS id3, cost::FLOAT
FROM pgr_trspVia_withPoints(
  $$SELECT id, source, target, cost, reverse_cost FROM edges$$,
  $$SELECT * FROM new_restrictions$$,
  $$SELECT * FROM (VALUES (1, 6, 0.3),(2, 12, 0.6),(3, 4, 0.7)) AS t(pid, edge_id, fraction)$$,
  ARRAY[-1, -2, -3],
  details =&gt; false);
 seq | id1 | id2 | id3 | cost
-----+-----+-----+-----+------
   1 |   1 |  -1 |   6 |  0.7
   2 |   1 |   3 |   7 |    1
   3 |   1 |   7 |   4 |  0.6
   4 |   1 |   7 |  10 |    1
   5 |   1 |   8 |  12 |  0.6
   6 |   1 |  -2 |  -1 |    0
   7 |   2 |  -2 |  12 |  0.4
   8 |   2 |  12 |  13 |    1
   9 |   2 |  17 |  15 |    1
  10 |   2 |  16 |   9 |    1
  11 |   2 |  11 |   8 |    1
  12 |   2 |   7 |   4 |  0.3
  13 |   2 |  -3 |  -1 |    0
(13 rows)

</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id1</span></code> is the path identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id2</span></code> is the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id3</span></code> is the edge</p></li>
</ul>
</section>
</section>
<section id="see-also">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="TRSP-family.html"><span class="doc">TRSP - Family of functions</span></a></p></li>
<li><p><a class="reference internal" href="withPoints-category.html"><span class="doc">withPoints - Category</span></a></p></li>
</ul>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v3.5.0.<br/>
      Last updated on Mar 08, 2023.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>